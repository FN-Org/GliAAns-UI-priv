<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 16.0.0"/>
    <title>ui.pipeline_patient_selection_page documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note{color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.tip{color:#0a3622;background-color:#d1e7dd;border-color:#a3cfbb;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%230a3622%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%206a6%206%200%201%201%2010.174%204.31c-.203.196-.359.4-.453.619l-.762%201.769A.5.5%200%200%201%2010.5%2013a.5.5%200%200%201%200%201%20.5.5%200%200%201%200%201l-.224.447a1%201%200%200%201-.894.553H6.618a1%201%200%200%201-.894-.553L5.5%2015a.5.5%200%200%201%200-1%20.5.5%200%200%201%200-1%20.5.5%200%200%201-.46-.302l-.761-1.77a2%202%200%200%200-.453-.618A5.98%205.98%200%200%201%202%206m6-5a5%205%200%200%200-3.479%208.592c.263.254.514.564.676.941L5.83%2012h4.342l.632-1.467c.162-.377.413-.687.676-.941A5%205%200%200%200%208%201%22/%3E%3C/svg%3E");}.pdoc .alert.important{color:#055160;background-color:#cff4fc;border-color:#9eeaf9;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23055160%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%200a2%202%200%200%200-2%202v12a2%202%200%200%200%202%202h12a2%202%200%200%200%202-2V2a2%202%200%200%200-2-2zm6%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.caution{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M11.46.146A.5.5%200%200%200%2011.107%200H4.893a.5.5%200%200%200-.353.146L.146%204.54A.5.5%200%200%200%200%204.893v6.214a.5.5%200%200%200%20.146.353l4.394%204.394a.5.5%200%200%200%20.353.146h6.214a.5.5%200%200%200%20.353-.146l4.394-4.394a.5.5%200%200%200%20.146-.353V4.893a.5.5%200%200%200-.146-.353zM8%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:27px;vertical-align:bottom;width:50px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../ui.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;ui</a>

            <img src="GliAAns-logo.png" class="logo" alt="project logo"/>

            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



                <ul class="memberlist">
            <li>
                    <a class="variable" href="#log">log</a>
            </li>
            <li>
                    <a class="class" href="#PipelinePatientSelectionPage">PipelinePatientSelectionPage</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#PipelinePatientSelectionPage.__init__">PipelinePatientSelectionPage</a>
                        </li>
                        <li>
                                <a class="variable" href="#PipelinePatientSelectionPage.context">context</a>
                        </li>
                        <li>
                                <a class="variable" href="#PipelinePatientSelectionPage.previous_page">previous_page</a>
                        </li>
                        <li>
                                <a class="variable" href="#PipelinePatientSelectionPage.next_page">next_page</a>
                        </li>
                        <li>
                                <a class="variable" href="#PipelinePatientSelectionPage.workspace_path">workspace_path</a>
                        </li>
                        <li>
                                <a class="variable" href="#PipelinePatientSelectionPage.patient_buttons">patient_buttons</a>
                        </li>
                        <li>
                                <a class="variable" href="#PipelinePatientSelectionPage.selected_patients">selected_patients</a>
                        </li>
                        <li>
                                <a class="variable" href="#PipelinePatientSelectionPage.patient_status">patient_status</a>
                        </li>
                        <li>
                                <a class="function" href="#PipelinePatientSelectionPage.on_enter">on_enter</a>
                        </li>
                        <li>
                                <a class="function" href="#PipelinePatientSelectionPage.is_ready_to_advance">is_ready_to_advance</a>
                        </li>
                        <li>
                                <a class="function" href="#PipelinePatientSelectionPage.is_ready_to_go_back">is_ready_to_go_back</a>
                        </li>
                        <li>
                                <a class="function" href="#PipelinePatientSelectionPage.next">next</a>
                        </li>
                        <li>
                                <a class="function" href="#PipelinePatientSelectionPage.back">back</a>
                        </li>
                        <li>
                                <a class="function" href="#PipelinePatientSelectionPage.get_selected_patients">get_selected_patients</a>
                        </li>
                        <li>
                                <a class="function" href="#PipelinePatientSelectionPage.get_eligible_patients">get_eligible_patients</a>
                        </li>
                        <li>
                                <a class="function" href="#PipelinePatientSelectionPage.get_patient_status_summary">get_patient_status_summary</a>
                        </li>
                        <li>
                                <a class="function" href="#PipelinePatientSelectionPage.reset_page">reset_page</a>
                        </li>
                        <li>
                                <a class="function" href="#PipelinePatientSelectionPage.resizeEvent">resizeEvent</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22160%22%20viewBox%3D%220%200%20150%2080%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M132.316%2048.886c.276-4.679%202.342-6.698%204.409-7.982s4.27-1.165%206.751-1.055c1.586.07%203.044.156%204.222-.482%201.142-.619%202.026-1.932%202.162-3.739.268-3.576-1.929-5.368-5.006-5.551s-7.599.524-10.517%201.606c-4.455%201.652-8.588%206.606-9.552%208.992s-2.342%206.193-1.745%2010.873%202.664%209.221%205.878%2011.79%205.878%203.808%2010.103%204.312%203.444.229%206.062.229%205.006-2.202%204.914-4.909-2.296-5.001-4.501-4.863-3.077.505-5.281.229-7.715-2.064-7.899-9.451z%22%20fill%3D%22%23198754%22/%3E%3Ccircle%20cx%3D%22101.504%22%20cy%3D%2248.943%22%20r%3D%2214.208%22%20fill%3D%22none%22%20stroke%3D%22%23198754%22%20stroke-width%3D%229.354%22/%3E%3Cpath%20d%3D%22M87.81.002c-3.637.065-5.001.454-7.014%201.232s-3.443%201.363-6.3%204.282c-1.723%201.76-3.148%205.019-3.776%207.329-.413%201.521-.316%202.63-.316%202.63l-.195%2034.612c.065%205.774-6.755%208.305-9.612%208.37s-9.678-1.038-9.743-9.408%207.128-9.521%208.362-9.521c1.413-.13%202.526-.021%203.718-.016%202.071.009%204.157-.778%204.092-4.671s-4.157-4.736-4.157-4.736c-6.3-.843-11.43%202.206-11.43%202.206S40.917%2038.15%2041.372%2049.634%2051.568%2068.19%2061.311%2068.125s18.316-7.007%2018.445-17.193l.13-22.772c.046-2.291%202.683-3.644%204.476-4.203.745-.232%201.694-.274%201.694-.274l10.457-.13s4.871-.324%207.729-3.114%204.352-6.294%204.352-6.294.974-3.049.13-4.606-.195-1.233-2.792-3.309-8.573-4.477-8.573-4.477S91.447-.063%2087.81.002zM0%2047.169l.065%2028.417S0%2080.127%204.481%2079.997s5.072-3.866%205.049-4.152l-.113-28.482s1.624-7.656%209.937-7.721%2010.002%206.942%2010.002%208.499-.909%2010.51-9.093%2010.51c-.948%200-2.99-.567-4.145-.272-3.919%201-3.194%204.554-3.194%204.554s.065%205.061%207.404%204.996%2018.575-6.034%2018.575-19.074S26.953%2030.04%2019.549%2029.91%201.234%2035.296%200%2047.169z%22%20fill%3D%22%23198754%22/%3E%3Cg%20transform%3D%22matrix%28.325601%200%200%20.325256%20-10.32669%20-45.802786%29%22%3E%3Ccircle%20cx%3D%22297.554%22%20cy%3D%22172.286%22%20r%3D%2216.5%22%20fill%3D%22%23fff%22/%3E%3Cellipse%20cx%3D%22297.709%22%20cy%3D%22172.642%22%20rx%3D%2211.071%22%20ry%3D%2210.871%22%20fill%3D%22%23105a48%22/%3E%3Ccircle%20cx%3D%22304.104%22%20cy%3D%22167.667%22%20r%3D%224.5%22%20fill%3D%22%23fff%22/%3E%3C/g%3E%3Cpath%20d%3D%22M94.661%2017.032l.893-1.476s.99.714%201.916.925%201.575.114%202.955.114l14.565-.162c1.283-.032%203.085-.762%203.02-3.293s-.373-3.503-.373-3.503l1.283-.487s.52.503.877%201.573.309%201.995.292%202.66-.227%201.541-.227%201.541%201.564-.308%202.359-1.038.823-.779%201.489-1.508.812-.86.812-.86.552-.13.877.26.341.957.065%201.46-1.672%202.206-3.247%203.066-2.76%201.427-3.929%201.768-3.848.73-7.063.714l-10.944-.114s-2.143-.081-3.02-.373-2.241-.973-2.598-1.265z%22%20fill%3D%22%23d36d49%22/%3E%3Cg%20fill%3D%22%23105a48%22%3E%3Cellipse%20cx%3D%2293.052%22%20cy%3D%2243.567%22%20rx%3D%22.869%22%20ry%3D%221.014%22%20transform%3D%22rotate%28341.022%29%22/%3E%3Cellipse%20cx%3D%22104.3%22%20cy%3D%22-16.184%22%20rx%3D%22.865%22%20ry%3D%221.009%22%20transform%3D%22rotate%2814.786%29%22/%3E%3C/g%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../ui.html">ui</a><wbr>.pipeline_patient_selection_page    </h1>

                
                        <input id="mod-pipeline_patient_selection_page-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-pipeline_patient_selection_page-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">   1</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">   2</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">   3</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">glob</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">   4</span></a>
</span><span id="L-5"><a href="#L-5"><span class="linenos">   5</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">PyQt6</span><span class="w"> </span><span class="kn">import</span> <span class="n">QtGui</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">   6</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">PyQt6.QtGui</span><span class="w"> </span><span class="kn">import</span> <span class="n">QFont</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">   7</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">PyQt6.QtWidgets</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span><span class="n">QWidget</span><span class="p">,</span> <span class="n">QVBoxLayout</span><span class="p">,</span> <span class="n">QLabel</span><span class="p">,</span> <span class="n">QPushButton</span><span class="p">,</span> <span class="n">QScrollArea</span><span class="p">,</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">   8</span></a>                             <span class="n">QFrame</span><span class="p">,</span> <span class="n">QGridLayout</span><span class="p">,</span> <span class="n">QHBoxLayout</span><span class="p">,</span> <span class="n">QSizePolicy</span><span class="p">)</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">   9</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">PyQt6.QtCore</span><span class="w"> </span><span class="kn">import</span> <span class="n">Qt</span><span class="p">,</span> <span class="n">QCoreApplication</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">  10</span></a>
</span><span id="L-11"><a href="#L-11"><span class="linenos">  11</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">ui.pipeline_review_page</span><span class="w"> </span><span class="kn">import</span> <span class="n">PipelineReviewPage</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">  12</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">resource_path</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">  13</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">page</span><span class="w"> </span><span class="kn">import</span> <span class="n">Page</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos">  14</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">logger</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_logger</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">  15</span></a>
</span><span id="L-16"><a href="#L-16"><span class="linenos">  16</span></a><span class="n">log</span> <span class="o">=</span> <span class="n">get_logger</span><span class="p">()</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">  17</span></a>
</span><span id="L-18"><a href="#L-18"><span class="linenos">  18</span></a>
</span><span id="L-19"><a href="#L-19"><span class="linenos">  19</span></a><span class="k">class</span><span class="w"> </span><span class="nc">PipelinePatientSelectionPage</span><span class="p">(</span><span class="n">Page</span><span class="p">):</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">  20</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">previous_page</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">  21</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos">  22</span></a>
</span><span id="L-23"><a href="#L-23"><span class="linenos">  23</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">context</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos">  24</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">previous_page</span> <span class="o">=</span> <span class="n">previous_page</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos">  25</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">next_page</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos">  26</span></a>
</span><span id="L-27"><a href="#L-27"><span class="linenos">  27</span></a>        <span class="c1"># Path to the workspace directory containing patient data</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos">  28</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">workspace_path</span> <span class="o">=</span> <span class="n">context</span><span class="p">[</span><span class="s2">&quot;workspace_path&quot;</span><span class="p">]</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos">  29</span></a>
</span><span id="L-30"><a href="#L-30"><span class="linenos">  30</span></a>        <span class="c1"># Dictionaries to track patient widgets, selected patients, and their processing status</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos">  31</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">patient_buttons</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos">  32</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">selected_patients</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos">  33</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">patient_status</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Stores eligibility and missing data for each patient</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos">  34</span></a>
</span><span id="L-35"><a href="#L-35"><span class="linenos">  35</span></a>        <span class="c1"># Initialize the user interface</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos">  36</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_ui</span><span class="p">()</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos">  37</span></a>
</span><span id="L-38"><a href="#L-38"><span class="linenos">  38</span></a>        <span class="c1"># Set translations (for multilingual UI)</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos">  39</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_translate_ui</span><span class="p">()</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos">  40</span></a>        <span class="k">if</span> <span class="n">context</span> <span class="ow">and</span> <span class="s2">&quot;language_changed&quot;</span> <span class="ow">in</span> <span class="n">context</span><span class="p">:</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos">  41</span></a>            <span class="c1"># Connect language change signal for dynamic translation</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos">  42</span></a>            <span class="n">context</span><span class="p">[</span><span class="s2">&quot;language_changed&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate_ui</span><span class="p">)</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos">  43</span></a>
</span><span id="L-44"><a href="#L-44"><span class="linenos">  44</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_setup_ui</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos">  45</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Setup the main layout and UI components.&quot;&quot;&quot;</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos">  46</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos">  47</span></a>
</span><span id="L-48"><a href="#L-48"><span class="linenos">  48</span></a>        <span class="c1"># --- Title ---</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos">  49</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Select Patients for Pipeline Analysis&quot;</span><span class="p">)</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos">  50</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">QFont</span><span class="p">(</span><span class="s2">&quot;Arial&quot;</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="n">QFont</span><span class="o">.</span><span class="n">Weight</span><span class="o">.</span><span class="n">Bold</span><span class="p">))</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos">  51</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignmentFlag</span><span class="o">.</span><span class="n">AlignHCenter</span><span class="p">)</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos">  52</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos">  53</span></a>
</span><span id="L-54"><a href="#L-54"><span class="linenos">  54</span></a>        <span class="c1"># --- Top buttons (bulk selection controls) ---</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos">  55</span></a>        <span class="n">top_buttons_layout</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos">  56</span></a>
</span><span id="L-57"><a href="#L-57"><span class="linenos">  57</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">select_eligible_btn</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Select All Eligible&quot;</span><span class="p">)</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos">  58</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">deselect_all_btn</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Deselect All&quot;</span><span class="p">)</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos">  59</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_btn</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Refresh Status&quot;</span><span class="p">)</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos">  60</span></a>
</span><span id="L-61"><a href="#L-61"><span class="linenos">  61</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">buttons</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">select_eligible_btn</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">deselect_all_btn</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">refresh_btn</span><span class="p">]</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos">  62</span></a>
</span><span id="L-63"><a href="#L-63"><span class="linenos">  63</span></a>        <span class="c1"># Apply a consistent visual style to all buttons</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos">  64</span></a>        <span class="n">btn_style</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos">  65</span></a><span class="s2">            QPushButton {</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos">  66</span></a><span class="s2">                background-color: #e0e0e0;</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos">  67</span></a><span class="s2">                padding: 10px 20px;</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos">  68</span></a><span class="s2">                border-radius: 10px;</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos">  69</span></a><span class="s2">                border: 1px solid #bdc3c7;</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos">  70</span></a><span class="s2">                font-weight: bold;</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos">  71</span></a><span class="s2">                margin: 2px;</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos">  72</span></a><span class="s2">            }</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos">  73</span></a><span class="s2">            QPushButton:hover {</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos">  74</span></a><span class="s2">                background-color: #d0d0d0;</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos">  75</span></a><span class="s2">            }</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos">  76</span></a><span class="s2">            QPushButton:disabled {</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos">  77</span></a><span class="s2">                background-color: #f0f0f0;</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos">  78</span></a><span class="s2">                color: #888888;</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos">  79</span></a><span class="s2">            }</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos">  80</span></a><span class="s2">        &quot;&quot;&quot;</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos">  81</span></a>        <span class="k">for</span> <span class="n">btn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">buttons</span><span class="p">:</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos">  82</span></a>            <span class="n">btn</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="n">btn_style</span><span class="p">)</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos">  83</span></a>
</span><span id="L-84"><a href="#L-84"><span class="linenos">  84</span></a>        <span class="c1"># Connect buttons to actions</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos">  85</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">select_eligible_btn</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_select_all_eligible_patients</span><span class="p">)</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos">  86</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">deselect_all_btn</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_deselect_all_patients</span><span class="p">)</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos">  87</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_btn</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_refresh_patient_status</span><span class="p">)</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos">  88</span></a>
</span><span id="L-89"><a href="#L-89"><span class="linenos">  89</span></a>        <span class="c1"># Add the buttons to layout with stretch for alignment</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos">  90</span></a>        <span class="n">top_buttons_layout</span><span class="o">.</span><span class="n">addStretch</span><span class="p">()</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos">  91</span></a>        <span class="n">top_buttons_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">select_eligible_btn</span><span class="p">)</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos">  92</span></a>        <span class="n">top_buttons_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">deselect_all_btn</span><span class="p">)</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos">  93</span></a>        <span class="n">top_buttons_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">refresh_btn</span><span class="p">)</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos">  94</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">top_buttons_layout</span><span class="p">)</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos">  95</span></a>
</span><span id="L-96"><a href="#L-96"><span class="linenos">  96</span></a>        <span class="c1"># --- Scroll area for displaying patients ---</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos">  97</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scroll_area</span> <span class="o">=</span> <span class="n">QScrollArea</span><span class="p">()</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos">  98</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scroll_area</span><span class="o">.</span><span class="n">setWidgetResizable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos">  99</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scroll_area</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos"> 100</span></a><span class="s2">            QScrollArea {</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos"> 101</span></a><span class="s2">                font-size: 13px;</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos"> 102</span></a><span class="s2">                border: 1px solid #CCCCCC;</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos"> 103</span></a><span class="s2">                border-radius: 10px;</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos"> 104</span></a><span class="s2">                padding: 5px;</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos"> 105</span></a><span class="s2">            }</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos"> 106</span></a><span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos"> 107</span></a>
</span><span id="L-108"><a href="#L-108"><span class="linenos"> 108</span></a>        <span class="c1"># Container widget inside scroll area (grid of patient cards)</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos"> 109</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scroll_content</span> <span class="o">=</span> <span class="n">QWidget</span><span class="p">()</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos"> 110</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">grid_layout</span> <span class="o">=</span> <span class="n">QGridLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scroll_content</span><span class="p">)</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos"> 111</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scroll_area</span><span class="o">.</span><span class="n">setWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scroll_content</span><span class="p">)</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos"> 112</span></a>
</span><span id="L-113"><a href="#L-113"><span class="linenos"> 113</span></a>        <span class="c1"># --- Summary panel showing total and eligible counts ---</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos"> 114</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">summary_widget</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_summary_widget</span><span class="p">()</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos"> 115</span></a>
</span><span id="L-116"><a href="#L-116"><span class="linenos"> 116</span></a>        <span class="c1"># Add widgets to the main layout</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos"> 117</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">summary_widget</span><span class="p">)</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos"> 118</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scroll_area</span><span class="p">)</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos"> 119</span></a>
</span><span id="L-120"><a href="#L-120"><span class="linenos"> 120</span></a>        <span class="c1"># Number of patient columns per row in grid</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos"> 121</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">column_count</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos"> 122</span></a>
</span><span id="L-123"><a href="#L-123"><span class="linenos"> 123</span></a>        <span class="c1"># Load patient data and build UI</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos"> 124</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_load_patients</span><span class="p">()</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos"> 125</span></a>
</span><span id="L-126"><a href="#L-126"><span class="linenos"> 126</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_create_summary_widget</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos"> 127</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a modern-style summary widget for displaying patient statistics.&quot;&quot;&quot;</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos"> 128</span></a>        <span class="n">summary_frame</span> <span class="o">=</span> <span class="n">QFrame</span><span class="p">()</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos"> 129</span></a>        <span class="n">summary_frame</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">&quot;summaryCard&quot;</span><span class="p">)</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos"> 130</span></a>        <span class="n">summary_frame</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos"> 131</span></a><span class="s2">            QFrame#summaryCard {</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos"> 132</span></a><span class="s2">                border: 1px solid #e0e0e0;</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos"> 133</span></a><span class="s2">                border-radius: 12px;</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos"> 134</span></a><span class="s2">                background-color: #ffffff;</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos"> 135</span></a><span class="s2">                padding: 0.1em;</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos"> 136</span></a><span class="s2">            }</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos"> 137</span></a><span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos"> 138</span></a>
</span><span id="L-139"><a href="#L-139"><span class="linenos"> 139</span></a>        <span class="n">main_layout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">(</span><span class="n">summary_frame</span><span class="p">)</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos"> 140</span></a>
</span><span id="L-141"><a href="#L-141"><span class="linenos"> 141</span></a>        <span class="c1"># Section title</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos"> 142</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">title_summary</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;PipelinePatientSelectionPage&quot;</span><span class="p">,</span> <span class="s2">&quot;Pipeline Requirements Summary&quot;</span><span class="p">))</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos"> 143</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">title_summary</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignmentFlag</span><span class="o">.</span><span class="n">AlignCenter</span><span class="p">)</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos"> 144</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">title_summary</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;font-size: 16px; font-weight: bold; color: #000000; margin-bottom: 10px;&quot;</span><span class="p">)</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos"> 145</span></a>        <span class="n">main_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">title_summary</span><span class="p">)</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos"> 146</span></a>
</span><span id="L-147"><a href="#L-147"><span class="linenos"> 147</span></a>        <span class="c1"># Horizontal layout for summary pill cards</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos"> 148</span></a>        <span class="n">stats_layout</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos"> 149</span></a>        <span class="n">stats_layout</span><span class="o">.</span><span class="n">setSpacing</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos"> 150</span></a>
</span><span id="L-151"><a href="#L-151"><span class="linenos"> 151</span></a>        <span class="c1"># Create pill cards showing totals</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos"> 152</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">total_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_stat_pill</span><span class="p">(</span><span class="n">resource_path</span><span class="p">(</span><span class="s2">&quot;resources/icon_total.png&quot;</span><span class="p">),</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos"> 153</span></a>                                                  <span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;PipelinePatientSelectionPage&quot;</span><span class="p">,</span> <span class="s2">&quot;Total Patients&quot;</span><span class="p">),</span> <span class="s2">&quot;0&quot;</span><span class="p">)</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos"> 154</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">eligible_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_stat_pill</span><span class="p">(</span><span class="n">resource_path</span><span class="p">(</span><span class="s2">&quot;resources/icon_check.png&quot;</span><span class="p">),</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos"> 155</span></a>                                                     <span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;PipelinePatientSelectionPage&quot;</span><span class="p">,</span> <span class="s2">&quot;Eligible&quot;</span><span class="p">),</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#27ae60&quot;</span><span class="p">)</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos"> 156</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">not_eligible_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_stat_pill</span><span class="p">(</span><span class="n">resource_path</span><span class="p">(</span><span class="s2">&quot;resources/icon_cross.png&quot;</span><span class="p">),</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos"> 157</span></a>                                                         <span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;PipelinePatientSelectionPage&quot;</span><span class="p">,</span> <span class="s2">&quot;Not Eligible&quot;</span><span class="p">),</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#c0392b&quot;</span><span class="p">)</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos"> 158</span></a>
</span><span id="L-159"><a href="#L-159"><span class="linenos"> 159</span></a>        <span class="c1"># Add pills to layout</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos"> 160</span></a>        <span class="k">for</span> <span class="n">pill</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">total_label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eligible_label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">not_eligible_label</span><span class="p">]:</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos"> 161</span></a>            <span class="n">pill</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Policy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">,</span> <span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Policy</span><span class="o">.</span><span class="n">Fixed</span><span class="p">)</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos"> 162</span></a>            <span class="n">stats_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">pill</span><span class="p">)</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos"> 163</span></a>
</span><span id="L-164"><a href="#L-164"><span class="linenos"> 164</span></a>        <span class="n">main_layout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">stats_layout</span><span class="p">)</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos"> 165</span></a>
</span><span id="L-166"><a href="#L-166"><span class="linenos"> 166</span></a>        <span class="k">return</span> <span class="n">summary_frame</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos"> 167</span></a>
</span><span id="L-168"><a href="#L-168"><span class="linenos"> 168</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_create_stat_pill</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">icon_path</span><span class="p">,</span> <span class="n">label_text</span><span class="p">,</span> <span class="n">value_text</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#000000&quot;</span><span class="p">):</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos"> 169</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a card-like label with icon, text, and numeric value for summaries.&quot;&quot;&quot;</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos"> 170</span></a>        <span class="n">pill</span> <span class="o">=</span> <span class="n">QFrame</span><span class="p">()</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos"> 171</span></a>        <span class="n">pill</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">&quot;summaryCard&quot;</span><span class="p">)</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos"> 172</span></a>        <span class="n">pill</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos"> 173</span></a><span class="s2">            QFrame#summaryCard </span><span class="se">{{</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos"> 174</span></a><span class="s2">                border: 1px solid #CCCCCC;</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos"> 175</span></a><span class="s2">                border-radius: 10px;</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos"> 176</span></a><span class="s2">                background-color: #f9f9f9;</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos"> 177</span></a><span class="s2">            </span><span class="se">}}</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos"> 178</span></a><span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos"> 179</span></a>
</span><span id="L-180"><a href="#L-180"><span class="linenos"> 180</span></a>        <span class="n">layout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">(</span><span class="n">pill</span><span class="p">)</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos"> 181</span></a>        <span class="n">layout</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignmentFlag</span><span class="o">.</span><span class="n">AlignCenter</span><span class="p">)</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos"> 182</span></a>
</span><span id="L-183"><a href="#L-183"><span class="linenos"> 183</span></a>        <span class="c1"># Text label (e.g., Total Patients)</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos"> 184</span></a>        <span class="n">label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="n">label_text</span><span class="p">)</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos"> 185</span></a>        <span class="n">label</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;font-size: 13px; font-weight: bold;&quot;</span><span class="p">)</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos"> 186</span></a>        <span class="n">label</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignmentFlag</span><span class="o">.</span><span class="n">AlignCenter</span><span class="p">)</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos"> 187</span></a>
</span><span id="L-188"><a href="#L-188"><span class="linenos"> 188</span></a>        <span class="c1"># Numeric value (e.g., 5)</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos"> 189</span></a>        <span class="n">value</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="n">value_text</span><span class="p">)</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos"> 190</span></a>        <span class="n">value</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;font-size: 20px; font-weight: bold; color: </span><span class="si">{</span><span class="n">color</span><span class="si">}</span><span class="s2">;&quot;</span><span class="p">)</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos"> 191</span></a>        <span class="n">value</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignmentFlag</span><span class="o">.</span><span class="n">AlignCenter</span><span class="p">)</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos"> 192</span></a>
</span><span id="L-193"><a href="#L-193"><span class="linenos"> 193</span></a>        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos"> 194</span></a>        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos"> 195</span></a>
</span><span id="L-196"><a href="#L-196"><span class="linenos"> 196</span></a>        <span class="c1"># Keep reference to labels for later updates</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos"> 197</span></a>        <span class="n">pill</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">label</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos"> 198</span></a>        <span class="n">pill</span><span class="o">.</span><span class="n">value_label</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos"> 199</span></a>
</span><span id="L-200"><a href="#L-200"><span class="linenos"> 200</span></a>        <span class="n">pill</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Policy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">,</span> <span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Policy</span><span class="o">.</span><span class="n">Fixed</span><span class="p">)</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos"> 201</span></a>        <span class="n">pill</span><span class="o">.</span><span class="n">setMinimumHeight</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos"> 202</span></a>        <span class="n">pill</span><span class="o">.</span><span class="n">setMaximumHeight</span><span class="p">(</span><span class="mi">120</span><span class="p">)</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos"> 203</span></a>
</span><span id="L-204"><a href="#L-204"><span class="linenos"> 204</span></a>        <span class="k">return</span> <span class="n">pill</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos"> 205</span></a>
</span><span id="L-206"><a href="#L-206"><span class="linenos"> 206</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_check_patient_requirements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patient_path</span><span class="p">,</span> <span class="n">patient_id</span><span class="p">):</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos"> 207</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check whether a patient meets all pipeline requirements.&quot;&quot;&quot;</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos"> 208</span></a>        <span class="c1"># Each key corresponds to a necessary preprocessing step</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos"> 209</span></a>        <span class="n">requirements</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos"> 210</span></a>            <span class="s1">&#39;flair&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos"> 211</span></a>            <span class="s1">&#39;skull_stripping&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos"> 212</span></a>            <span class="s1">&#39;segmentation&#39;</span><span class="p">:</span> <span class="kc">False</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos"> 213</span></a>        <span class="p">}</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos"> 214</span></a>
</span><span id="L-215"><a href="#L-215"><span class="linenos"> 215</span></a>        <span class="n">missing_files</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Collect missing components for display</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos"> 216</span></a>
</span><span id="L-217"><a href="#L-217"><span class="linenos"> 217</span></a>        <span class="c1"># --- 1. Check for FLAIR anatomical image ---</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos"> 218</span></a>        <span class="n">flair_patterns</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos"> 219</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">patient_path</span><span class="p">,</span> <span class="s2">&quot;anat&quot;</span><span class="p">,</span> <span class="s2">&quot;*_flair.nii&quot;</span><span class="p">),</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos"> 220</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">patient_path</span><span class="p">,</span> <span class="s2">&quot;anat&quot;</span><span class="p">,</span> <span class="s2">&quot;*_flair.nii.gz&quot;</span><span class="p">)</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos"> 221</span></a>        <span class="p">]</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos"> 222</span></a>
</span><span id="L-223"><a href="#L-223"><span class="linenos"> 223</span></a>        <span class="n">flair_found</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos"> 224</span></a>        <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">flair_patterns</span><span class="p">:</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos"> 225</span></a>            <span class="k">if</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">pattern</span><span class="p">):</span>  <span class="c1"># Search for matching files</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos"> 226</span></a>                <span class="n">flair_found</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos"> 227</span></a>                <span class="k">break</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos"> 228</span></a>
</span><span id="L-229"><a href="#L-229"><span class="linenos"> 229</span></a>        <span class="n">requirements</span><span class="p">[</span><span class="s1">&#39;flair&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">flair_found</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos"> 230</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">flair_found</span><span class="p">:</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos"> 231</span></a>            <span class="n">missing_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos"> 232</span></a>                <span class="s2">&quot;PipelinePatientSelectionPage&quot;</span><span class="p">,</span> <span class="s2">&quot;FLAIR image (anat/*_flair.nii[.gz])&quot;</span><span class="p">))</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos"> 233</span></a>
</span><span id="L-234"><a href="#L-234"><span class="linenos"> 234</span></a>        <span class="c1"># --- 2. Check for Skull-Stripped image ---</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos"> 235</span></a>        <span class="n">skull_strip_patterns</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos"> 236</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workspace_path</span><span class="p">,</span> <span class="s2">&quot;derivatives&quot;</span><span class="p">,</span> <span class="s2">&quot;skullstrips&quot;</span><span class="p">,</span> <span class="n">patient_id</span><span class="p">,</span> <span class="s2">&quot;anat&quot;</span><span class="p">,</span> <span class="s2">&quot;*_brain.nii&quot;</span><span class="p">),</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos"> 237</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workspace_path</span><span class="p">,</span> <span class="s2">&quot;derivatives&quot;</span><span class="p">,</span> <span class="s2">&quot;skullstrips&quot;</span><span class="p">,</span> <span class="n">patient_id</span><span class="p">,</span> <span class="s2">&quot;anat&quot;</span><span class="p">,</span> <span class="s2">&quot;*_brain.nii.gz&quot;</span><span class="p">)</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos"> 238</span></a>        <span class="p">]</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos"> 239</span></a>
</span><span id="L-240"><a href="#L-240"><span class="linenos"> 240</span></a>        <span class="n">skull_strip_found</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos"> 241</span></a>        <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">skull_strip_patterns</span><span class="p">:</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos"> 242</span></a>            <span class="k">if</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">pattern</span><span class="p">):</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos"> 243</span></a>                <span class="n">skull_strip_found</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos"> 244</span></a>                <span class="k">break</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos"> 245</span></a>
</span><span id="L-246"><a href="#L-246"><span class="linenos"> 246</span></a>        <span class="n">requirements</span><span class="p">[</span><span class="s1">&#39;skull_stripping&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">skull_strip_found</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos"> 247</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">skull_strip_found</span><span class="p">:</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos"> 248</span></a>            <span class="n">missing_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos"> 249</span></a>                <span class="s2">&quot;PipelinePatientSelectionPage&quot;</span><span class="p">,</span> <span class="s2">&quot;Skull stripped image (derivatives/skullstrips/.../anat/*_brain.nii[.gz])&quot;</span><span class="p">))</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos"> 250</span></a>
</span><span id="L-251"><a href="#L-251"><span class="linenos"> 251</span></a>        <span class="c1"># --- 3. Check for Segmentation or Manual Mask ---</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos"> 252</span></a>        <span class="n">segmentation_patterns</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos"> 253</span></a>            <span class="c1"># Manual masks</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos"> 254</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workspace_path</span><span class="p">,</span> <span class="s2">&quot;derivatives&quot;</span><span class="p">,</span> <span class="s2">&quot;manual_masks&quot;</span><span class="p">,</span> <span class="n">patient_id</span><span class="p">,</span> <span class="s2">&quot;anat&quot;</span><span class="p">,</span> <span class="s2">&quot;*_mask.nii&quot;</span><span class="p">),</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos"> 255</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workspace_path</span><span class="p">,</span> <span class="s2">&quot;derivatives&quot;</span><span class="p">,</span> <span class="s2">&quot;manual_masks&quot;</span><span class="p">,</span> <span class="n">patient_id</span><span class="p">,</span> <span class="s2">&quot;anat&quot;</span><span class="p">,</span> <span class="s2">&quot;*_mask.nii.gz&quot;</span><span class="p">),</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos"> 256</span></a>            <span class="c1"># Deep learning segmentation output</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos"> 257</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workspace_path</span><span class="p">,</span> <span class="s2">&quot;derivatives&quot;</span><span class="p">,</span> <span class="s2">&quot;deep_learning_seg&quot;</span><span class="p">,</span> <span class="n">patient_id</span><span class="p">,</span> <span class="s2">&quot;anat&quot;</span><span class="p">,</span> <span class="s2">&quot;*_seg.nii&quot;</span><span class="p">),</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos"> 258</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workspace_path</span><span class="p">,</span> <span class="s2">&quot;derivatives&quot;</span><span class="p">,</span> <span class="s2">&quot;deep_learning_seg&quot;</span><span class="p">,</span> <span class="n">patient_id</span><span class="p">,</span> <span class="s2">&quot;anat&quot;</span><span class="p">,</span> <span class="s2">&quot;*_seg.nii.gz&quot;</span><span class="p">)</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos"> 259</span></a>        <span class="p">]</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos"> 260</span></a>
</span><span id="L-261"><a href="#L-261"><span class="linenos"> 261</span></a>        <span class="n">segmentation_found</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos"> 262</span></a>        <span class="n">segmentation_type</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos"> 263</span></a>        <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">segmentation_patterns</span><span class="p">:</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos"> 264</span></a>            <span class="k">if</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">pattern</span><span class="p">):</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos"> 265</span></a>                <span class="n">segmentation_found</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos"> 266</span></a>                <span class="c1"># Identify segmentation source type</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos"> 267</span></a>                <span class="k">if</span> <span class="s2">&quot;manual_masks&quot;</span> <span class="ow">in</span> <span class="n">pattern</span><span class="p">:</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos"> 268</span></a>                    <span class="n">segmentation_type</span> <span class="o">=</span> <span class="s2">&quot;Manual Mask&quot;</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos"> 269</span></a>                <span class="k">elif</span> <span class="s2">&quot;deep_learning_seg&quot;</span> <span class="ow">in</span> <span class="n">pattern</span><span class="p">:</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos"> 270</span></a>                    <span class="n">segmentation_type</span> <span class="o">=</span> <span class="s2">&quot;deep_learning_seg Segmentation&quot;</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos"> 271</span></a>                <span class="k">break</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos"> 272</span></a>
</span><span id="L-273"><a href="#L-273"><span class="linenos"> 273</span></a>        <span class="n">requirements</span><span class="p">[</span><span class="s1">&#39;segmentation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">segmentation_found</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos"> 274</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">segmentation_found</span><span class="p">:</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos"> 275</span></a>            <span class="n">missing_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos"> 276</span></a>                <span class="s2">&quot;PipelinePatientSelectionPage&quot;</span><span class="p">,</span> <span class="s2">&quot;Segmentation (manual_masks/*_mask.nii[.gz] or deep_learning_seg /*_seg.nii[.gz])&quot;</span><span class="p">))</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos"> 277</span></a>
</span><span id="L-278"><a href="#L-278"><span class="linenos"> 278</span></a>        <span class="c1"># --- Final eligibility decision ---</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos"> 279</span></a>        <span class="c1"># Patient is eligible if all required files are present</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos"> 280</span></a>        <span class="n">is_eligible</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="n">requirements</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos"> 281</span></a>
</span><span id="L-282"><a href="#L-282"><span class="linenos"> 282</span></a>        <span class="c1"># Return structured summary of findings</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos"> 283</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos"> 284</span></a>            <span class="s1">&#39;eligible&#39;</span><span class="p">:</span> <span class="n">is_eligible</span><span class="p">,</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos"> 285</span></a>            <span class="s1">&#39;requirements&#39;</span><span class="p">:</span> <span class="n">requirements</span><span class="p">,</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos"> 286</span></a>            <span class="s1">&#39;missing_files&#39;</span><span class="p">:</span> <span class="n">missing_files</span><span class="p">,</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos"> 287</span></a>            <span class="s1">&#39;segmentation_type&#39;</span><span class="p">:</span> <span class="n">segmentation_type</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos"> 288</span></a>        <span class="p">}</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos"> 289</span></a>
</span><span id="L-290"><a href="#L-290"><span class="linenos"> 290</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_load_patients</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos"> 291</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Load patients and verify their requirements&quot;&quot;&quot;</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos"> 292</span></a>        <span class="c1"># Find all patient folders (sub-*)</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos"> 293</span></a>        <span class="n">patient_dirs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_patient_dirs</span><span class="p">()</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos"> 294</span></a>        <span class="n">patient_dirs</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>  <span class="c1"># Sort alphabetically for visual consistency</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos"> 295</span></a>
</span><span id="L-296"><a href="#L-296"><span class="linenos"> 296</span></a>        <span class="c1"># Clear the dictionaries of buttons and patient states</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos"> 297</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">patient_buttons</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos"> 298</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">patient_status</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos"> 299</span></a>
</span><span id="L-300"><a href="#L-300"><span class="linenos"> 300</span></a>        <span class="n">eligible_count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos"> 301</span></a>        <span class="n">total_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">patient_dirs</span><span class="p">)</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos"> 302</span></a>
</span><span id="L-303"><a href="#L-303"><span class="linenos"> 303</span></a>        <span class="c1"># Iterate over all found patients</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos"> 304</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">patient_path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">patient_dirs</span><span class="p">):</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos"> 305</span></a>            <span class="n">patient_id</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">patient_path</span><span class="p">)</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos"> 306</span></a>
</span><span id="L-307"><a href="#L-307"><span class="linenos"> 307</span></a>            <span class="c1"># Check the required conditions for each patient</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos"> 308</span></a>            <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_patient_requirements</span><span class="p">(</span><span class="n">patient_path</span><span class="p">,</span> <span class="n">patient_id</span><span class="p">)</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos"> 309</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">patient_status</span><span class="p">[</span><span class="n">patient_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">status</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos"> 310</span></a>
</span><span id="L-311"><a href="#L-311"><span class="linenos"> 311</span></a>            <span class="c1"># Count eligible patients</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos"> 312</span></a>            <span class="k">if</span> <span class="n">status</span><span class="p">[</span><span class="s1">&#39;eligible&#39;</span><span class="p">]:</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos"> 313</span></a>                <span class="n">eligible_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos"> 314</span></a>
</span><span id="L-315"><a href="#L-315"><span class="linenos"> 315</span></a>            <span class="c1"># Create a card (frame) for the patient</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos"> 316</span></a>            <span class="n">patient_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_patient_frame</span><span class="p">(</span><span class="n">patient_id</span><span class="p">,</span> <span class="n">patient_path</span><span class="p">,</span> <span class="n">status</span><span class="p">)</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos"> 317</span></a>
</span><span id="L-318"><a href="#L-318"><span class="linenos"> 318</span></a>            <span class="c1"># Insert the card into the grid layout</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos"> 319</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">grid_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">patient_frame</span><span class="p">,</span> <span class="n">i</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">column_count</span><span class="p">,</span> <span class="n">i</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">column_count</span><span class="p">)</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos"> 320</span></a>
</span><span id="L-321"><a href="#L-321"><span class="linenos"> 321</span></a>        <span class="c1"># Update the statistical summary</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos"> 322</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_update_summary</span><span class="p">(</span><span class="n">eligible_count</span><span class="p">,</span> <span class="n">total_count</span><span class="p">)</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos"> 323</span></a>
</span><span id="L-324"><a href="#L-324"><span class="linenos"> 324</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_create_patient_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patient_id</span><span class="p">,</span> <span class="n">patient_path</span><span class="p">,</span> <span class="n">status</span><span class="p">):</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos"> 325</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create the frame for a single patient&quot;&quot;&quot;</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos"> 326</span></a>        <span class="n">patient_frame</span> <span class="o">=</span> <span class="n">QFrame</span><span class="p">()</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos"> 327</span></a>        <span class="n">patient_frame</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">&quot;patientCard&quot;</span><span class="p">)</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos"> 328</span></a>        <span class="n">patient_frame</span><span class="o">.</span><span class="n">setMaximumHeight</span><span class="p">(</span><span class="mi">140</span><span class="p">)</span>  <span class="c1"># Card height limit</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos"> 329</span></a>        <span class="n">patient_frame</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Policy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">,</span> <span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Policy</span><span class="o">.</span><span class="n">Fixed</span><span class="p">)</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos"> 330</span></a>
</span><span id="L-331"><a href="#L-331"><span class="linenos"> 331</span></a>        <span class="c1"># Apply different visual style based on patient eligibility</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos"> 332</span></a>        <span class="k">if</span> <span class="n">status</span><span class="p">[</span><span class="s1">&#39;eligible&#39;</span><span class="p">]:</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos"> 333</span></a>            <span class="n">frame_style</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos"> 334</span></a><span class="s2">                QFrame#patientCard {</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos"> 335</span></a><span class="s2">                    border: 2px solid #4CAF50;</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos"> 336</span></a><span class="s2">                    border-radius: 10px;</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos"> 337</span></a><span class="s2">                    background-color: #f0fff0;</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos"> 338</span></a><span class="s2">                    padding: 10px;</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos"> 339</span></a><span class="s2">                    margin: 2px;</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos"> 340</span></a><span class="s2">                }</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos"> 341</span></a><span class="s2">            &quot;&quot;&quot;</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos"> 342</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos"> 343</span></a>            <span class="n">frame_style</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos"> 344</span></a><span class="s2">                QFrame#patientCard {</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos"> 345</span></a><span class="s2">                    border: 2px solid #f44336;</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos"> 346</span></a><span class="s2">                    border-radius: 10px;</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos"> 347</span></a><span class="s2">                    background-color: #fff0f0;</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos"> 348</span></a><span class="s2">                    padding: 10px;</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos"> 349</span></a><span class="s2">                    margin: 2px;</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos"> 350</span></a><span class="s2">                }</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos"> 351</span></a><span class="s2">            &quot;&quot;&quot;</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos"> 352</span></a>
</span><span id="L-353"><a href="#L-353"><span class="linenos"> 353</span></a>        <span class="n">patient_frame</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="n">frame_style</span><span class="p">)</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos"> 354</span></a>
</span><span id="L-355"><a href="#L-355"><span class="linenos"> 355</span></a>        <span class="c1"># Main horizontal layout (left  right)</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos"> 356</span></a>        <span class="n">patient_layout</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">(</span><span class="n">patient_frame</span><span class="p">)</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos"> 357</span></a>
</span><span id="L-358"><a href="#L-358"><span class="linenos"> 358</span></a>        <span class="c1"># Left section: profile information</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos"> 359</span></a>        <span class="n">profile_frame</span> <span class="o">=</span> <span class="n">QFrame</span><span class="p">()</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos"> 360</span></a>        <span class="n">profile_frame</span><span class="o">.</span><span class="n">setFixedSize</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos"> 361</span></a>        <span class="n">profile_layout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">(</span><span class="n">profile_frame</span><span class="p">)</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos"> 362</span></a>        <span class="n">profile_layout</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignmentFlag</span><span class="o">.</span><span class="n">AlignLeft</span> <span class="o">|</span> <span class="n">Qt</span><span class="o">.</span><span class="n">AlignmentFlag</span><span class="o">.</span><span class="n">AlignVCenter</span><span class="p">)</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos"> 363</span></a>
</span><span id="L-364"><a href="#L-364"><span class="linenos"> 364</span></a>        <span class="c1"># User image (icon)</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos"> 365</span></a>        <span class="n">image</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">()</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos"> 366</span></a>        <span class="n">pixmap</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPixmap</span><span class="p">(</span><span class="n">resource_path</span><span class="p">(</span><span class="s2">&quot;resources/user.png&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">scaled</span><span class="p">(</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos"> 367</span></a>            <span class="mi">30</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">AspectRatioMode</span><span class="o">.</span><span class="n">KeepAspectRatio</span><span class="p">,</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos"> 368</span></a>            <span class="n">Qt</span><span class="o">.</span><span class="n">TransformationMode</span><span class="o">.</span><span class="n">SmoothTransformation</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos"> 369</span></a>        <span class="p">)</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos"> 370</span></a>        <span class="n">image</span><span class="o">.</span><span class="n">setPixmap</span><span class="p">(</span><span class="n">pixmap</span><span class="p">)</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos"> 371</span></a>        <span class="n">image</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignmentFlag</span><span class="o">.</span><span class="n">AlignCenter</span><span class="p">)</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos"> 372</span></a>
</span><span id="L-373"><a href="#L-373"><span class="linenos"> 373</span></a>        <span class="c1"># Patient ID label</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos"> 374</span></a>        <span class="n">patient_label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">patient_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos"> 375</span></a>        <span class="n">patient_label</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignmentFlag</span><span class="o">.</span><span class="n">AlignCenter</span><span class="p">)</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos"> 376</span></a>        <span class="n">patient_label</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;font-weight: bold; font-size: 12px;&quot;</span><span class="p">)</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos"> 377</span></a>
</span><span id="L-378"><a href="#L-378"><span class="linenos"> 378</span></a>        <span class="c1"># Status label (Eligible / Not eligible)</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos"> 379</span></a>        <span class="k">if</span> <span class="n">status</span><span class="p">[</span><span class="s1">&#39;eligible&#39;</span><span class="p">]:</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos"> 380</span></a>            <span class="n">status_label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;PipelinePatientSelectionPage&quot;</span><span class="p">,</span> <span class="s2">&quot; Ready for Pipeline&quot;</span><span class="p">))</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos"> 381</span></a>            <span class="n">status_label</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: #4CAF50; font-weight: bold; font-size: 10px;&quot;</span><span class="p">)</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos"> 382</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos"> 383</span></a>            <span class="n">status_label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;PipelinePatientSelectionPage&quot;</span><span class="p">,</span> <span class="s2">&quot; Missing Requirements&quot;</span><span class="p">))</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos"> 384</span></a>            <span class="n">status_label</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: #f44336; font-weight: bold; font-size: 10px;&quot;</span><span class="p">)</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos"> 385</span></a>        <span class="n">status_label</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignmentFlag</span><span class="o">.</span><span class="n">AlignCenter</span><span class="p">)</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos"> 386</span></a>
</span><span id="L-387"><a href="#L-387"><span class="linenos"> 387</span></a>        <span class="c1"># Add widgets to the profile layout</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos"> 388</span></a>        <span class="n">profile_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos"> 389</span></a>        <span class="n">profile_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">patient_label</span><span class="p">)</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos"> 390</span></a>        <span class="n">profile_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">status_label</span><span class="p">)</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos"> 391</span></a>
</span><span id="L-392"><a href="#L-392"><span class="linenos"> 392</span></a>        <span class="c1"># Center section: requirement details</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos"> 393</span></a>        <span class="n">details_frame</span> <span class="o">=</span> <span class="n">QFrame</span><span class="p">()</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos"> 394</span></a>        <span class="n">details_layout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">(</span><span class="n">details_frame</span><span class="p">)</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos"> 395</span></a>        <span class="n">details_layout</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignmentFlag</span><span class="o">.</span><span class="n">AlignVCenter</span><span class="p">)</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos"> 396</span></a>
</span><span id="L-397"><a href="#L-397"><span class="linenos"> 397</span></a>        <span class="c1"># Status indicators for each required step</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos"> 398</span></a>        <span class="n">req_indicators</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos"> 399</span></a>        <span class="n">req_labels</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos"> 400</span></a>            <span class="s1">&#39;flair&#39;</span><span class="p">:</span> <span class="s1">&#39;FLAIR&#39;</span><span class="p">,</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos"> 401</span></a>            <span class="s1">&#39;skull_stripping&#39;</span><span class="p">:</span> <span class="s1">&#39;Skull Strip&#39;</span><span class="p">,</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos"> 402</span></a>            <span class="s1">&#39;segmentation&#39;</span><span class="p">:</span> <span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;PipelinePatientSelectionPage&quot;</span><span class="p">,</span> <span class="s1">&#39;Segmentation&#39;</span><span class="p">)</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos"> 403</span></a>        <span class="p">}</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos"> 404</span></a>
</span><span id="L-405"><a href="#L-405"><span class="linenos"> 405</span></a>        <span class="c1"># Display  or  next to each requirement</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos"> 406</span></a>        <span class="k">for</span> <span class="n">req</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">req_labels</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos"> 407</span></a>            <span class="n">indicator</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">()</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos"> 408</span></a>            <span class="k">if</span> <span class="n">status</span><span class="p">[</span><span class="s1">&#39;requirements&#39;</span><span class="p">][</span><span class="n">req</span><span class="p">]:</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos"> 409</span></a>                <span class="n">indicator</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos"> 410</span></a>                <span class="n">indicator</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: #4CAF50; font-size: 10px; padding: 1px;&quot;</span><span class="p">)</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos"> 411</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos"> 412</span></a>                <span class="n">indicator</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos"> 413</span></a>                <span class="n">indicator</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: #f44336; font-size: 10px; padding: 1px;&quot;</span><span class="p">)</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos"> 414</span></a>            <span class="n">req_indicators</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indicator</span><span class="p">)</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos"> 415</span></a>            <span class="n">details_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">indicator</span><span class="p">)</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos"> 416</span></a>
</span><span id="L-417"><a href="#L-417"><span class="linenos"> 417</span></a>        <span class="c1"># Show segmentation type if available</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos"> 418</span></a>        <span class="k">if</span> <span class="n">status</span><span class="p">[</span><span class="s1">&#39;segmentation_type&#39;</span><span class="p">]:</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos"> 419</span></a>            <span class="n">seg_type_label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;segmentation_type&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos"> 420</span></a>            <span class="n">seg_type_label</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: #666666; font-size: 9px; font-style: italic;&quot;</span><span class="p">)</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos"> 421</span></a>            <span class="n">details_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">seg_type_label</span><span class="p">)</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos"> 422</span></a>
</span><span id="L-423"><a href="#L-423"><span class="linenos"> 423</span></a>        <span class="c1"># Right section: selection button</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos"> 424</span></a>        <span class="n">button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;PipelinePatientSelectionPage&quot;</span><span class="p">,</span> <span class="s2">&quot;Select&quot;</span><span class="p">))</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos"> 425</span></a>        <span class="n">button</span><span class="o">.</span><span class="n">setCheckable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># Allows to toggle selection</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos"> 426</span></a>
</span><span id="L-427"><a href="#L-427"><span class="linenos"> 427</span></a>        <span class="k">if</span> <span class="n">status</span><span class="p">[</span><span class="s1">&#39;eligible&#39;</span><span class="p">]:</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos"> 428</span></a>            <span class="c1"># Style for active (eligible) button</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos"> 429</span></a>            <span class="n">button</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos"> 430</span></a><span class="s2">                QPushButton {</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos"> 431</span></a><span class="s2">                    border-radius: 12px;</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos"> 432</span></a><span class="s2">                    padding: 8px 16px;</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos"> 433</span></a><span class="s2">                    background-color: #DADADA;</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos"> 434</span></a><span class="s2">                    font-weight: bold;</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos"> 435</span></a><span class="s2">                    min-width: 80px;</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos"> 436</span></a><span class="s2">                }</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos"> 437</span></a><span class="s2">                QPushButton:checked {</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos"> 438</span></a><span class="s2">                    background-color: #4CAF50;</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos"> 439</span></a><span class="s2">                    color: white;</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos"> 440</span></a><span class="s2">                }</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos"> 441</span></a><span class="s2">                QPushButton:hover {</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos"> 442</span></a><span class="s2">                    background-color: #c0c0c0;</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos"> 443</span></a><span class="s2">                }</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos"> 444</span></a><span class="s2">                QPushButton:checked:hover {</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos"> 445</span></a><span class="s2">                    background-color: #45a049;</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos"> 446</span></a><span class="s2">                }</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos"> 447</span></a><span class="s2">            &quot;&quot;&quot;</span><span class="p">)</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos"> 448</span></a>
</span><span id="L-449"><a href="#L-449"><span class="linenos"> 449</span></a>            <span class="c1"># Restore previous selection if it exists</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos"> 450</span></a>            <span class="n">is_selected</span> <span class="o">=</span> <span class="n">patient_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_patients</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos"> 451</span></a>            <span class="n">button</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="n">is_selected</span><span class="p">)</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos"> 452</span></a>            <span class="n">button</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos"> 453</span></a>                <span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;PipelinePatientSelectionPage&quot;</span><span class="p">,</span> <span class="s2">&quot;Selected&quot;</span><span class="p">)</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos"> 454</span></a>                <span class="k">if</span> <span class="n">is_selected</span> <span class="k">else</span> <span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;PipelinePatientSelectionPage&quot;</span><span class="p">,</span> <span class="s2">&quot;Select&quot;</span><span class="p">)</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos"> 455</span></a>            <span class="p">)</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos"> 456</span></a>
</span><span id="L-457"><a href="#L-457"><span class="linenos"> 457</span></a>            <span class="c1"># Connect button click to selection handler</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos"> 458</span></a>            <span class="n">button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span> <span class="n">checked</span><span class="p">,</span> <span class="n">pid</span><span class="o">=</span><span class="n">patient_id</span><span class="p">,</span> <span class="n">btn</span><span class="o">=</span><span class="n">button</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_toggle_patient</span><span class="p">(</span><span class="n">pid</span><span class="p">,</span> <span class="n">checked</span><span class="p">,</span> <span class="n">btn</span><span class="p">))</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos"> 459</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos"> 460</span></a>            <span class="c1"># If not eligible, disable the button</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos"> 461</span></a>            <span class="n">button</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;PipelinePatientSelectionPage&quot;</span><span class="p">,</span> <span class="s2">&quot;Not Eligible&quot;</span><span class="p">))</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos"> 462</span></a>            <span class="n">button</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos"> 463</span></a>            <span class="n">button</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos"> 464</span></a><span class="s2">                QPushButton {</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos"> 465</span></a><span class="s2">                    border-radius: 12px;</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos"> 466</span></a><span class="s2">                    padding: 8px 16px;</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos"> 467</span></a><span class="s2">                    background-color: #f0f0f0;</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos"> 468</span></a><span class="s2">                    color: #888888;</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos"> 469</span></a><span class="s2">                    font-weight: bold;</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos"> 470</span></a><span class="s2">                    min-width: 80px;</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos"> 471</span></a><span class="s2">                }</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos"> 472</span></a><span class="s2">            &quot;&quot;&quot;</span><span class="p">)</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos"> 473</span></a>
</span><span id="L-474"><a href="#L-474"><span class="linenos"> 474</span></a>        <span class="c1"># Save reference of the button in the dictionary</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos"> 475</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">patient_buttons</span><span class="p">[</span><span class="n">patient_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">button</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos"> 476</span></a>
</span><span id="L-477"><a href="#L-477"><span class="linenos"> 477</span></a>        <span class="c1"># Assemble all sections into the main layout</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos"> 478</span></a>        <span class="n">patient_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">profile_frame</span><span class="p">)</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos"> 479</span></a>        <span class="n">patient_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">details_frame</span><span class="p">)</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos"> 480</span></a>        <span class="n">patient_layout</span><span class="o">.</span><span class="n">addStretch</span><span class="p">()</span>  <span class="c1"># Flexible space</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos"> 481</span></a>        <span class="n">patient_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">button</span><span class="p">)</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos"> 482</span></a>
</span><span id="L-483"><a href="#L-483"><span class="linenos"> 483</span></a>        <span class="k">return</span> <span class="n">patient_frame</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos"> 484</span></a>
</span><span id="L-485"><a href="#L-485"><span class="linenos"> 485</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_update_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eligible_count</span><span class="p">,</span> <span class="n">total_count</span><span class="p">):</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos"> 486</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the patient summary values&quot;&quot;&quot;</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos"> 487</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">total_label</span><span class="o">.</span><span class="n">value_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">total_count</span><span class="p">))</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos"> 488</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">eligible_label</span><span class="o">.</span><span class="n">value_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">eligible_count</span><span class="p">))</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos"> 489</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">not_eligible_label</span><span class="o">.</span><span class="n">value_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">total_count</span> <span class="o">-</span> <span class="n">eligible_count</span><span class="p">))</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos"> 490</span></a>
</span><span id="L-491"><a href="#L-491"><span class="linenos"> 491</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_select_all_eligible_patients</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos"> 492</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Automatically select all eligible patients&quot;&quot;&quot;</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos"> 493</span></a>        <span class="k">for</span> <span class="n">patient_id</span><span class="p">,</span> <span class="n">button</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">patient_buttons</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos"> 494</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">patient_status</span><span class="p">[</span><span class="n">patient_id</span><span class="p">][</span><span class="s1">&#39;eligible&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">button</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos"> 495</span></a>                <span class="n">button</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos"> 496</span></a>                <span class="n">button</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;PipelinePatientSelectionPage&quot;</span><span class="p">,</span> <span class="s2">&quot;Selected&quot;</span><span class="p">))</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos"> 497</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">selected_patients</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">patient_id</span><span class="p">)</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos"> 498</span></a>        <span class="c1"># Update main app buttons</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos"> 499</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="ow">and</span> <span class="s2">&quot;update_main_buttons&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">:</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos"> 500</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s2">&quot;update_main_buttons&quot;</span><span class="p">]()</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos"> 501</span></a>
</span><span id="L-502"><a href="#L-502"><span class="linenos"> 502</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_deselect_all_patients</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos"> 503</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Deselect all patients&quot;&quot;&quot;</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos"> 504</span></a>        <span class="k">for</span> <span class="n">patient_id</span><span class="p">,</span> <span class="n">button</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">patient_buttons</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos"> 505</span></a>            <span class="k">if</span> <span class="n">button</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span> <span class="ow">and</span> <span class="n">button</span><span class="o">.</span><span class="n">isEnabled</span><span class="p">():</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos"> 506</span></a>                <span class="n">button</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos"> 507</span></a>                <span class="n">button</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;PipelinePatientSelectionPage&quot;</span><span class="p">,</span> <span class="s2">&quot;Select&quot;</span><span class="p">))</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos"> 508</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">selected_patients</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">patient_id</span><span class="p">)</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos"> 509</span></a>        <span class="c1"># Update main buttons</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos"> 510</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="ow">and</span> <span class="s2">&quot;update_main_buttons&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">:</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos"> 511</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s2">&quot;update_main_buttons&quot;</span><span class="p">]()</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos"> 512</span></a>
</span><span id="L-513"><a href="#L-513"><span class="linenos"> 513</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_refresh_patient_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos"> 514</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Completely reload patient status&quot;&quot;&quot;</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos"> 515</span></a>        <span class="c1"># Save current selections</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos"> 516</span></a>        <span class="n">current_selections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_patients</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos"> 517</span></a>
</span><span id="L-518"><a href="#L-518"><span class="linenos"> 518</span></a>        <span class="c1"># Remove existing widgets from the grid</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos"> 519</span></a>        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_layout</span><span class="o">.</span><span class="n">count</span><span class="p">():</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos"> 520</span></a>            <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_layout</span><span class="o">.</span><span class="n">takeAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos"> 521</span></a>            <span class="n">widget</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos"> 522</span></a>            <span class="k">if</span> <span class="n">widget</span><span class="p">:</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos"> 523</span></a>                <span class="n">widget</span><span class="o">.</span><span class="n">setParent</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos"> 524</span></a>                <span class="n">widget</span><span class="o">.</span><span class="n">deleteLater</span><span class="p">()</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos"> 525</span></a>
</span><span id="L-526"><a href="#L-526"><span class="linenos"> 526</span></a>        <span class="c1"># Reload patients and update status</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos"> 527</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_load_patients</span><span class="p">()</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos"> 528</span></a>
</span><span id="L-529"><a href="#L-529"><span class="linenos"> 529</span></a>        <span class="c1"># Restore still-valid selections</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos"> 530</span></a>        <span class="n">valid_selections</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos"> 531</span></a>        <span class="k">for</span> <span class="n">patient_id</span> <span class="ow">in</span> <span class="n">current_selections</span><span class="p">:</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos"> 532</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">patient_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">patient_status</span> <span class="ow">and</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos"> 533</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">patient_status</span><span class="p">[</span><span class="n">patient_id</span><span class="p">][</span><span class="s1">&#39;eligible&#39;</span><span class="p">]</span> <span class="ow">and</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos"> 534</span></a>                    <span class="n">patient_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">patient_buttons</span><span class="p">):</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos"> 535</span></a>                <span class="n">valid_selections</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">patient_id</span><span class="p">)</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos"> 536</span></a>                <span class="n">button</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">patient_buttons</span><span class="p">[</span><span class="n">patient_id</span><span class="p">]</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos"> 537</span></a>                <span class="n">button</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos"> 538</span></a>                <span class="n">button</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;PipelinePatientSelectionPage&quot;</span><span class="p">,</span> <span class="s2">&quot;Selected&quot;</span><span class="p">))</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos"> 539</span></a>
</span><span id="L-540"><a href="#L-540"><span class="linenos"> 540</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">selected_patients</span> <span class="o">=</span> <span class="n">valid_selections</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos"> 541</span></a>
</span><span id="L-542"><a href="#L-542"><span class="linenos"> 542</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_toggle_patient</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patient_id</span><span class="p">,</span> <span class="n">is_selected</span><span class="p">,</span> <span class="n">button</span><span class="p">):</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos"> 543</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle selection/deselection of a single patient&quot;&quot;&quot;</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos"> 544</span></a>        <span class="k">if</span> <span class="n">is_selected</span><span class="p">:</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos"> 545</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">selected_patients</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">patient_id</span><span class="p">)</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos"> 546</span></a>            <span class="n">button</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;PipelinePatientSelectionPage&quot;</span><span class="p">,</span> <span class="s2">&quot;Selected&quot;</span><span class="p">))</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos"> 547</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos"> 548</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">selected_patients</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">patient_id</span><span class="p">)</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos"> 549</span></a>            <span class="n">button</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;PipelinePatientSelectionPage&quot;</span><span class="p">,</span> <span class="s2">&quot;Select&quot;</span><span class="p">))</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos"> 550</span></a>        <span class="c1"># Update main buttons</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos"> 551</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="ow">and</span> <span class="s2">&quot;update_main_buttons&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">:</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos"> 552</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s2">&quot;update_main_buttons&quot;</span><span class="p">]()</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos"> 553</span></a>
</span><span id="L-554"><a href="#L-554"><span class="linenos"> 554</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_find_patient_dirs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos"> 555</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Search for all patient directories in the workspace (excluding derivatives and pipeline)&quot;&quot;&quot;</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos"> 556</span></a>        <span class="n">patient_dirs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos"> 557</span></a>
</span><span id="L-558"><a href="#L-558"><span class="linenos"> 558</span></a>        <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workspace_path</span><span class="p">):</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos"> 559</span></a>            <span class="c1"># Exclude irrelevant folders</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos"> 560</span></a>            <span class="k">if</span> <span class="s2">&quot;derivatives&quot;</span> <span class="ow">in</span> <span class="n">dirs</span><span class="p">:</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos"> 561</span></a>                <span class="n">dirs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;derivatives&quot;</span><span class="p">)</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos"> 562</span></a>            <span class="k">if</span> <span class="s2">&quot;pipeline&quot;</span> <span class="ow">in</span> <span class="n">dirs</span><span class="p">:</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos"> 563</span></a>                <span class="n">dirs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;pipeline&quot;</span><span class="p">)</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos"> 564</span></a>
</span><span id="L-565"><a href="#L-565"><span class="linenos"> 565</span></a>            <span class="c1"># Add directories starting with &quot;sub-&quot;</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos"> 566</span></a>            <span class="k">for</span> <span class="n">dir_name</span> <span class="ow">in</span> <span class="n">dirs</span><span class="p">:</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos"> 567</span></a>                <span class="k">if</span> <span class="n">dir_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;sub-&quot;</span><span class="p">):</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos"> 568</span></a>                    <span class="n">full_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">dir_name</span><span class="p">)</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos"> 569</span></a>                    <span class="n">patient_dirs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">full_path</span><span class="p">)</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos"> 570</span></a>
</span><span id="L-571"><a href="#L-571"><span class="linenos"> 571</span></a>            <span class="c1"># Prevent going deeper into sub-* directories</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos"> 572</span></a>            <span class="n">dirs</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dirs</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">d</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;sub-&quot;</span><span class="p">)]</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos"> 573</span></a>
</span><span id="L-574"><a href="#L-574"><span class="linenos"> 574</span></a>        <span class="k">return</span> <span class="n">patient_dirs</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos"> 575</span></a>
</span><span id="L-576"><a href="#L-576"><span class="linenos"> 576</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_update_column_count</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos"> 577</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the number of grid columns based on available width&quot;&quot;&quot;</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos"> 578</span></a>        <span class="n">available_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scroll_area</span><span class="o">.</span><span class="n">viewport</span><span class="p">()</span><span class="o">.</span><span class="n">width</span><span class="p">()</span> <span class="o">-</span> <span class="mi">40</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos"> 579</span></a>        <span class="n">min_card_width</span> <span class="o">=</span> <span class="mi">400</span>  <span class="c1"># Minimum width for a card</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos"> 580</span></a>
</span><span id="L-581"><a href="#L-581"><span class="linenos"> 581</span></a>        <span class="n">new_column_count</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">available_width</span> <span class="o">//</span> <span class="n">min_card_width</span><span class="p">)</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos"> 582</span></a>
</span><span id="L-583"><a href="#L-583"><span class="linenos"> 583</span></a>        <span class="c1"># If column count changes, reload the grid</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos"> 584</span></a>        <span class="k">if</span> <span class="n">new_column_count</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">column_count</span><span class="p">:</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos"> 585</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">column_count</span> <span class="o">=</span> <span class="n">new_column_count</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos"> 586</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_reload_patient_grid</span><span class="p">()</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos"> 587</span></a>
</span><span id="L-588"><a href="#L-588"><span class="linenos"> 588</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_reload_patient_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos"> 589</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Reload the grid while keeping current selections&quot;&quot;&quot;</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos"> 590</span></a>        <span class="n">selected</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_patients</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos"> 591</span></a>
</span><span id="L-592"><a href="#L-592"><span class="linenos"> 592</span></a>        <span class="c1"># Remove existing widgets</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos"> 593</span></a>        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_layout</span><span class="o">.</span><span class="n">count</span><span class="p">():</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos"> 594</span></a>            <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_layout</span><span class="o">.</span><span class="n">takeAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos"> 595</span></a>            <span class="n">widget</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos"> 596</span></a>            <span class="k">if</span> <span class="n">widget</span><span class="p">:</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos"> 597</span></a>                <span class="n">widget</span><span class="o">.</span><span class="n">setParent</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos"> 598</span></a>                <span class="n">widget</span><span class="o">.</span><span class="n">deleteLater</span><span class="p">()</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos"> 599</span></a>
</span><span id="L-600"><a href="#L-600"><span class="linenos"> 600</span></a>        <span class="c1"># Reload patients in the new layout</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos"> 601</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_load_patients</span><span class="p">()</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos"> 602</span></a>
</span><span id="L-603"><a href="#L-603"><span class="linenos"> 603</span></a>        <span class="c1"># Restore valid selections</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos"> 604</span></a>        <span class="n">valid_selections</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos"> 605</span></a>        <span class="k">for</span> <span class="n">patient_id</span> <span class="ow">in</span> <span class="n">selected</span><span class="p">:</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos"> 606</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">patient_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">patient_status</span> <span class="ow">and</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos"> 607</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">patient_status</span><span class="p">[</span><span class="n">patient_id</span><span class="p">][</span><span class="s1">&#39;eligible&#39;</span><span class="p">]</span> <span class="ow">and</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos"> 608</span></a>                    <span class="n">patient_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">patient_buttons</span><span class="p">):</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos"> 609</span></a>                <span class="n">valid_selections</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">patient_id</span><span class="p">)</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos"> 610</span></a>                <span class="n">button</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">patient_buttons</span><span class="p">[</span><span class="n">patient_id</span><span class="p">]</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos"> 611</span></a>                <span class="n">button</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos"> 612</span></a>                <span class="n">button</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;PipelinePatientSelectionPage&quot;</span><span class="p">,</span> <span class="s2">&quot;Selected&quot;</span><span class="p">))</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos"> 613</span></a>
</span><span id="L-614"><a href="#L-614"><span class="linenos"> 614</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">selected_patients</span> <span class="o">=</span> <span class="n">valid_selections</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos"> 615</span></a>
</span><span id="L-616"><a href="#L-616"><span class="linenos"> 616</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_build_pipeline_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos"> 617</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create and save a JSON file containing the initial pipeline configuration.</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos"> 618</span></a>
</span><span id="L-619"><a href="#L-619"><span class="linenos"> 619</span></a><span class="sd">        All paths inside the JSON are relative to the `workspace_path`.</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos"> 620</span></a><span class="sd">        The configuration file is saved with a sequential numeric ID (e.g., 01_config.json).</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos"> 621</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos"> 622</span></a>        <span class="n">config</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Main dictionary that will store configuration data for all patients</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos"> 623</span></a>
</span><span id="L-624"><a href="#L-624"><span class="linenos"> 624</span></a>        <span class="c1"># Iterate over all selected patients</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos"> 625</span></a>        <span class="k">for</span> <span class="n">patient_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_patients</span><span class="p">:</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos"> 626</span></a>            <span class="n">patient_entry</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Holds the configuration for a single patient</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos"> 627</span></a>            <span class="n">need_revision</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Flag indicating if manual review is required due to ambiguities</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos"> 628</span></a>
</span><span id="L-629"><a href="#L-629"><span class="linenos"> 629</span></a>            <span class="c1"># ----------------------------------------------------</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos"> 630</span></a>            <span class="c1"># MRI (FLAIR)</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos"> 631</span></a>            <span class="c1"># ----------------------------------------------------</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos"> 632</span></a>            <span class="n">flair_patterns</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos"> 633</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workspace_path</span><span class="p">,</span> <span class="n">patient_id</span><span class="p">,</span> <span class="s2">&quot;anat&quot;</span><span class="p">,</span> <span class="s2">&quot;*_flair.nii&quot;</span><span class="p">),</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos"> 634</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workspace_path</span><span class="p">,</span> <span class="n">patient_id</span><span class="p">,</span> <span class="s2">&quot;anat&quot;</span><span class="p">,</span> <span class="s2">&quot;*_flair.nii.gz&quot;</span><span class="p">)</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos"> 635</span></a>            <span class="p">]</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos"> 636</span></a>            <span class="n">flair_files</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos"> 637</span></a>            <span class="c1"># Search for FLAIR MRI files matching the defined patterns</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos"> 638</span></a>            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">flair_patterns</span><span class="p">:</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos"> 639</span></a>                <span class="n">flair_files</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos"> 640</span></a>            <span class="c1"># If more than one FLAIR file exists, mark for manual revision</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos"> 641</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">flair_files</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos"> 642</span></a>                <span class="n">need_revision</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos"> 643</span></a>            <span class="c1"># Store the relative path of the FLAIR file if found</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos"> 644</span></a>            <span class="n">patient_entry</span><span class="p">[</span><span class="s2">&quot;mri&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">flair_files</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">workspace_path</span><span class="p">)</span> <span class="k">if</span> <span class="n">flair_files</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos"> 645</span></a>
</span><span id="L-646"><a href="#L-646"><span class="linenos"> 646</span></a>            <span class="c1"># ----------------------------------------------------</span>
</span><span id="L-647"><a href="#L-647"><span class="linenos"> 647</span></a>            <span class="c1"># MRI Skull Stripped</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos"> 648</span></a>            <span class="c1"># ----------------------------------------------------</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos"> 649</span></a>            <span class="n">mri_str_patterns</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-650"><a href="#L-650"><span class="linenos"> 650</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workspace_path</span><span class="p">,</span> <span class="s2">&quot;derivatives&quot;</span><span class="p">,</span> <span class="s2">&quot;skullstrips&quot;</span><span class="p">,</span> <span class="n">patient_id</span><span class="p">,</span> <span class="s2">&quot;anat&quot;</span><span class="p">,</span> <span class="s2">&quot;*_brain.nii&quot;</span><span class="p">),</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos"> 651</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workspace_path</span><span class="p">,</span> <span class="s2">&quot;derivatives&quot;</span><span class="p">,</span> <span class="s2">&quot;skullstrips&quot;</span><span class="p">,</span> <span class="n">patient_id</span><span class="p">,</span> <span class="s2">&quot;anat&quot;</span><span class="p">,</span> <span class="s2">&quot;*_brain.nii.gz&quot;</span><span class="p">)</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos"> 652</span></a>            <span class="p">]</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos"> 653</span></a>            <span class="n">mri_str_files</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-654"><a href="#L-654"><span class="linenos"> 654</span></a>            <span class="c1"># Search for preprocessed (skull-stripped) MRI files</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos"> 655</span></a>            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">mri_str_patterns</span><span class="p">:</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos"> 656</span></a>                <span class="n">mri_str_files</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos"> 657</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mri_str_files</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-658"><a href="#L-658"><span class="linenos"> 658</span></a>                <span class="n">need_revision</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos"> 659</span></a>            <span class="n">patient_entry</span><span class="p">[</span><span class="s2">&quot;mri_str&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">mri_str_files</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">workspace_path</span><span class="p">)</span> <span class="k">if</span> <span class="n">mri_str_files</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos"> 660</span></a>
</span><span id="L-661"><a href="#L-661"><span class="linenos"> 661</span></a>            <span class="c1"># ----------------------------------------------------</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos"> 662</span></a>            <span class="c1"># Static PET (Session 01)</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos"> 663</span></a>            <span class="c1"># ----------------------------------------------------</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos"> 664</span></a>            <span class="n">pet_patterns</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-665"><a href="#L-665"><span class="linenos"> 665</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workspace_path</span><span class="p">,</span> <span class="n">patient_id</span><span class="p">,</span> <span class="s2">&quot;ses-01&quot;</span><span class="p">,</span> <span class="s2">&quot;pet&quot;</span><span class="p">,</span> <span class="s2">&quot;*_pet.nii&quot;</span><span class="p">),</span>
</span><span id="L-666"><a href="#L-666"><span class="linenos"> 666</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workspace_path</span><span class="p">,</span> <span class="n">patient_id</span><span class="p">,</span> <span class="s2">&quot;ses-01&quot;</span><span class="p">,</span> <span class="s2">&quot;pet&quot;</span><span class="p">,</span> <span class="s2">&quot;*_pet.nii.gz&quot;</span><span class="p">)</span>
</span><span id="L-667"><a href="#L-667"><span class="linenos"> 667</span></a>            <span class="p">]</span>
</span><span id="L-668"><a href="#L-668"><span class="linenos"> 668</span></a>            <span class="n">pet_files</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos"> 669</span></a>            <span class="c1"># Locate static PET scans</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos"> 670</span></a>            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pet_patterns</span><span class="p">:</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos"> 671</span></a>                <span class="n">pet_files</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos"> 672</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pet_files</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos"> 673</span></a>                <span class="n">need_revision</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-674"><a href="#L-674"><span class="linenos"> 674</span></a>            <span class="n">patient_entry</span><span class="p">[</span><span class="s2">&quot;pet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">pet_files</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">workspace_path</span><span class="p">)</span> <span class="k">if</span> <span class="n">pet_files</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos"> 675</span></a>
</span><span id="L-676"><a href="#L-676"><span class="linenos"> 676</span></a>            <span class="c1"># ----------------------------------------------------</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos"> 677</span></a>            <span class="c1"># Dynamic PET (4D, optional)</span>
</span><span id="L-678"><a href="#L-678"><span class="linenos"> 678</span></a>            <span class="c1"># ----------------------------------------------------</span>
</span><span id="L-679"><a href="#L-679"><span class="linenos"> 679</span></a>            <span class="n">pet4d_patterns</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-680"><a href="#L-680"><span class="linenos"> 680</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workspace_path</span><span class="p">,</span> <span class="n">patient_id</span><span class="p">,</span> <span class="s2">&quot;ses-02&quot;</span><span class="p">,</span> <span class="s2">&quot;pet&quot;</span><span class="p">,</span> <span class="s2">&quot;*_pet.nii&quot;</span><span class="p">),</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos"> 681</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workspace_path</span><span class="p">,</span> <span class="n">patient_id</span><span class="p">,</span> <span class="s2">&quot;ses-02&quot;</span><span class="p">,</span> <span class="s2">&quot;pet&quot;</span><span class="p">,</span> <span class="s2">&quot;*_pet.nii.gz&quot;</span><span class="p">)</span>
</span><span id="L-682"><a href="#L-682"><span class="linenos"> 682</span></a>            <span class="p">]</span>
</span><span id="L-683"><a href="#L-683"><span class="linenos"> 683</span></a>            <span class="n">pet4d_files</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-684"><a href="#L-684"><span class="linenos"> 684</span></a>            <span class="c1"># Locate dynamic PET files (4D data)</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos"> 685</span></a>            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pet4d_patterns</span><span class="p">:</span>
</span><span id="L-686"><a href="#L-686"><span class="linenos"> 686</span></a>                <span class="n">pet4d_files</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos"> 687</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pet4d_files</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-688"><a href="#L-688"><span class="linenos"> 688</span></a>                <span class="n">need_revision</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-689"><a href="#L-689"><span class="linenos"> 689</span></a>            <span class="n">pet4d_file</span> <span class="o">=</span> <span class="n">pet4d_files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">pet4d_files</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="L-690"><a href="#L-690"><span class="linenos"> 690</span></a>            <span class="n">patient_entry</span><span class="p">[</span><span class="s2">&quot;pet4d&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">pet4d_files</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">workspace_path</span><span class="p">)</span> <span class="k">if</span> <span class="n">pet4d_files</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos"> 691</span></a>
</span><span id="L-692"><a href="#L-692"><span class="linenos"> 692</span></a>            <span class="c1"># ----------------------------------------------------</span>
</span><span id="L-693"><a href="#L-693"><span class="linenos"> 693</span></a>            <span class="c1"># PET JSON sidecar (metadata for dynamic PET)</span>
</span><span id="L-694"><a href="#L-694"><span class="linenos"> 694</span></a>            <span class="c1"># ----------------------------------------------------</span>
</span><span id="L-695"><a href="#L-695"><span class="linenos"> 695</span></a>            <span class="n">pet_json_file</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-696"><a href="#L-696"><span class="linenos"> 696</span></a>            <span class="k">if</span> <span class="n">pet4d_file</span><span class="p">:</span>
</span><span id="L-697"><a href="#L-697"><span class="linenos"> 697</span></a>                <span class="c1"># Derive the expected .json filename from the PET file prefix</span>
</span><span id="L-698"><a href="#L-698"><span class="linenos"> 698</span></a>                <span class="n">basename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">pet4d_file</span><span class="p">)</span>
</span><span id="L-699"><a href="#L-699"><span class="linenos"> 699</span></a>                <span class="n">stem_no_ext</span> <span class="o">=</span> <span class="n">basename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-700"><a href="#L-700"><span class="linenos"> 700</span></a>                <span class="n">candidate</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">pet4d_file</span><span class="p">),</span> <span class="n">stem_no_ext</span> <span class="o">+</span> <span class="s1">&#39;.json&#39;</span><span class="p">)</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos"> 701</span></a>                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">candidate</span><span class="p">):</span>
</span><span id="L-702"><a href="#L-702"><span class="linenos"> 702</span></a>                    <span class="n">pet_json_file</span> <span class="o">=</span> <span class="n">candidate</span>
</span><span id="L-703"><a href="#L-703"><span class="linenos"> 703</span></a>            <span class="c1"># Store relative path to PET JSON file if it exists</span>
</span><span id="L-704"><a href="#L-704"><span class="linenos"> 704</span></a>            <span class="n">patient_entry</span><span class="p">[</span><span class="s2">&quot;pet4d_json&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">pet_json_file</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">workspace_path</span><span class="p">)</span> <span class="k">if</span> <span class="n">pet_json_file</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="L-705"><a href="#L-705"><span class="linenos"> 705</span></a>
</span><span id="L-706"><a href="#L-706"><span class="linenos"> 706</span></a>            <span class="c1"># ----------------------------------------------------</span>
</span><span id="L-707"><a href="#L-707"><span class="linenos"> 707</span></a>            <span class="c1"># Tumor MRI Mask (manual or automated)</span>
</span><span id="L-708"><a href="#L-708"><span class="linenos"> 708</span></a>            <span class="c1"># ----------------------------------------------------</span>
</span><span id="L-709"><a href="#L-709"><span class="linenos"> 709</span></a>            <span class="n">tumor_patterns</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-710"><a href="#L-710"><span class="linenos"> 710</span></a>                <span class="c1"># Manual segmentation masks</span>
</span><span id="L-711"><a href="#L-711"><span class="linenos"> 711</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workspace_path</span><span class="p">,</span> <span class="s2">&quot;derivatives&quot;</span><span class="p">,</span> <span class="s2">&quot;manual_masks&quot;</span><span class="p">,</span> <span class="n">patient_id</span><span class="p">,</span> <span class="s2">&quot;anat&quot;</span><span class="p">,</span> <span class="s2">&quot;*_mask.nii&quot;</span><span class="p">),</span>
</span><span id="L-712"><a href="#L-712"><span class="linenos"> 712</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workspace_path</span><span class="p">,</span> <span class="s2">&quot;derivatives&quot;</span><span class="p">,</span> <span class="s2">&quot;manual_masks&quot;</span><span class="p">,</span> <span class="n">patient_id</span><span class="p">,</span> <span class="s2">&quot;anat&quot;</span><span class="p">,</span> <span class="s2">&quot;*_mask.nii.gz&quot;</span><span class="p">),</span>
</span><span id="L-713"><a href="#L-713"><span class="linenos"> 713</span></a>                <span class="c1"># Deep learning-based segmentations</span>
</span><span id="L-714"><a href="#L-714"><span class="linenos"> 714</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workspace_path</span><span class="p">,</span> <span class="s2">&quot;derivatives&quot;</span><span class="p">,</span> <span class="s2">&quot;deep_learning_seg&quot;</span><span class="p">,</span> <span class="n">patient_id</span><span class="p">,</span> <span class="s2">&quot;anat&quot;</span><span class="p">,</span>
</span><span id="L-715"><a href="#L-715"><span class="linenos"> 715</span></a>                             <span class="s2">&quot;*_seg.nii&quot;</span><span class="p">),</span>
</span><span id="L-716"><a href="#L-716"><span class="linenos"> 716</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workspace_path</span><span class="p">,</span> <span class="s2">&quot;derivatives&quot;</span><span class="p">,</span> <span class="s2">&quot;deep_learning_seg&quot;</span><span class="p">,</span> <span class="n">patient_id</span><span class="p">,</span> <span class="s2">&quot;anat&quot;</span><span class="p">,</span>
</span><span id="L-717"><a href="#L-717"><span class="linenos"> 717</span></a>                             <span class="s2">&quot;*_seg.nii.gz&quot;</span><span class="p">)</span>
</span><span id="L-718"><a href="#L-718"><span class="linenos"> 718</span></a>            <span class="p">]</span>
</span><span id="L-719"><a href="#L-719"><span class="linenos"> 719</span></a>            <span class="n">tumor_files</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-720"><a href="#L-720"><span class="linenos"> 720</span></a>            <span class="c1"># Search for tumor mask files</span>
</span><span id="L-721"><a href="#L-721"><span class="linenos"> 721</span></a>            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">tumor_patterns</span><span class="p">:</span>
</span><span id="L-722"><a href="#L-722"><span class="linenos"> 722</span></a>                <span class="n">tumor_files</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
</span><span id="L-723"><a href="#L-723"><span class="linenos"> 723</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tumor_files</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-724"><a href="#L-724"><span class="linenos"> 724</span></a>                <span class="n">need_revision</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-725"><a href="#L-725"><span class="linenos"> 725</span></a>            <span class="n">patient_entry</span><span class="p">[</span><span class="s2">&quot;tumor_mri&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">tumor_files</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">workspace_path</span><span class="p">)</span> <span class="k">if</span> <span class="n">tumor_files</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="L-726"><a href="#L-726"><span class="linenos"> 726</span></a>
</span><span id="L-727"><a href="#L-727"><span class="linenos"> 727</span></a>            <span class="c1"># Add the final review flag to indicate if manual review is needed</span>
</span><span id="L-728"><a href="#L-728"><span class="linenos"> 728</span></a>            <span class="n">patient_entry</span><span class="p">[</span><span class="s2">&quot;need_revision&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">need_revision</span>
</span><span id="L-729"><a href="#L-729"><span class="linenos"> 729</span></a>
</span><span id="L-730"><a href="#L-730"><span class="linenos"> 730</span></a>            <span class="c1"># Store the patient&#39;s configuration in the main config dictionary</span>
</span><span id="L-731"><a href="#L-731"><span class="linenos"> 731</span></a>            <span class="n">config</span><span class="p">[</span><span class="n">patient_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">patient_entry</span>
</span><span id="L-732"><a href="#L-732"><span class="linenos"> 732</span></a>
</span><span id="L-733"><a href="#L-733"><span class="linenos"> 733</span></a>        <span class="c1"># ----------------------------------------------------</span>
</span><span id="L-734"><a href="#L-734"><span class="linenos"> 734</span></a>        <span class="c1"># Create and save the pipeline configuration JSON file</span>
</span><span id="L-735"><a href="#L-735"><span class="linenos"> 735</span></a>        <span class="c1"># ----------------------------------------------------</span>
</span><span id="L-736"><a href="#L-736"><span class="linenos"> 736</span></a>        <span class="n">pipeline_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workspace_path</span><span class="p">,</span> <span class="s2">&quot;pipeline&quot;</span><span class="p">)</span>
</span><span id="L-737"><a href="#L-737"><span class="linenos"> 737</span></a>
</span><span id="L-738"><a href="#L-738"><span class="linenos"> 738</span></a>        <span class="c1"># Create the &#39;pipeline&#39; directory if it doesn&#39;t exist</span>
</span><span id="L-739"><a href="#L-739"><span class="linenos"> 739</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">pipeline_dir</span><span class="p">):</span>
</span><span id="L-740"><a href="#L-740"><span class="linenos"> 740</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">pipeline_dir</span><span class="p">)</span>
</span><span id="L-741"><a href="#L-741"><span class="linenos"> 741</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created pipeline directory: </span><span class="si">{</span><span class="n">pipeline_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-742"><a href="#L-742"><span class="linenos"> 742</span></a>
</span><span id="L-743"><a href="#L-743"><span class="linenos"> 743</span></a>        <span class="c1"># Determine the next sequential ID number (e.g., 01, 02, 03, ...)</span>
</span><span id="L-744"><a href="#L-744"><span class="linenos"> 744</span></a>        <span class="n">config_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_next_config_id</span><span class="p">(</span><span class="n">pipeline_dir</span><span class="p">)</span>
</span><span id="L-745"><a href="#L-745"><span class="linenos"> 745</span></a>
</span><span id="L-746"><a href="#L-746"><span class="linenos"> 746</span></a>        <span class="c1"># Build the filename using the sequential ID</span>
</span><span id="L-747"><a href="#L-747"><span class="linenos"> 747</span></a>        <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">config_id</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">_config.json&quot;</span>
</span><span id="L-748"><a href="#L-748"><span class="linenos"> 748</span></a>        <span class="n">output_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pipeline_dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</span><span id="L-749"><a href="#L-749"><span class="linenos"> 749</span></a>
</span><span id="L-750"><a href="#L-750"><span class="linenos"> 750</span></a>        <span class="c1"># Save the configuration dictionary as a formatted JSON file</span>
</span><span id="L-751"><a href="#L-751"><span class="linenos"> 751</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-752"><a href="#L-752"><span class="linenos"> 752</span></a>            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</span><span id="L-753"><a href="#L-753"><span class="linenos"> 753</span></a>
</span><span id="L-754"><a href="#L-754"><span class="linenos"> 754</span></a>        <span class="c1"># Log the output path for reference</span>
</span><span id="L-755"><a href="#L-755"><span class="linenos"> 755</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pipeline configuration saved to: </span><span class="si">{</span><span class="n">output_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-756"><a href="#L-756"><span class="linenos"> 756</span></a>
</span><span id="L-757"><a href="#L-757"><span class="linenos"> 757</span></a>        <span class="c1"># Return the full path to the generated configuration file</span>
</span><span id="L-758"><a href="#L-758"><span class="linenos"> 758</span></a>        <span class="k">return</span> <span class="n">output_path</span>
</span><span id="L-759"><a href="#L-759"><span class="linenos"> 759</span></a>
</span><span id="L-760"><a href="#L-760"><span class="linenos"> 760</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_next_config_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pipeline_dir</span><span class="p">):</span>
</span><span id="L-761"><a href="#L-761"><span class="linenos"> 761</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Find the next available sequential numeric ID for configuration files.</span>
</span><span id="L-762"><a href="#L-762"><span class="linenos"> 762</span></a>
</span><span id="L-763"><a href="#L-763"><span class="linenos"> 763</span></a><span class="sd">        This method scans the pipeline directory for existing configuration files</span>
</span><span id="L-764"><a href="#L-764"><span class="linenos"> 764</span></a><span class="sd">        that match the pattern `*_config.json`. It extracts the numeric prefix from</span>
</span><span id="L-765"><a href="#L-765"><span class="linenos"> 765</span></a><span class="sd">        each file name (e.g., `12_config.json`  12) and returns the next available</span>
</span><span id="L-766"><a href="#L-766"><span class="linenos"> 766</span></a><span class="sd">        number in sequence.</span>
</span><span id="L-767"><a href="#L-767"><span class="linenos"> 767</span></a>
</span><span id="L-768"><a href="#L-768"><span class="linenos"> 768</span></a><span class="sd">        Args:</span>
</span><span id="L-769"><a href="#L-769"><span class="linenos"> 769</span></a><span class="sd">            pipeline_dir (str): Path to the pipeline directory where config files are stored.</span>
</span><span id="L-770"><a href="#L-770"><span class="linenos"> 770</span></a>
</span><span id="L-771"><a href="#L-771"><span class="linenos"> 771</span></a><span class="sd">        Returns:</span>
</span><span id="L-772"><a href="#L-772"><span class="linenos"> 772</span></a><span class="sd">            int: The next available numeric ID for a new configuration file.</span>
</span><span id="L-773"><a href="#L-773"><span class="linenos"> 773</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-774"><a href="#L-774"><span class="linenos"> 774</span></a>        <span class="c1"># Pattern used to search for existing pipeline configuration files</span>
</span><span id="L-775"><a href="#L-775"><span class="linenos"> 775</span></a>        <span class="n">config_pattern</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pipeline_dir</span><span class="p">,</span> <span class="s2">&quot;*_config.json&quot;</span><span class="p">)</span>
</span><span id="L-776"><a href="#L-776"><span class="linenos"> 776</span></a>        <span class="n">existing_configs</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">config_pattern</span><span class="p">)</span>
</span><span id="L-777"><a href="#L-777"><span class="linenos"> 777</span></a>
</span><span id="L-778"><a href="#L-778"><span class="linenos"> 778</span></a>        <span class="c1"># If no config files exist, start numbering from 1</span>
</span><span id="L-779"><a href="#L-779"><span class="linenos"> 779</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">existing_configs</span><span class="p">:</span>
</span><span id="L-780"><a href="#L-780"><span class="linenos"> 780</span></a>            <span class="k">return</span> <span class="mi">1</span>
</span><span id="L-781"><a href="#L-781"><span class="linenos"> 781</span></a>
</span><span id="L-782"><a href="#L-782"><span class="linenos"> 782</span></a>        <span class="n">existing_ids</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Stores all numeric IDs extracted from existing filenames</span>
</span><span id="L-783"><a href="#L-783"><span class="linenos"> 783</span></a>
</span><span id="L-784"><a href="#L-784"><span class="linenos"> 784</span></a>        <span class="c1"># Iterate through all existing config files to extract their numeric IDs</span>
</span><span id="L-785"><a href="#L-785"><span class="linenos"> 785</span></a>        <span class="k">for</span> <span class="n">config_file</span> <span class="ow">in</span> <span class="n">existing_configs</span><span class="p">:</span>
</span><span id="L-786"><a href="#L-786"><span class="linenos"> 786</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span>  <span class="c1"># Example: &quot;12_config.json&quot;</span>
</span><span id="L-787"><a href="#L-787"><span class="linenos"> 787</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-788"><a href="#L-788"><span class="linenos"> 788</span></a>                <span class="c1"># Extract the numeric part before &quot;_config.json&quot;</span>
</span><span id="L-789"><a href="#L-789"><span class="linenos"> 789</span></a>                <span class="n">id_str</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1">#  &quot;12&quot;</span>
</span><span id="L-790"><a href="#L-790"><span class="linenos"> 790</span></a>                <span class="n">config_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">id_str</span><span class="p">)</span>  <span class="c1"># Convert to integer</span>
</span><span id="L-791"><a href="#L-791"><span class="linenos"> 791</span></a>                <span class="n">existing_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">config_id</span><span class="p">)</span>
</span><span id="L-792"><a href="#L-792"><span class="linenos"> 792</span></a>            <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">):</span>
</span><span id="L-793"><a href="#L-793"><span class="linenos"> 793</span></a>                <span class="c1"># Skip any files that don&#39;t follow the expected naming format</span>
</span><span id="L-794"><a href="#L-794"><span class="linenos"> 794</span></a>                <span class="k">continue</span>
</span><span id="L-795"><a href="#L-795"><span class="linenos"> 795</span></a>
</span><span id="L-796"><a href="#L-796"><span class="linenos"> 796</span></a>        <span class="c1"># If no valid numeric IDs were found, default to 1</span>
</span><span id="L-797"><a href="#L-797"><span class="linenos"> 797</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">existing_ids</span><span class="p">:</span>
</span><span id="L-798"><a href="#L-798"><span class="linenos"> 798</span></a>            <span class="k">return</span> <span class="mi">1</span>
</span><span id="L-799"><a href="#L-799"><span class="linenos"> 799</span></a>
</span><span id="L-800"><a href="#L-800"><span class="linenos"> 800</span></a>        <span class="c1"># Return the next sequential ID (maximum existing + 1)</span>
</span><span id="L-801"><a href="#L-801"><span class="linenos"> 801</span></a>        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">existing_ids</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-802"><a href="#L-802"><span class="linenos"> 802</span></a>
</span><span id="L-803"><a href="#L-803"><span class="linenos"> 803</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">on_enter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-804"><a href="#L-804"><span class="linenos"> 804</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Triggered when entering this page of the application.</span>
</span><span id="L-805"><a href="#L-805"><span class="linenos"> 805</span></a>
</span><span id="L-806"><a href="#L-806"><span class="linenos"> 806</span></a><span class="sd">        Used to refresh patient statuses when the user navigates to this page.</span>
</span><span id="L-807"><a href="#L-807"><span class="linenos"> 807</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-808"><a href="#L-808"><span class="linenos"> 808</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_refresh_patient_status</span><span class="p">()</span>
</span><span id="L-809"><a href="#L-809"><span class="linenos"> 809</span></a>
</span><span id="L-810"><a href="#L-810"><span class="linenos"> 810</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">is_ready_to_advance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-811"><a href="#L-811"><span class="linenos"> 811</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check whether the application can proceed to the next page.</span>
</span><span id="L-812"><a href="#L-812"><span class="linenos"> 812</span></a>
</span><span id="L-813"><a href="#L-813"><span class="linenos"> 813</span></a><span class="sd">        Returns:</span>
</span><span id="L-814"><a href="#L-814"><span class="linenos"> 814</span></a><span class="sd">            bool: True if at least one patient has been selected, otherwise False.</span>
</span><span id="L-815"><a href="#L-815"><span class="linenos"> 815</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-816"><a href="#L-816"><span class="linenos"> 816</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_patients</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-817"><a href="#L-817"><span class="linenos"> 817</span></a>
</span><span id="L-818"><a href="#L-818"><span class="linenos"> 818</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">is_ready_to_go_back</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-819"><a href="#L-819"><span class="linenos"> 819</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check whether the user can navigate back to the previous page.</span>
</span><span id="L-820"><a href="#L-820"><span class="linenos"> 820</span></a>
</span><span id="L-821"><a href="#L-821"><span class="linenos"> 821</span></a><span class="sd">        Returns:</span>
</span><span id="L-822"><a href="#L-822"><span class="linenos"> 822</span></a><span class="sd">            bool: Always True (navigation backward is always allowed).</span>
</span><span id="L-823"><a href="#L-823"><span class="linenos"> 823</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-824"><a href="#L-824"><span class="linenos"> 824</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-825"><a href="#L-825"><span class="linenos"> 825</span></a>
</span><span id="L-826"><a href="#L-826"><span class="linenos"> 826</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
</span><span id="L-827"><a href="#L-827"><span class="linenos"> 827</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Proceed to the next page in the pipeline process.</span>
</span><span id="L-828"><a href="#L-828"><span class="linenos"> 828</span></a>
</span><span id="L-829"><a href="#L-829"><span class="linenos"> 829</span></a><span class="sd">        This method builds the pipeline configuration and navigates</span>
</span><span id="L-830"><a href="#L-830"><span class="linenos"> 830</span></a><span class="sd">        to the review page (`PipelineReviewPage`).</span>
</span><span id="L-831"><a href="#L-831"><span class="linenos"> 831</span></a>
</span><span id="L-832"><a href="#L-832"><span class="linenos"> 832</span></a><span class="sd">        Args:</span>
</span><span id="L-833"><a href="#L-833"><span class="linenos"> 833</span></a><span class="sd">            context (dict): Application context containing state and shared data.</span>
</span><span id="L-834"><a href="#L-834"><span class="linenos"> 834</span></a>
</span><span id="L-835"><a href="#L-835"><span class="linenos"> 835</span></a><span class="sd">        Returns:</span>
</span><span id="L-836"><a href="#L-836"><span class="linenos"> 836</span></a><span class="sd">            Page: The next page to display.</span>
</span><span id="L-837"><a href="#L-837"><span class="linenos"> 837</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-838"><a href="#L-838"><span class="linenos"> 838</span></a>        <span class="c1"># Generate a new pipeline configuration file before continuing</span>
</span><span id="L-839"><a href="#L-839"><span class="linenos"> 839</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_build_pipeline_config</span><span class="p">()</span>
</span><span id="L-840"><a href="#L-840"><span class="linenos"> 840</span></a>
</span><span id="L-841"><a href="#L-841"><span class="linenos"> 841</span></a>        <span class="c1"># If a next page already exists, reuse it</span>
</span><span id="L-842"><a href="#L-842"><span class="linenos"> 842</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_page</span><span class="p">:</span>
</span><span id="L-843"><a href="#L-843"><span class="linenos"> 843</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next_page</span><span class="o">.</span><span class="n">on_enter</span><span class="p">()</span>
</span><span id="L-844"><a href="#L-844"><span class="linenos"> 844</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_page</span>
</span><span id="L-845"><a href="#L-845"><span class="linenos"> 845</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-846"><a href="#L-846"><span class="linenos"> 846</span></a>            <span class="c1"># Otherwise, create a new review page and register it in navigation history</span>
</span><span id="L-847"><a href="#L-847"><span class="linenos"> 847</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next_page</span> <span class="o">=</span> <span class="n">PipelineReviewPage</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span><span id="L-848"><a href="#L-848"><span class="linenos"> 848</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s2">&quot;history&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">next_page</span><span class="p">)</span>
</span><span id="L-849"><a href="#L-849"><span class="linenos"> 849</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next_page</span><span class="o">.</span><span class="n">on_enter</span><span class="p">()</span>
</span><span id="L-850"><a href="#L-850"><span class="linenos"> 850</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_page</span>
</span><span id="L-851"><a href="#L-851"><span class="linenos"> 851</span></a>
</span><span id="L-852"><a href="#L-852"><span class="linenos"> 852</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">back</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-853"><a href="#L-853"><span class="linenos"> 853</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Navigate back to the previous page.</span>
</span><span id="L-854"><a href="#L-854"><span class="linenos"> 854</span></a>
</span><span id="L-855"><a href="#L-855"><span class="linenos"> 855</span></a><span class="sd">        Returns:</span>
</span><span id="L-856"><a href="#L-856"><span class="linenos"> 856</span></a><span class="sd">            Page or None: The previous page if available, otherwise None.</span>
</span><span id="L-857"><a href="#L-857"><span class="linenos"> 857</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-858"><a href="#L-858"><span class="linenos"> 858</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_page</span><span class="p">:</span>
</span><span id="L-859"><a href="#L-859"><span class="linenos"> 859</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">previous_page</span><span class="o">.</span><span class="n">on_enter</span><span class="p">()</span>
</span><span id="L-860"><a href="#L-860"><span class="linenos"> 860</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_page</span>
</span><span id="L-861"><a href="#L-861"><span class="linenos"> 861</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-862"><a href="#L-862"><span class="linenos"> 862</span></a>
</span><span id="L-863"><a href="#L-863"><span class="linenos"> 863</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_selected_patients</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-864"><a href="#L-864"><span class="linenos"> 864</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve the list of currently selected patients.</span>
</span><span id="L-865"><a href="#L-865"><span class="linenos"> 865</span></a>
</span><span id="L-866"><a href="#L-866"><span class="linenos"> 866</span></a><span class="sd">        Returns:</span>
</span><span id="L-867"><a href="#L-867"><span class="linenos"> 867</span></a><span class="sd">            list[str]: A list of selected patient IDs.</span>
</span><span id="L-868"><a href="#L-868"><span class="linenos"> 868</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-869"><a href="#L-869"><span class="linenos"> 869</span></a>        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_patients</span><span class="p">)</span>
</span><span id="L-870"><a href="#L-870"><span class="linenos"> 870</span></a>
</span><span id="L-871"><a href="#L-871"><span class="linenos"> 871</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_eligible_patients</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-872"><a href="#L-872"><span class="linenos"> 872</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve the list of patients marked as eligible.</span>
</span><span id="L-873"><a href="#L-873"><span class="linenos"> 873</span></a>
</span><span id="L-874"><a href="#L-874"><span class="linenos"> 874</span></a><span class="sd">        Returns:</span>
</span><span id="L-875"><a href="#L-875"><span class="linenos"> 875</span></a><span class="sd">            list[str]: A list of patient IDs where `status[&#39;eligible&#39;]` is True.</span>
</span><span id="L-876"><a href="#L-876"><span class="linenos"> 876</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-877"><a href="#L-877"><span class="linenos"> 877</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">pid</span> <span class="k">for</span> <span class="n">pid</span><span class="p">,</span> <span class="n">status</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">patient_status</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">status</span><span class="p">[</span><span class="s1">&#39;eligible&#39;</span><span class="p">]]</span>
</span><span id="L-878"><a href="#L-878"><span class="linenos"> 878</span></a>
</span><span id="L-879"><a href="#L-879"><span class="linenos"> 879</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_patient_status_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-880"><a href="#L-880"><span class="linenos"> 880</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a summary of the current patient status.</span>
</span><span id="L-881"><a href="#L-881"><span class="linenos"> 881</span></a>
</span><span id="L-882"><a href="#L-882"><span class="linenos"> 882</span></a><span class="sd">        This method calculates basic statistics about the patients in the current</span>
</span><span id="L-883"><a href="#L-883"><span class="linenos"> 883</span></a><span class="sd">        workspace, including total number, number of eligible patients, and number</span>
</span><span id="L-884"><a href="#L-884"><span class="linenos"> 884</span></a><span class="sd">        of selected patients. It also computes how many are not eligible.</span>
</span><span id="L-885"><a href="#L-885"><span class="linenos"> 885</span></a>
</span><span id="L-886"><a href="#L-886"><span class="linenos"> 886</span></a><span class="sd">        Returns:</span>
</span><span id="L-887"><a href="#L-887"><span class="linenos"> 887</span></a><span class="sd">            dict: A dictionary containing patient status counts:</span>
</span><span id="L-888"><a href="#L-888"><span class="linenos"> 888</span></a><span class="sd">                - &#39;total&#39;: Total number of patients</span>
</span><span id="L-889"><a href="#L-889"><span class="linenos"> 889</span></a><span class="sd">                - &#39;eligible&#39;: Number of eligible patients</span>
</span><span id="L-890"><a href="#L-890"><span class="linenos"> 890</span></a><span class="sd">                - &#39;selected&#39;: Number of currently selected patients</span>
</span><span id="L-891"><a href="#L-891"><span class="linenos"> 891</span></a><span class="sd">                - &#39;not_eligible&#39;: Number of non-eligible patients</span>
</span><span id="L-892"><a href="#L-892"><span class="linenos"> 892</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-893"><a href="#L-893"><span class="linenos"> 893</span></a>        <span class="n">total</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">patient_status</span><span class="p">)</span>  <span class="c1"># Count total patients being tracked</span>
</span><span id="L-894"><a href="#L-894"><span class="linenos"> 894</span></a>        <span class="n">eligible</span> <span class="o">=</span> <span class="nb">len</span><span class="p">([</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">patient_status</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;eligible&#39;</span><span class="p">]])</span>  <span class="c1"># Count eligible ones</span>
</span><span id="L-895"><a href="#L-895"><span class="linenos"> 895</span></a>        <span class="n">selected</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_patients</span><span class="p">)</span>  <span class="c1"># Count selected patients</span>
</span><span id="L-896"><a href="#L-896"><span class="linenos"> 896</span></a>
</span><span id="L-897"><a href="#L-897"><span class="linenos"> 897</span></a>        <span class="c1"># Return a dictionary summarizing all relevant counts</span>
</span><span id="L-898"><a href="#L-898"><span class="linenos"> 898</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="L-899"><a href="#L-899"><span class="linenos"> 899</span></a>            <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="n">total</span><span class="p">,</span>
</span><span id="L-900"><a href="#L-900"><span class="linenos"> 900</span></a>            <span class="s1">&#39;eligible&#39;</span><span class="p">:</span> <span class="n">eligible</span><span class="p">,</span>
</span><span id="L-901"><a href="#L-901"><span class="linenos"> 901</span></a>            <span class="s1">&#39;selected&#39;</span><span class="p">:</span> <span class="n">selected</span><span class="p">,</span>
</span><span id="L-902"><a href="#L-902"><span class="linenos"> 902</span></a>            <span class="s1">&#39;not_eligible&#39;</span><span class="p">:</span> <span class="n">total</span> <span class="o">-</span> <span class="n">eligible</span>
</span><span id="L-903"><a href="#L-903"><span class="linenos"> 903</span></a>        <span class="p">}</span>
</span><span id="L-904"><a href="#L-904"><span class="linenos"> 904</span></a>
</span><span id="L-905"><a href="#L-905"><span class="linenos"> 905</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">reset_page</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-906"><a href="#L-906"><span class="linenos"> 906</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Completely reset the current page.</span>
</span><span id="L-907"><a href="#L-907"><span class="linenos"> 907</span></a>
</span><span id="L-908"><a href="#L-908"><span class="linenos"> 908</span></a><span class="sd">        This method clears the UI grid, removes all patient-related widgets,</span>
</span><span id="L-909"><a href="#L-909"><span class="linenos"> 909</span></a><span class="sd">        resets the internal data structures tracking patient selection and status,</span>
</span><span id="L-910"><a href="#L-910"><span class="linenos"> 910</span></a><span class="sd">        and then reloads the list of patients.</span>
</span><span id="L-911"><a href="#L-911"><span class="linenos"> 911</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-912"><a href="#L-912"><span class="linenos"> 912</span></a>        <span class="c1"># Clear all widgets from the grid layout</span>
</span><span id="L-913"><a href="#L-913"><span class="linenos"> 913</span></a>        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_layout</span><span class="o">.</span><span class="n">count</span><span class="p">():</span>
</span><span id="L-914"><a href="#L-914"><span class="linenos"> 914</span></a>            <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_layout</span><span class="o">.</span><span class="n">takeAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-915"><a href="#L-915"><span class="linenos"> 915</span></a>            <span class="n">widget</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span>
</span><span id="L-916"><a href="#L-916"><span class="linenos"> 916</span></a>            <span class="k">if</span> <span class="n">widget</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-917"><a href="#L-917"><span class="linenos"> 917</span></a>                <span class="n">widget</span><span class="o">.</span><span class="n">setParent</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>  <span class="c1"># Detach widget from layout</span>
</span><span id="L-918"><a href="#L-918"><span class="linenos"> 918</span></a>                <span class="n">widget</span><span class="o">.</span><span class="n">deleteLater</span><span class="p">()</span>  <span class="c1"># Schedule for deletion</span>
</span><span id="L-919"><a href="#L-919"><span class="linenos"> 919</span></a>
</span><span id="L-920"><a href="#L-920"><span class="linenos"> 920</span></a>        <span class="c1"># Reset all patient-related states</span>
</span><span id="L-921"><a href="#L-921"><span class="linenos"> 921</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">selected_patients</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>  <span class="c1"># Clear selected patients</span>
</span><span id="L-922"><a href="#L-922"><span class="linenos"> 922</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">patient_buttons</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>  <span class="c1"># Clear patient button references</span>
</span><span id="L-923"><a href="#L-923"><span class="linenos"> 923</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">patient_status</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>  <span class="c1"># Clear patient status dictionary</span>
</span><span id="L-924"><a href="#L-924"><span class="linenos"> 924</span></a>
</span><span id="L-925"><a href="#L-925"><span class="linenos"> 925</span></a>        <span class="c1"># Reload all patient data from the workspace</span>
</span><span id="L-926"><a href="#L-926"><span class="linenos"> 926</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_load_patients</span><span class="p">()</span>
</span><span id="L-927"><a href="#L-927"><span class="linenos"> 927</span></a>
</span><span id="L-928"><a href="#L-928"><span class="linenos"> 928</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">resizeEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
</span><span id="L-929"><a href="#L-929"><span class="linenos"> 929</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Make the interface responsive based on the window height.</span>
</span><span id="L-930"><a href="#L-930"><span class="linenos"> 930</span></a>
</span><span id="L-931"><a href="#L-931"><span class="linenos"> 931</span></a><span class="sd">        This event handler adjusts font sizes, button padding, and layout proportions</span>
</span><span id="L-932"><a href="#L-932"><span class="linenos"> 932</span></a><span class="sd">        dynamically when the main window is resized. It ensures usability and readability</span>
</span><span id="L-933"><a href="#L-933"><span class="linenos"> 933</span></a><span class="sd">        for both small and large window sizes.</span>
</span><span id="L-934"><a href="#L-934"><span class="linenos"> 934</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-935"><a href="#L-935"><span class="linenos"> 935</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">resizeEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</span><span id="L-936"><a href="#L-936"><span class="linenos"> 936</span></a>
</span><span id="L-937"><a href="#L-937"><span class="linenos"> 937</span></a>        <span class="c1"># Update column count dynamically based on width</span>
</span><span id="L-938"><a href="#L-938"><span class="linenos"> 938</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_update_column_count</span><span class="p">()</span>
</span><span id="L-939"><a href="#L-939"><span class="linenos"> 939</span></a>
</span><span id="L-940"><a href="#L-940"><span class="linenos"> 940</span></a>        <span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">()</span>  <span class="c1"># Current window height</span>
</span><span id="L-941"><a href="#L-941"><span class="linenos"> 941</span></a>
</span><span id="L-942"><a href="#L-942"><span class="linenos"> 942</span></a>        <span class="c1"># Adjust UI style dynamically for small or large window height</span>
</span><span id="L-943"><a href="#L-943"><span class="linenos"> 943</span></a>        <span class="k">if</span> <span class="n">height</span> <span class="o">&lt;</span> <span class="mi">500</span><span class="p">:</span>
</span><span id="L-944"><a href="#L-944"><span class="linenos"> 944</span></a>            <span class="c1"># Compact layout for small windows</span>
</span><span id="L-945"><a href="#L-945"><span class="linenos"> 945</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;font-size: 14px; font-weight: bold; margin-bottom: 5px;&quot;</span><span class="p">)</span>
</span><span id="L-946"><a href="#L-946"><span class="linenos"> 946</span></a>            <span class="n">btn_padding</span> <span class="o">=</span> <span class="s2">&quot;5px 10px&quot;</span>
</span><span id="L-947"><a href="#L-947"><span class="linenos"> 947</span></a>            <span class="n">font_size_btn</span> <span class="o">=</span> <span class="mi">11</span>
</span><span id="L-948"><a href="#L-948"><span class="linenos"> 948</span></a>            <span class="n">max_pill_height</span> <span class="o">=</span> <span class="mi">70</span>
</span><span id="L-949"><a href="#L-949"><span class="linenos"> 949</span></a>            <span class="n">font_size_title</span> <span class="o">=</span> <span class="mi">12</span>
</span><span id="L-950"><a href="#L-950"><span class="linenos"> 950</span></a>            <span class="n">font_size_value</span> <span class="o">=</span> <span class="mi">14</span>
</span><span id="L-951"><a href="#L-951"><span class="linenos"> 951</span></a>            <span class="n">font_size_label</span> <span class="o">=</span> <span class="mi">10</span>
</span><span id="L-952"><a href="#L-952"><span class="linenos"> 952</span></a>            <span class="n">max_pill_height</span> <span class="o">=</span> <span class="mi">60</span>
</span><span id="L-953"><a href="#L-953"><span class="linenos"> 953</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-954"><a href="#L-954"><span class="linenos"> 954</span></a>            <span class="c1"># Normal layout for larger windows</span>
</span><span id="L-955"><a href="#L-955"><span class="linenos"> 955</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;font-size: 18px; font-weight: bold; margin-bottom: 10px;&quot;</span><span class="p">)</span>
</span><span id="L-956"><a href="#L-956"><span class="linenos"> 956</span></a>            <span class="n">btn_padding</span> <span class="o">=</span> <span class="s2">&quot;10px 20px&quot;</span>
</span><span id="L-957"><a href="#L-957"><span class="linenos"> 957</span></a>            <span class="n">font_size_btn</span> <span class="o">=</span> <span class="mi">13</span>
</span><span id="L-958"><a href="#L-958"><span class="linenos"> 958</span></a>            <span class="n">font_size_title</span> <span class="o">=</span> <span class="mi">16</span>
</span><span id="L-959"><a href="#L-959"><span class="linenos"> 959</span></a>            <span class="n">font_size_value</span> <span class="o">=</span> <span class="mi">20</span>
</span><span id="L-960"><a href="#L-960"><span class="linenos"> 960</span></a>            <span class="n">font_size_label</span> <span class="o">=</span> <span class="mi">13</span>
</span><span id="L-961"><a href="#L-961"><span class="linenos"> 961</span></a>            <span class="n">max_pill_height</span> <span class="o">=</span> <span class="mi">100</span>
</span><span id="L-962"><a href="#L-962"><span class="linenos"> 962</span></a>
</span><span id="L-963"><a href="#L-963"><span class="linenos"> 963</span></a>        <span class="c1"># Update button styles dynamically</span>
</span><span id="L-964"><a href="#L-964"><span class="linenos"> 964</span></a>        <span class="k">for</span> <span class="n">btn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">buttons</span><span class="p">:</span>
</span><span id="L-965"><a href="#L-965"><span class="linenos"> 965</span></a>            <span class="n">btn</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="L-966"><a href="#L-966"><span class="linenos"> 966</span></a><span class="s2">                QPushButton </span><span class="se">{{</span>
</span><span id="L-967"><a href="#L-967"><span class="linenos"> 967</span></a><span class="s2">                    background-color: #e0e0e0;</span>
</span><span id="L-968"><a href="#L-968"><span class="linenos"> 968</span></a><span class="s2">                    padding: </span><span class="si">{</span><span class="n">btn_padding</span><span class="si">}</span><span class="s2">;</span>
</span><span id="L-969"><a href="#L-969"><span class="linenos"> 969</span></a><span class="s2">                    border-radius: 10px;</span>
</span><span id="L-970"><a href="#L-970"><span class="linenos"> 970</span></a><span class="s2">                    border: 1px solid #bdc3c7;</span>
</span><span id="L-971"><a href="#L-971"><span class="linenos"> 971</span></a><span class="s2">                    font-weight: bold;</span>
</span><span id="L-972"><a href="#L-972"><span class="linenos"> 972</span></a><span class="s2">                    font-size: </span><span class="si">{</span><span class="n">font_size_btn</span><span class="si">}</span><span class="s2">px;</span>
</span><span id="L-973"><a href="#L-973"><span class="linenos"> 973</span></a><span class="s2">                    margin: 2px;</span>
</span><span id="L-974"><a href="#L-974"><span class="linenos"> 974</span></a><span class="s2">                </span><span class="se">}}</span>
</span><span id="L-975"><a href="#L-975"><span class="linenos"> 975</span></a><span class="s2">                QPushButton:hover </span><span class="se">{{</span>
</span><span id="L-976"><a href="#L-976"><span class="linenos"> 976</span></a><span class="s2">                    background-color: #d0d0d0;</span>
</span><span id="L-977"><a href="#L-977"><span class="linenos"> 977</span></a><span class="s2">                </span><span class="se">}}</span>
</span><span id="L-978"><a href="#L-978"><span class="linenos"> 978</span></a><span class="s2">                QPushButton:disabled </span><span class="se">{{</span>
</span><span id="L-979"><a href="#L-979"><span class="linenos"> 979</span></a><span class="s2">                    background-color: #f0f0f0;</span>
</span><span id="L-980"><a href="#L-980"><span class="linenos"> 980</span></a><span class="s2">                    color: #888888;</span>
</span><span id="L-981"><a href="#L-981"><span class="linenos"> 981</span></a><span class="s2">                </span><span class="se">}}</span>
</span><span id="L-982"><a href="#L-982"><span class="linenos"> 982</span></a><span class="s2">            &quot;&quot;&quot;</span><span class="p">)</span>
</span><span id="L-983"><a href="#L-983"><span class="linenos"> 983</span></a>
</span><span id="L-984"><a href="#L-984"><span class="linenos"> 984</span></a>        <span class="c1"># Update summary title styling</span>
</span><span id="L-985"><a href="#L-985"><span class="linenos"> 985</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">title_summary</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span>
</span><span id="L-986"><a href="#L-986"><span class="linenos"> 986</span></a>            <span class="sa">f</span><span class="s2">&quot;font-size: </span><span class="si">{</span><span class="n">font_size_title</span><span class="si">}</span><span class="s2">px; font-weight: bold; color: #000000; margin-bottom: 8px;&quot;</span>
</span><span id="L-987"><a href="#L-987"><span class="linenos"> 987</span></a>        <span class="p">)</span>
</span><span id="L-988"><a href="#L-988"><span class="linenos"> 988</span></a>
</span><span id="L-989"><a href="#L-989"><span class="linenos"> 989</span></a>        <span class="c1"># Update pill-style status indicators (total, eligible, not eligible)</span>
</span><span id="L-990"><a href="#L-990"><span class="linenos"> 990</span></a>        <span class="k">for</span> <span class="n">pill</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">total_label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eligible_label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">not_eligible_label</span><span class="p">]:</span>
</span><span id="L-991"><a href="#L-991"><span class="linenos"> 991</span></a>            <span class="n">pill</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;font-size: </span><span class="si">{</span><span class="n">font_size_label</span><span class="si">}</span><span class="s2">px; font-weight: bold;&quot;</span><span class="p">)</span>
</span><span id="L-992"><a href="#L-992"><span class="linenos"> 992</span></a>            <span class="n">pill</span><span class="o">.</span><span class="n">value_label</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span>
</span><span id="L-993"><a href="#L-993"><span class="linenos"> 993</span></a>                <span class="sa">f</span><span class="s2">&quot;font-size: </span><span class="si">{</span><span class="n">font_size_value</span><span class="si">}</span><span class="s2">px; font-weight: bold; color: </span><span class="si">{</span><span class="n">pill</span><span class="o">.</span><span class="n">value_label</span><span class="o">.</span><span class="n">palette</span><span class="p">()</span><span class="o">.</span><span class="n">color</span><span class="p">(</span><span class="n">pill</span><span class="o">.</span><span class="n">value_label</span><span class="o">.</span><span class="n">foregroundRole</span><span class="p">())</span><span class="o">.</span><span class="n">name</span><span class="p">()</span><span class="si">}</span><span class="s2">;&quot;</span>
</span><span id="L-994"><a href="#L-994"><span class="linenos"> 994</span></a>            <span class="p">)</span>
</span><span id="L-995"><a href="#L-995"><span class="linenos"> 995</span></a>            <span class="n">pill</span><span class="o">.</span><span class="n">setMaximumHeight</span><span class="p">(</span><span class="n">max_pill_height</span><span class="p">)</span>  <span class="c1"># Limit vertical space</span>
</span><span id="L-996"><a href="#L-996"><span class="linenos"> 996</span></a>
</span><span id="L-997"><a href="#L-997"><span class="linenos"> 997</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_translate_ui</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-998"><a href="#L-998"><span class="linenos"> 998</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Translate all UI text elements.</span>
</span><span id="L-999"><a href="#L-999"><span class="linenos"> 999</span></a>
</span><span id="L-1000"><a href="#L-1000"><span class="linenos">1000</span></a><span class="sd">        This method updates all labels, buttons, and titles with localized</span>
</span><span id="L-1001"><a href="#L-1001"><span class="linenos">1001</span></a><span class="sd">        (translated) strings using Qt&#39;s translation system. It ensures</span>
</span><span id="L-1002"><a href="#L-1002"><span class="linenos">1002</span></a><span class="sd">        multilingual compatibility of the interface.</span>
</span><span id="L-1003"><a href="#L-1003"><span class="linenos">1003</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1004"><a href="#L-1004"><span class="linenos">1004</span></a>        <span class="c1"># Set translated texts for main title and control buttons</span>
</span><span id="L-1005"><a href="#L-1005"><span class="linenos">1005</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
</span><span id="L-1006"><a href="#L-1006"><span class="linenos">1006</span></a>            <span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;PipelinePatientSelectionPage&quot;</span><span class="p">,</span> <span class="s2">&quot;Select Patients for Pipeline Analysis&quot;</span><span class="p">))</span>
</span><span id="L-1007"><a href="#L-1007"><span class="linenos">1007</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">select_eligible_btn</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
</span><span id="L-1008"><a href="#L-1008"><span class="linenos">1008</span></a>            <span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;PipelinePatientSelectionPage&quot;</span><span class="p">,</span> <span class="s2">&quot;Select All Eligible&quot;</span><span class="p">))</span>
</span><span id="L-1009"><a href="#L-1009"><span class="linenos">1009</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">deselect_all_btn</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;PipelinePatientSelectionPage&quot;</span><span class="p">,</span> <span class="s2">&quot;Deselect All&quot;</span><span class="p">))</span>
</span><span id="L-1010"><a href="#L-1010"><span class="linenos">1010</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_btn</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;PipelinePatientSelectionPage&quot;</span><span class="p">,</span> <span class="s2">&quot;Refresh Status&quot;</span><span class="p">))</span>
</span><span id="L-1011"><a href="#L-1011"><span class="linenos">1011</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">title_summary</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
</span><span id="L-1012"><a href="#L-1012"><span class="linenos">1012</span></a>            <span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;PipelinePatientSelectionPage&quot;</span><span class="p">,</span> <span class="s2">&quot;Pipeline Requirements Summary&quot;</span><span class="p">))</span>
</span><span id="L-1013"><a href="#L-1013"><span class="linenos">1013</span></a>
</span><span id="L-1014"><a href="#L-1014"><span class="linenos">1014</span></a>        <span class="c1"># Set translated labels for patient status summary</span>
</span><span id="L-1015"><a href="#L-1015"><span class="linenos">1015</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">total_label</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;PipelinePatientSelectionPage&quot;</span><span class="p">,</span> <span class="s2">&quot;Total Patients&quot;</span><span class="p">))</span>
</span><span id="L-1016"><a href="#L-1016"><span class="linenos">1016</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">eligible_label</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;PipelinePatientSelectionPage&quot;</span><span class="p">,</span> <span class="s2">&quot;Eligible&quot;</span><span class="p">))</span>
</span><span id="L-1017"><a href="#L-1017"><span class="linenos">1017</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">not_eligible_label</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
</span><span id="L-1018"><a href="#L-1018"><span class="linenos">1018</span></a>            <span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;PipelinePatientSelectionPage&quot;</span><span class="p">,</span> <span class="s2">&quot;Not Eligible&quot;</span><span class="p">))</span>
</span><span id="L-1019"><a href="#L-1019"><span class="linenos">1019</span></a>
</span><span id="L-1020"><a href="#L-1020"><span class="linenos">1020</span></a>        <span class="c1"># Reload patient list after updating UI text</span>
</span><span id="L-1021"><a href="#L-1021"><span class="linenos">1021</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_load_patients</span><span class="p">()</span>
</span></pre></div>


            </section>
                <section id="log">
                    <div class="attr variable">
            <span class="name">log</span>        =
<span class="default_value">&lt;Logger GliAAns-UI (WARNING)&gt;</span>

        
    </div>
    <a class="headerlink" href="#log"></a>
    
    

                </section>
                <section id="PipelinePatientSelectionPage">
                            <input id="PipelinePatientSelectionPage-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">PipelinePatientSelectionPage</span><wbr>(<span class="base">page.Page</span>):

                <label class="view-source-button" for="PipelinePatientSelectionPage-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PipelinePatientSelectionPage"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PipelinePatientSelectionPage-20"><a href="#PipelinePatientSelectionPage-20"><span class="linenos">  20</span></a><span class="k">class</span><span class="w"> </span><span class="nc">PipelinePatientSelectionPage</span><span class="p">(</span><span class="n">Page</span><span class="p">):</span>
</span><span id="PipelinePatientSelectionPage-21"><a href="#PipelinePatientSelectionPage-21"><span class="linenos">  21</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">previous_page</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="PipelinePatientSelectionPage-22"><a href="#PipelinePatientSelectionPage-22"><span class="linenos">  22</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="PipelinePatientSelectionPage-23"><a href="#PipelinePatientSelectionPage-23"><span class="linenos">  23</span></a>
</span><span id="PipelinePatientSelectionPage-24"><a href="#PipelinePatientSelectionPage-24"><span class="linenos">  24</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">context</span>
</span><span id="PipelinePatientSelectionPage-25"><a href="#PipelinePatientSelectionPage-25"><span class="linenos">  25</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">previous_page</span> <span class="o">=</span> <span class="n">previous_page</span>
</span><span id="PipelinePatientSelectionPage-26"><a href="#PipelinePatientSelectionPage-26"><span class="linenos">  26</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">next_page</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PipelinePatientSelectionPage-27"><a href="#PipelinePatientSelectionPage-27"><span class="linenos">  27</span></a>
</span><span id="PipelinePatientSelectionPage-28"><a href="#PipelinePatientSelectionPage-28"><span class="linenos">  28</span></a>        <span class="c1"># Path to the workspace directory containing patient data</span>
</span><span id="PipelinePatientSelectionPage-29"><a href="#PipelinePatientSelectionPage-29"><span class="linenos">  29</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">workspace_path</span> <span class="o">=</span> <span class="n">context</span><span class="p">[</span><span class="s2">&quot;workspace_path&quot;</span><span class="p">]</span>
</span><span id="PipelinePatientSelectionPage-30"><a href="#PipelinePatientSelectionPage-30"><span class="linenos">  30</span></a>
</span><span id="PipelinePatientSelectionPage-31"><a href="#PipelinePatientSelectionPage-31"><span class="linenos">  31</span></a>        <span class="c1"># Dictionaries to track patient widgets, selected patients, and their processing status</span>
</span><span id="PipelinePatientSelectionPage-32"><a href="#PipelinePatientSelectionPage-32"><span class="linenos">  32</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">patient_buttons</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="PipelinePatientSelectionPage-33"><a href="#PipelinePatientSelectionPage-33"><span class="linenos">  33</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">selected_patients</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="PipelinePatientSelectionPage-34"><a href="#PipelinePatientSelectionPage-34"><span class="linenos">  34</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">patient_status</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Stores eligibility and missing data for each patient</span>
</span><span id="PipelinePatientSelectionPage-35"><a href="#PipelinePatientSelectionPage-35"><span class="linenos">  35</span></a>
</span><span id="PipelinePatientSelectionPage-36"><a href="#PipelinePatientSelectionPage-36"><span class="linenos">  36</span></a>        <span class="c1"># Initialize the user interface</span>
</span><span id="PipelinePatientSelectionPage-37"><a href="#PipelinePatientSelectionPage-37"><span class="linenos">  37</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_ui</span><span class="p">()</span>
</span><span id="PipelinePatientSelectionPage-38"><a href="#PipelinePatientSelectionPage-38"><span class="linenos">  38</span></a>
</span><span id="PipelinePatientSelectionPage-39"><a href="#PipelinePatientSelectionPage-39"><span class="linenos">  39</span></a>        <span class="c1"># Set translations (for multilingual UI)</span>
</span><span id="PipelinePatientSelectionPage-40"><a href="#PipelinePatientSelectionPage-40"><span class="linenos">  40</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_translate_ui</span><span class="p">()</span>
</span><span id="PipelinePatientSelectionPage-41"><a href="#PipelinePatientSelectionPage-41"><span class="linenos">  41</span></a>        <span class="k">if</span> <span class="n">context</span> <span class="ow">and</span> <span class="s2">&quot;language_changed&quot;</span> <span class="ow">in</span> <span class="n">context</span><span class="p">:</span>
</span><span id="PipelinePatientSelectionPage-42"><a href="#PipelinePatientSelectionPage-42"><span class="linenos">  42</span></a>            <span class="c1"># Connect language change signal for dynamic translation</span>
</span><span id="PipelinePatientSelectionPage-43"><a href="#PipelinePatientSelectionPage-43"><span class="linenos">  43</span></a>            <span class="n">context</span><span class="p">[</span><span class="s2">&quot;language_changed&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate_ui</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-44"><a href="#PipelinePatientSelectionPage-44"><span class="linenos">  44</span></a>
</span><span id="PipelinePatientSelectionPage-45"><a href="#PipelinePatientSelectionPage-45"><span class="linenos">  45</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_setup_ui</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="PipelinePatientSelectionPage-46"><a href="#PipelinePatientSelectionPage-46"><span class="linenos">  46</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Setup the main layout and UI components.&quot;&quot;&quot;</span>
</span><span id="PipelinePatientSelectionPage-47"><a href="#PipelinePatientSelectionPage-47"><span class="linenos">  47</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-48"><a href="#PipelinePatientSelectionPage-48"><span class="linenos">  48</span></a>
</span><span id="PipelinePatientSelectionPage-49"><a href="#PipelinePatientSelectionPage-49"><span class="linenos">  49</span></a>        <span class="c1"># --- Title ---</span>
</span><span id="PipelinePatientSelectionPage-50"><a href="#PipelinePatientSelectionPage-50"><span class="linenos">  50</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Select Patients for Pipeline Analysis&quot;</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-51"><a href="#PipelinePatientSelectionPage-51"><span class="linenos">  51</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">QFont</span><span class="p">(</span><span class="s2">&quot;Arial&quot;</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="n">QFont</span><span class="o">.</span><span class="n">Weight</span><span class="o">.</span><span class="n">Bold</span><span class="p">))</span>
</span><span id="PipelinePatientSelectionPage-52"><a href="#PipelinePatientSelectionPage-52"><span class="linenos">  52</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignmentFlag</span><span class="o">.</span><span class="n">AlignHCenter</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-53"><a href="#PipelinePatientSelectionPage-53"><span class="linenos">  53</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-54"><a href="#PipelinePatientSelectionPage-54"><span class="linenos">  54</span></a>
</span><span id="PipelinePatientSelectionPage-55"><a href="#PipelinePatientSelectionPage-55"><span class="linenos">  55</span></a>        <span class="c1"># --- Top buttons (bulk selection controls) ---</span>
</span><span id="PipelinePatientSelectionPage-56"><a href="#PipelinePatientSelectionPage-56"><span class="linenos">  56</span></a>        <span class="n">top_buttons_layout</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
</span><span id="PipelinePatientSelectionPage-57"><a href="#PipelinePatientSelectionPage-57"><span class="linenos">  57</span></a>
</span><span id="PipelinePatientSelectionPage-58"><a href="#PipelinePatientSelectionPage-58"><span class="linenos">  58</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">select_eligible_btn</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Select All Eligible&quot;</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-59"><a href="#PipelinePatientSelectionPage-59"><span class="linenos">  59</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">deselect_all_btn</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Deselect All&quot;</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-60"><a href="#PipelinePatientSelectionPage-60"><span class="linenos">  60</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_btn</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s2">&quot;Refresh Status&quot;</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-61"><a href="#PipelinePatientSelectionPage-61"><span class="linenos">  61</span></a>
</span><span id="PipelinePatientSelectionPage-62"><a href="#PipelinePatientSelectionPage-62"><span class="linenos">  62</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">buttons</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">select_eligible_btn</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">deselect_all_btn</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">refresh_btn</span><span class="p">]</span>
</span><span id="PipelinePatientSelectionPage-63"><a href="#PipelinePatientSelectionPage-63"><span class="linenos">  63</span></a>
</span><span id="PipelinePatientSelectionPage-64"><a href="#PipelinePatientSelectionPage-64"><span class="linenos">  64</span></a>        <span class="c1"># Apply a consistent visual style to all buttons</span>
</span><span id="PipelinePatientSelectionPage-65"><a href="#PipelinePatientSelectionPage-65"><span class="linenos">  65</span></a>        <span class="n">btn_style</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
</span><span id="PipelinePatientSelectionPage-66"><a href="#PipelinePatientSelectionPage-66"><span class="linenos">  66</span></a><span class="s2">            QPushButton {</span>
</span><span id="PipelinePatientSelectionPage-67"><a href="#PipelinePatientSelectionPage-67"><span class="linenos">  67</span></a><span class="s2">                background-color: #e0e0e0;</span>
</span><span id="PipelinePatientSelectionPage-68"><a href="#PipelinePatientSelectionPage-68"><span class="linenos">  68</span></a><span class="s2">                padding: 10px 20px;</span>
</span><span id="PipelinePatientSelectionPage-69"><a href="#PipelinePatientSelectionPage-69"><span class="linenos">  69</span></a><span class="s2">                border-radius: 10px;</span>
</span><span id="PipelinePatientSelectionPage-70"><a href="#PipelinePatientSelectionPage-70"><span class="linenos">  70</span></a><span class="s2">                border: 1px solid #bdc3c7;</span>
</span><span id="PipelinePatientSelectionPage-71"><a href="#PipelinePatientSelectionPage-71"><span class="linenos">  71</span></a><span class="s2">                font-weight: bold;</span>
</span><span id="PipelinePatientSelectionPage-72"><a href="#PipelinePatientSelectionPage-72"><span class="linenos">  72</span></a><span class="s2">                margin: 2px;</span>
</span><span id="PipelinePatientSelectionPage-73"><a href="#PipelinePatientSelectionPage-73"><span class="linenos">  73</span></a><span class="s2">            }</span>
</span><span id="PipelinePatientSelectionPage-74"><a href="#PipelinePatientSelectionPage-74"><span class="linenos">  74</span></a><span class="s2">            QPushButton:hover {</span>
</span><span id="PipelinePatientSelectionPage-75"><a href="#PipelinePatientSelectionPage-75"><span class="linenos">  75</span></a><span class="s2">                background-color: #d0d0d0;</span>
</span><span id="PipelinePatientSelectionPage-76"><a href="#PipelinePatientSelectionPage-76"><span class="linenos">  76</span></a><span class="s2">            }</span>
</span><span id="PipelinePatientSelectionPage-77"><a href="#PipelinePatientSelectionPage-77"><span class="linenos">  77</span></a><span class="s2">            QPushButton:disabled {</span>
</span><span id="PipelinePatientSelectionPage-78"><a href="#PipelinePatientSelectionPage-78"><span class="linenos">  78</span></a><span class="s2">                background-color: #f0f0f0;</span>
</span><span id="PipelinePatientSelectionPage-79"><a href="#PipelinePatientSelectionPage-79"><span class="linenos">  79</span></a><span class="s2">                color: #888888;</span>
</span><span id="PipelinePatientSelectionPage-80"><a href="#PipelinePatientSelectionPage-80"><span class="linenos">  80</span></a><span class="s2">            }</span>
</span><span id="PipelinePatientSelectionPage-81"><a href="#PipelinePatientSelectionPage-81"><span class="linenos">  81</span></a><span class="s2">        &quot;&quot;&quot;</span>
</span><span id="PipelinePatientSelectionPage-82"><a href="#PipelinePatientSelectionPage-82"><span class="linenos">  82</span></a>        <span class="k">for</span> <span class="n">btn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">buttons</span><span class="p">:</span>
</span><span id="PipelinePatientSelectionPage-83"><a href="#PipelinePatientSelectionPage-83"><span class="linenos">  83</span></a>            <span class="n">btn</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="n">btn_style</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-84"><a href="#PipelinePatientSelectionPage-84"><span class="linenos">  84</span></a>
</span><span id="PipelinePatientSelectionPage-85"><a href="#PipelinePatientSelectionPage-85"><span class="linenos">  85</span></a>        <span class="c1"># Connect buttons to actions</span>
</span><span id="PipelinePatientSelectionPage-86"><a href="#PipelinePatientSelectionPage-86"><span class="linenos">  86</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">select_eligible_btn</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_select_all_eligible_patients</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-87"><a href="#PipelinePatientSelectionPage-87"><span class="linenos">  87</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">deselect_all_btn</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_deselect_all_patients</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-88"><a href="#PipelinePatientSelectionPage-88"><span class="linenos">  88</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_btn</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_refresh_patient_status</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-89"><a href="#PipelinePatientSelectionPage-89"><span class="linenos">  89</span></a>
</span><span id="PipelinePatientSelectionPage-90"><a href="#PipelinePatientSelectionPage-90"><span class="linenos">  90</span></a>        <span class="c1"># Add the buttons to layout with stretch for alignment</span>
</span><span id="PipelinePatientSelectionPage-91"><a href="#PipelinePatientSelectionPage-91"><span class="linenos">  91</span></a>        <span class="n">top_buttons_layout</span><span class="o">.</span><span class="n">addStretch</span><span class="p">()</span>
</span><span id="PipelinePatientSelectionPage-92"><a href="#PipelinePatientSelectionPage-92"><span class="linenos">  92</span></a>        <span class="n">top_buttons_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">select_eligible_btn</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-93"><a href="#PipelinePatientSelectionPage-93"><span class="linenos">  93</span></a>        <span class="n">top_buttons_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">deselect_all_btn</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-94"><a href="#PipelinePatientSelectionPage-94"><span class="linenos">  94</span></a>        <span class="n">top_buttons_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">refresh_btn</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-95"><a href="#PipelinePatientSelectionPage-95"><span class="linenos">  95</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">top_buttons_layout</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-96"><a href="#PipelinePatientSelectionPage-96"><span class="linenos">  96</span></a>
</span><span id="PipelinePatientSelectionPage-97"><a href="#PipelinePatientSelectionPage-97"><span class="linenos">  97</span></a>        <span class="c1"># --- Scroll area for displaying patients ---</span>
</span><span id="PipelinePatientSelectionPage-98"><a href="#PipelinePatientSelectionPage-98"><span class="linenos">  98</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scroll_area</span> <span class="o">=</span> <span class="n">QScrollArea</span><span class="p">()</span>
</span><span id="PipelinePatientSelectionPage-99"><a href="#PipelinePatientSelectionPage-99"><span class="linenos">  99</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scroll_area</span><span class="o">.</span><span class="n">setWidgetResizable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-100"><a href="#PipelinePatientSelectionPage-100"><span class="linenos"> 100</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scroll_area</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="PipelinePatientSelectionPage-101"><a href="#PipelinePatientSelectionPage-101"><span class="linenos"> 101</span></a><span class="s2">            QScrollArea {</span>
</span><span id="PipelinePatientSelectionPage-102"><a href="#PipelinePatientSelectionPage-102"><span class="linenos"> 102</span></a><span class="s2">                font-size: 13px;</span>
</span><span id="PipelinePatientSelectionPage-103"><a href="#PipelinePatientSelectionPage-103"><span class="linenos"> 103</span></a><span class="s2">                border: 1px solid #CCCCCC;</span>
</span><span id="PipelinePatientSelectionPage-104"><a href="#PipelinePatientSelectionPage-104"><span class="linenos"> 104</span></a><span class="s2">                border-radius: 10px;</span>
</span><span id="PipelinePatientSelectionPage-105"><a href="#PipelinePatientSelectionPage-105"><span class="linenos"> 105</span></a><span class="s2">                padding: 5px;</span>
</span><span id="PipelinePatientSelectionPage-106"><a href="#PipelinePatientSelectionPage-106"><span class="linenos"> 106</span></a><span class="s2">            }</span>
</span><span id="PipelinePatientSelectionPage-107"><a href="#PipelinePatientSelectionPage-107"><span class="linenos"> 107</span></a><span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-108"><a href="#PipelinePatientSelectionPage-108"><span class="linenos"> 108</span></a>
</span><span id="PipelinePatientSelectionPage-109"><a href="#PipelinePatientSelectionPage-109"><span class="linenos"> 109</span></a>        <span class="c1"># Container widget inside scroll area (grid of patient cards)</span>
</span><span id="PipelinePatientSelectionPage-110"><a href="#PipelinePatientSelectionPage-110"><span class="linenos"> 110</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scroll_content</span> <span class="o">=</span> <span class="n">QWidget</span><span class="p">()</span>
</span><span id="PipelinePatientSelectionPage-111"><a href="#PipelinePatientSelectionPage-111"><span class="linenos"> 111</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">grid_layout</span> <span class="o">=</span> <span class="n">QGridLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scroll_content</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-112"><a href="#PipelinePatientSelectionPage-112"><span class="linenos"> 112</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scroll_area</span><span class="o">.</span><span class="n">setWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scroll_content</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-113"><a href="#PipelinePatientSelectionPage-113"><span class="linenos"> 113</span></a>
</span><span id="PipelinePatientSelectionPage-114"><a href="#PipelinePatientSelectionPage-114"><span class="linenos"> 114</span></a>        <span class="c1"># --- Summary panel showing total and eligible counts ---</span>
</span><span id="PipelinePatientSelectionPage-115"><a href="#PipelinePatientSelectionPage-115"><span class="linenos"> 115</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">summary_widget</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_summary_widget</span><span class="p">()</span>
</span><span id="PipelinePatientSelectionPage-116"><a href="#PipelinePatientSelectionPage-116"><span class="linenos"> 116</span></a>
</span><span id="PipelinePatientSelectionPage-117"><a href="#PipelinePatientSelectionPage-117"><span class="linenos"> 117</span></a>        <span class="c1"># Add widgets to the main layout</span>
</span><span id="PipelinePatientSelectionPage-118"><a href="#PipelinePatientSelectionPage-118"><span class="linenos"> 118</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">summary_widget</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-119"><a href="#PipelinePatientSelectionPage-119"><span class="linenos"> 119</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scroll_area</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-120"><a href="#PipelinePatientSelectionPage-120"><span class="linenos"> 120</span></a>
</span><span id="PipelinePatientSelectionPage-121"><a href="#PipelinePatientSelectionPage-121"><span class="linenos"> 121</span></a>        <span class="c1"># Number of patient columns per row in grid</span>
</span><span id="PipelinePatientSelectionPage-122"><a href="#PipelinePatientSelectionPage-122"><span class="linenos"> 122</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">column_count</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="PipelinePatientSelectionPage-123"><a href="#PipelinePatientSelectionPage-123"><span class="linenos"> 123</span></a>
</span><span id="PipelinePatientSelectionPage-124"><a href="#PipelinePatientSelectionPage-124"><span class="linenos"> 124</span></a>        <span class="c1"># Load patient data and build UI</span>
</span><span id="PipelinePatientSelectionPage-125"><a href="#PipelinePatientSelectionPage-125"><span class="linenos"> 125</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_load_patients</span><span class="p">()</span>
</span><span id="PipelinePatientSelectionPage-126"><a href="#PipelinePatientSelectionPage-126"><span class="linenos"> 126</span></a>
</span><span id="PipelinePatientSelectionPage-127"><a href="#PipelinePatientSelectionPage-127"><span class="linenos"> 127</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_create_summary_widget</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="PipelinePatientSelectionPage-128"><a href="#PipelinePatientSelectionPage-128"><span class="linenos"> 128</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a modern-style summary widget for displaying patient statistics.&quot;&quot;&quot;</span>
</span><span id="PipelinePatientSelectionPage-129"><a href="#PipelinePatientSelectionPage-129"><span class="linenos"> 129</span></a>        <span class="n">summary_frame</span> <span class="o">=</span> <span class="n">QFrame</span><span class="p">()</span>
</span><span id="PipelinePatientSelectionPage-130"><a href="#PipelinePatientSelectionPage-130"><span class="linenos"> 130</span></a>        <span class="n">summary_frame</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">&quot;summaryCard&quot;</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-131"><a href="#PipelinePatientSelectionPage-131"><span class="linenos"> 131</span></a>        <span class="n">summary_frame</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="PipelinePatientSelectionPage-132"><a href="#PipelinePatientSelectionPage-132"><span class="linenos"> 132</span></a><span class="s2">            QFrame#summaryCard {</span>
</span><span id="PipelinePatientSelectionPage-133"><a href="#PipelinePatientSelectionPage-133"><span class="linenos"> 133</span></a><span class="s2">                border: 1px solid #e0e0e0;</span>
</span><span id="PipelinePatientSelectionPage-134"><a href="#PipelinePatientSelectionPage-134"><span class="linenos"> 134</span></a><span class="s2">                border-radius: 12px;</span>
</span><span id="PipelinePatientSelectionPage-135"><a href="#PipelinePatientSelectionPage-135"><span class="linenos"> 135</span></a><span class="s2">                background-color: #ffffff;</span>
</span><span id="PipelinePatientSelectionPage-136"><a href="#PipelinePatientSelectionPage-136"><span class="linenos"> 136</span></a><span class="s2">                padding: 0.1em;</span>
</span><span id="PipelinePatientSelectionPage-137"><a href="#PipelinePatientSelectionPage-137"><span class="linenos"> 137</span></a><span class="s2">            }</span>
</span><span id="PipelinePatientSelectionPage-138"><a href="#PipelinePatientSelectionPage-138"><span class="linenos"> 138</span></a><span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-139"><a href="#PipelinePatientSelectionPage-139"><span class="linenos"> 139</span></a>
</span><span id="PipelinePatientSelectionPage-140"><a href="#PipelinePatientSelectionPage-140"><span class="linenos"> 140</span></a>        <span class="n">main_layout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">(</span><span class="n">summary_frame</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-141"><a href="#PipelinePatientSelectionPage-141"><span class="linenos"> 141</span></a>
</span><span id="PipelinePatientSelectionPage-142"><a href="#PipelinePatientSelectionPage-142"><span class="linenos"> 142</span></a>        <span class="c1"># Section title</span>
</span><span id="PipelinePatientSelectionPage-143"><a href="#PipelinePatientSelectionPage-143"><span class="linenos"> 143</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">title_summary</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;PipelinePatientSelectionPage&quot;</span><span class="p">,</span> <span class="s2">&quot;Pipeline Requirements Summary&quot;</span><span class="p">))</span>
</span><span id="PipelinePatientSelectionPage-144"><a href="#PipelinePatientSelectionPage-144"><span class="linenos"> 144</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">title_summary</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignmentFlag</span><span class="o">.</span><span class="n">AlignCenter</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-145"><a href="#PipelinePatientSelectionPage-145"><span class="linenos"> 145</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">title_summary</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;font-size: 16px; font-weight: bold; color: #000000; margin-bottom: 10px;&quot;</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-146"><a href="#PipelinePatientSelectionPage-146"><span class="linenos"> 146</span></a>        <span class="n">main_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">title_summary</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-147"><a href="#PipelinePatientSelectionPage-147"><span class="linenos"> 147</span></a>
</span><span id="PipelinePatientSelectionPage-148"><a href="#PipelinePatientSelectionPage-148"><span class="linenos"> 148</span></a>        <span class="c1"># Horizontal layout for summary pill cards</span>
</span><span id="PipelinePatientSelectionPage-149"><a href="#PipelinePatientSelectionPage-149"><span class="linenos"> 149</span></a>        <span class="n">stats_layout</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
</span><span id="PipelinePatientSelectionPage-150"><a href="#PipelinePatientSelectionPage-150"><span class="linenos"> 150</span></a>        <span class="n">stats_layout</span><span class="o">.</span><span class="n">setSpacing</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-151"><a href="#PipelinePatientSelectionPage-151"><span class="linenos"> 151</span></a>
</span><span id="PipelinePatientSelectionPage-152"><a href="#PipelinePatientSelectionPage-152"><span class="linenos"> 152</span></a>        <span class="c1"># Create pill cards showing totals</span>
</span><span id="PipelinePatientSelectionPage-153"><a href="#PipelinePatientSelectionPage-153"><span class="linenos"> 153</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">total_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_stat_pill</span><span class="p">(</span><span class="n">resource_path</span><span class="p">(</span><span class="s2">&quot;resources/icon_total.png&quot;</span><span class="p">),</span>
</span><span id="PipelinePatientSelectionPage-154"><a href="#PipelinePatientSelectionPage-154"><span class="linenos"> 154</span></a>                                                  <span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;PipelinePatientSelectionPage&quot;</span><span class="p">,</span> <span class="s2">&quot;Total Patients&quot;</span><span class="p">),</span> <span class="s2">&quot;0&quot;</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-155"><a href="#PipelinePatientSelectionPage-155"><span class="linenos"> 155</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">eligible_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_stat_pill</span><span class="p">(</span><span class="n">resource_path</span><span class="p">(</span><span class="s2">&quot;resources/icon_check.png&quot;</span><span class="p">),</span>
</span><span id="PipelinePatientSelectionPage-156"><a href="#PipelinePatientSelectionPage-156"><span class="linenos"> 156</span></a>                                                     <span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;PipelinePatientSelectionPage&quot;</span><span class="p">,</span> <span class="s2">&quot;Eligible&quot;</span><span class="p">),</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#27ae60&quot;</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-157"><a href="#PipelinePatientSelectionPage-157"><span class="linenos"> 157</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">not_eligible_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_stat_pill</span><span class="p">(</span><span class="n">resource_path</span><span class="p">(</span><span class="s2">&quot;resources/icon_cross.png&quot;</span><span class="p">),</span>
</span><span id="PipelinePatientSelectionPage-158"><a href="#PipelinePatientSelectionPage-158"><span class="linenos"> 158</span></a>                                                         <span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;PipelinePatientSelectionPage&quot;</span><span class="p">,</span> <span class="s2">&quot;Not Eligible&quot;</span><span class="p">),</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#c0392b&quot;</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-159"><a href="#PipelinePatientSelectionPage-159"><span class="linenos"> 159</span></a>
</span><span id="PipelinePatientSelectionPage-160"><a href="#PipelinePatientSelectionPage-160"><span class="linenos"> 160</span></a>        <span class="c1"># Add pills to layout</span>
</span><span id="PipelinePatientSelectionPage-161"><a href="#PipelinePatientSelectionPage-161"><span class="linenos"> 161</span></a>        <span class="k">for</span> <span class="n">pill</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">total_label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eligible_label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">not_eligible_label</span><span class="p">]:</span>
</span><span id="PipelinePatientSelectionPage-162"><a href="#PipelinePatientSelectionPage-162"><span class="linenos"> 162</span></a>            <span class="n">pill</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Policy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">,</span> <span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Policy</span><span class="o">.</span><span class="n">Fixed</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-163"><a href="#PipelinePatientSelectionPage-163"><span class="linenos"> 163</span></a>            <span class="n">stats_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">pill</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-164"><a href="#PipelinePatientSelectionPage-164"><span class="linenos"> 164</span></a>
</span><span id="PipelinePatientSelectionPage-165"><a href="#PipelinePatientSelectionPage-165"><span class="linenos"> 165</span></a>        <span class="n">main_layout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">stats_layout</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-166"><a href="#PipelinePatientSelectionPage-166"><span class="linenos"> 166</span></a>
</span><span id="PipelinePatientSelectionPage-167"><a href="#PipelinePatientSelectionPage-167"><span class="linenos"> 167</span></a>        <span class="k">return</span> <span class="n">summary_frame</span>
</span><span id="PipelinePatientSelectionPage-168"><a href="#PipelinePatientSelectionPage-168"><span class="linenos"> 168</span></a>
</span><span id="PipelinePatientSelectionPage-169"><a href="#PipelinePatientSelectionPage-169"><span class="linenos"> 169</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_create_stat_pill</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">icon_path</span><span class="p">,</span> <span class="n">label_text</span><span class="p">,</span> <span class="n">value_text</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#000000&quot;</span><span class="p">):</span>
</span><span id="PipelinePatientSelectionPage-170"><a href="#PipelinePatientSelectionPage-170"><span class="linenos"> 170</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a card-like label with icon, text, and numeric value for summaries.&quot;&quot;&quot;</span>
</span><span id="PipelinePatientSelectionPage-171"><a href="#PipelinePatientSelectionPage-171"><span class="linenos"> 171</span></a>        <span class="n">pill</span> <span class="o">=</span> <span class="n">QFrame</span><span class="p">()</span>
</span><span id="PipelinePatientSelectionPage-172"><a href="#PipelinePatientSelectionPage-172"><span class="linenos"> 172</span></a>        <span class="n">pill</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">&quot;summaryCard&quot;</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-173"><a href="#PipelinePatientSelectionPage-173"><span class="linenos"> 173</span></a>        <span class="n">pill</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="PipelinePatientSelectionPage-174"><a href="#PipelinePatientSelectionPage-174"><span class="linenos"> 174</span></a><span class="s2">            QFrame#summaryCard </span><span class="se">{{</span>
</span><span id="PipelinePatientSelectionPage-175"><a href="#PipelinePatientSelectionPage-175"><span class="linenos"> 175</span></a><span class="s2">                border: 1px solid #CCCCCC;</span>
</span><span id="PipelinePatientSelectionPage-176"><a href="#PipelinePatientSelectionPage-176"><span class="linenos"> 176</span></a><span class="s2">                border-radius: 10px;</span>
</span><span id="PipelinePatientSelectionPage-177"><a href="#PipelinePatientSelectionPage-177"><span class="linenos"> 177</span></a><span class="s2">                background-color: #f9f9f9;</span>
</span><span id="PipelinePatientSelectionPage-178"><a href="#PipelinePatientSelectionPage-178"><span class="linenos"> 178</span></a><span class="s2">            </span><span class="se">}}</span>
</span><span id="PipelinePatientSelectionPage-179"><a href="#PipelinePatientSelectionPage-179"><span class="linenos"> 179</span></a><span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-180"><a href="#PipelinePatientSelectionPage-180"><span class="linenos"> 180</span></a>
</span><span id="PipelinePatientSelectionPage-181"><a href="#PipelinePatientSelectionPage-181"><span class="linenos"> 181</span></a>        <span class="n">layout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">(</span><span class="n">pill</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-182"><a href="#PipelinePatientSelectionPage-182"><span class="linenos"> 182</span></a>        <span class="n">layout</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignmentFlag</span><span class="o">.</span><span class="n">AlignCenter</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-183"><a href="#PipelinePatientSelectionPage-183"><span class="linenos"> 183</span></a>
</span><span id="PipelinePatientSelectionPage-184"><a href="#PipelinePatientSelectionPage-184"><span class="linenos"> 184</span></a>        <span class="c1"># Text label (e.g., Total Patients)</span>
</span><span id="PipelinePatientSelectionPage-185"><a href="#PipelinePatientSelectionPage-185"><span class="linenos"> 185</span></a>        <span class="n">label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="n">label_text</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-186"><a href="#PipelinePatientSelectionPage-186"><span class="linenos"> 186</span></a>        <span class="n">label</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;font-size: 13px; font-weight: bold;&quot;</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-187"><a href="#PipelinePatientSelectionPage-187"><span class="linenos"> 187</span></a>        <span class="n">label</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignmentFlag</span><span class="o">.</span><span class="n">AlignCenter</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-188"><a href="#PipelinePatientSelectionPage-188"><span class="linenos"> 188</span></a>
</span><span id="PipelinePatientSelectionPage-189"><a href="#PipelinePatientSelectionPage-189"><span class="linenos"> 189</span></a>        <span class="c1"># Numeric value (e.g., 5)</span>
</span><span id="PipelinePatientSelectionPage-190"><a href="#PipelinePatientSelectionPage-190"><span class="linenos"> 190</span></a>        <span class="n">value</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="n">value_text</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-191"><a href="#PipelinePatientSelectionPage-191"><span class="linenos"> 191</span></a>        <span class="n">value</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;font-size: 20px; font-weight: bold; color: </span><span class="si">{</span><span class="n">color</span><span class="si">}</span><span class="s2">;&quot;</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-192"><a href="#PipelinePatientSelectionPage-192"><span class="linenos"> 192</span></a>        <span class="n">value</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignmentFlag</span><span class="o">.</span><span class="n">AlignCenter</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-193"><a href="#PipelinePatientSelectionPage-193"><span class="linenos"> 193</span></a>
</span><span id="PipelinePatientSelectionPage-194"><a href="#PipelinePatientSelectionPage-194"><span class="linenos"> 194</span></a>        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-195"><a href="#PipelinePatientSelectionPage-195"><span class="linenos"> 195</span></a>        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-196"><a href="#PipelinePatientSelectionPage-196"><span class="linenos"> 196</span></a>
</span><span id="PipelinePatientSelectionPage-197"><a href="#PipelinePatientSelectionPage-197"><span class="linenos"> 197</span></a>        <span class="c1"># Keep reference to labels for later updates</span>
</span><span id="PipelinePatientSelectionPage-198"><a href="#PipelinePatientSelectionPage-198"><span class="linenos"> 198</span></a>        <span class="n">pill</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">label</span>
</span><span id="PipelinePatientSelectionPage-199"><a href="#PipelinePatientSelectionPage-199"><span class="linenos"> 199</span></a>        <span class="n">pill</span><span class="o">.</span><span class="n">value_label</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="PipelinePatientSelectionPage-200"><a href="#PipelinePatientSelectionPage-200"><span class="linenos"> 200</span></a>
</span><span id="PipelinePatientSelectionPage-201"><a href="#PipelinePatientSelectionPage-201"><span class="linenos"> 201</span></a>        <span class="n">pill</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Policy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">,</span> <span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Policy</span><span class="o">.</span><span class="n">Fixed</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-202"><a href="#PipelinePatientSelectionPage-202"><span class="linenos"> 202</span></a>        <span class="n">pill</span><span class="o">.</span><span class="n">setMinimumHeight</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-203"><a href="#PipelinePatientSelectionPage-203"><span class="linenos"> 203</span></a>        <span class="n">pill</span><span class="o">.</span><span class="n">setMaximumHeight</span><span class="p">(</span><span class="mi">120</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-204"><a href="#PipelinePatientSelectionPage-204"><span class="linenos"> 204</span></a>
</span><span id="PipelinePatientSelectionPage-205"><a href="#PipelinePatientSelectionPage-205"><span class="linenos"> 205</span></a>        <span class="k">return</span> <span class="n">pill</span>
</span><span id="PipelinePatientSelectionPage-206"><a href="#PipelinePatientSelectionPage-206"><span class="linenos"> 206</span></a>
</span><span id="PipelinePatientSelectionPage-207"><a href="#PipelinePatientSelectionPage-207"><span class="linenos"> 207</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_check_patient_requirements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patient_path</span><span class="p">,</span> <span class="n">patient_id</span><span class="p">):</span>
</span><span id="PipelinePatientSelectionPage-208"><a href="#PipelinePatientSelectionPage-208"><span class="linenos"> 208</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check whether a patient meets all pipeline requirements.&quot;&quot;&quot;</span>
</span><span id="PipelinePatientSelectionPage-209"><a href="#PipelinePatientSelectionPage-209"><span class="linenos"> 209</span></a>        <span class="c1"># Each key corresponds to a necessary preprocessing step</span>
</span><span id="PipelinePatientSelectionPage-210"><a href="#PipelinePatientSelectionPage-210"><span class="linenos"> 210</span></a>        <span class="n">requirements</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="PipelinePatientSelectionPage-211"><a href="#PipelinePatientSelectionPage-211"><span class="linenos"> 211</span></a>            <span class="s1">&#39;flair&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="PipelinePatientSelectionPage-212"><a href="#PipelinePatientSelectionPage-212"><span class="linenos"> 212</span></a>            <span class="s1">&#39;skull_stripping&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="PipelinePatientSelectionPage-213"><a href="#PipelinePatientSelectionPage-213"><span class="linenos"> 213</span></a>            <span class="s1">&#39;segmentation&#39;</span><span class="p">:</span> <span class="kc">False</span>
</span><span id="PipelinePatientSelectionPage-214"><a href="#PipelinePatientSelectionPage-214"><span class="linenos"> 214</span></a>        <span class="p">}</span>
</span><span id="PipelinePatientSelectionPage-215"><a href="#PipelinePatientSelectionPage-215"><span class="linenos"> 215</span></a>
</span><span id="PipelinePatientSelectionPage-216"><a href="#PipelinePatientSelectionPage-216"><span class="linenos"> 216</span></a>        <span class="n">missing_files</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Collect missing components for display</span>
</span><span id="PipelinePatientSelectionPage-217"><a href="#PipelinePatientSelectionPage-217"><span class="linenos"> 217</span></a>
</span><span id="PipelinePatientSelectionPage-218"><a href="#PipelinePatientSelectionPage-218"><span class="linenos"> 218</span></a>        <span class="c1"># --- 1. Check for FLAIR anatomical image ---</span>
</span><span id="PipelinePatientSelectionPage-219"><a href="#PipelinePatientSelectionPage-219"><span class="linenos"> 219</span></a>        <span class="n">flair_patterns</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="PipelinePatientSelectionPage-220"><a href="#PipelinePatientSelectionPage-220"><span class="linenos"> 220</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">patient_path</span><span class="p">,</span> <span class="s2">&quot;anat&quot;</span><span class="p">,</span> <span class="s2">&quot;*_flair.nii&quot;</span><span class="p">),</span>
</span><span id="PipelinePatientSelectionPage-221"><a href="#PipelinePatientSelectionPage-221"><span class="linenos"> 221</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">patient_path</span><span class="p">,</span> <span class="s2">&quot;anat&quot;</span><span class="p">,</span> <span class="s2">&quot;*_flair.nii.gz&quot;</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-222"><a href="#PipelinePatientSelectionPage-222"><span class="linenos"> 222</span></a>        <span class="p">]</span>
</span><span id="PipelinePatientSelectionPage-223"><a href="#PipelinePatientSelectionPage-223"><span class="linenos"> 223</span></a>
</span><span id="PipelinePatientSelectionPage-224"><a href="#PipelinePatientSelectionPage-224"><span class="linenos"> 224</span></a>        <span class="n">flair_found</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="PipelinePatientSelectionPage-225"><a href="#PipelinePatientSelectionPage-225"><span class="linenos"> 225</span></a>        <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">flair_patterns</span><span class="p">:</span>
</span><span id="PipelinePatientSelectionPage-226"><a href="#PipelinePatientSelectionPage-226"><span class="linenos"> 226</span></a>            <span class="k">if</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">pattern</span><span class="p">):</span>  <span class="c1"># Search for matching files</span>
</span><span id="PipelinePatientSelectionPage-227"><a href="#PipelinePatientSelectionPage-227"><span class="linenos"> 227</span></a>                <span class="n">flair_found</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="PipelinePatientSelectionPage-228"><a href="#PipelinePatientSelectionPage-228"><span class="linenos"> 228</span></a>                <span class="k">break</span>
</span><span id="PipelinePatientSelectionPage-229"><a href="#PipelinePatientSelectionPage-229"><span class="linenos"> 229</span></a>
</span><span id="PipelinePatientSelectionPage-230"><a href="#PipelinePatientSelectionPage-230"><span class="linenos"> 230</span></a>        <span class="n">requirements</span><span class="p">[</span><span class="s1">&#39;flair&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">flair_found</span>
</span><span id="PipelinePatientSelectionPage-231"><a href="#PipelinePatientSelectionPage-231"><span class="linenos"> 231</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">flair_found</span><span class="p">:</span>
</span><span id="PipelinePatientSelectionPage-232"><a href="#PipelinePatientSelectionPage-232"><span class="linenos"> 232</span></a>            <span class="n">missing_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span>
</span><span id="PipelinePatientSelectionPage-233"><a href="#PipelinePatientSelectionPage-233"><span class="linenos"> 233</span></a>                <span class="s2">&quot;PipelinePatientSelectionPage&quot;</span><span class="p">,</span> <span class="s2">&quot;FLAIR image (anat/*_flair.nii[.gz])&quot;</span><span class="p">))</span>
</span><span id="PipelinePatientSelectionPage-234"><a href="#PipelinePatientSelectionPage-234"><span class="linenos"> 234</span></a>
</span><span id="PipelinePatientSelectionPage-235"><a href="#PipelinePatientSelectionPage-235"><span class="linenos"> 235</span></a>        <span class="c1"># --- 2. Check for Skull-Stripped image ---</span>
</span><span id="PipelinePatientSelectionPage-236"><a href="#PipelinePatientSelectionPage-236"><span class="linenos"> 236</span></a>        <span class="n">skull_strip_patterns</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="PipelinePatientSelectionPage-237"><a href="#PipelinePatientSelectionPage-237"><span class="linenos"> 237</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workspace_path</span><span class="p">,</span> <span class="s2">&quot;derivatives&quot;</span><span class="p">,</span> <span class="s2">&quot;skullstrips&quot;</span><span class="p">,</span> <span class="n">patient_id</span><span class="p">,</span> <span class="s2">&quot;anat&quot;</span><span class="p">,</span> <span class="s2">&quot;*_brain.nii&quot;</span><span class="p">),</span>
</span><span id="PipelinePatientSelectionPage-238"><a href="#PipelinePatientSelectionPage-238"><span class="linenos"> 238</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workspace_path</span><span class="p">,</span> <span class="s2">&quot;derivatives&quot;</span><span class="p">,</span> <span class="s2">&quot;skullstrips&quot;</span><span class="p">,</span> <span class="n">patient_id</span><span class="p">,</span> <span class="s2">&quot;anat&quot;</span><span class="p">,</span> <span class="s2">&quot;*_brain.nii.gz&quot;</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-239"><a href="#PipelinePatientSelectionPage-239"><span class="linenos"> 239</span></a>        <span class="p">]</span>
</span><span id="PipelinePatientSelectionPage-240"><a href="#PipelinePatientSelectionPage-240"><span class="linenos"> 240</span></a>
</span><span id="PipelinePatientSelectionPage-241"><a href="#PipelinePatientSelectionPage-241"><span class="linenos"> 241</span></a>        <span class="n">skull_strip_found</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="PipelinePatientSelectionPage-242"><a href="#PipelinePatientSelectionPage-242"><span class="linenos"> 242</span></a>        <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">skull_strip_patterns</span><span class="p">:</span>
</span><span id="PipelinePatientSelectionPage-243"><a href="#PipelinePatientSelectionPage-243"><span class="linenos"> 243</span></a>            <span class="k">if</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">pattern</span><span class="p">):</span>
</span><span id="PipelinePatientSelectionPage-244"><a href="#PipelinePatientSelectionPage-244"><span class="linenos"> 244</span></a>                <span class="n">skull_strip_found</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="PipelinePatientSelectionPage-245"><a href="#PipelinePatientSelectionPage-245"><span class="linenos"> 245</span></a>                <span class="k">break</span>
</span><span id="PipelinePatientSelectionPage-246"><a href="#PipelinePatientSelectionPage-246"><span class="linenos"> 246</span></a>
</span><span id="PipelinePatientSelectionPage-247"><a href="#PipelinePatientSelectionPage-247"><span class="linenos"> 247</span></a>        <span class="n">requirements</span><span class="p">[</span><span class="s1">&#39;skull_stripping&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">skull_strip_found</span>
</span><span id="PipelinePatientSelectionPage-248"><a href="#PipelinePatientSelectionPage-248"><span class="linenos"> 248</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">skull_strip_found</span><span class="p">:</span>
</span><span id="PipelinePatientSelectionPage-249"><a href="#PipelinePatientSelectionPage-249"><span class="linenos"> 249</span></a>            <span class="n">missing_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span>
</span><span id="PipelinePatientSelectionPage-250"><a href="#PipelinePatientSelectionPage-250"><span class="linenos"> 250</span></a>                <span class="s2">&quot;PipelinePatientSelectionPage&quot;</span><span class="p">,</span> <span class="s2">&quot;Skull stripped image (derivatives/skullstrips/.../anat/*_brain.nii[.gz])&quot;</span><span class="p">))</span>
</span><span id="PipelinePatientSelectionPage-251"><a href="#PipelinePatientSelectionPage-251"><span class="linenos"> 251</span></a>
</span><span id="PipelinePatientSelectionPage-252"><a href="#PipelinePatientSelectionPage-252"><span class="linenos"> 252</span></a>        <span class="c1"># --- 3. Check for Segmentation or Manual Mask ---</span>
</span><span id="PipelinePatientSelectionPage-253"><a href="#PipelinePatientSelectionPage-253"><span class="linenos"> 253</span></a>        <span class="n">segmentation_patterns</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="PipelinePatientSelectionPage-254"><a href="#PipelinePatientSelectionPage-254"><span class="linenos"> 254</span></a>            <span class="c1"># Manual masks</span>
</span><span id="PipelinePatientSelectionPage-255"><a href="#PipelinePatientSelectionPage-255"><span class="linenos"> 255</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workspace_path</span><span class="p">,</span> <span class="s2">&quot;derivatives&quot;</span><span class="p">,</span> <span class="s2">&quot;manual_masks&quot;</span><span class="p">,</span> <span class="n">patient_id</span><span class="p">,</span> <span class="s2">&quot;anat&quot;</span><span class="p">,</span> <span class="s2">&quot;*_mask.nii&quot;</span><span class="p">),</span>
</span><span id="PipelinePatientSelectionPage-256"><a href="#PipelinePatientSelectionPage-256"><span class="linenos"> 256</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workspace_path</span><span class="p">,</span> <span class="s2">&quot;derivatives&quot;</span><span class="p">,</span> <span class="s2">&quot;manual_masks&quot;</span><span class="p">,</span> <span class="n">patient_id</span><span class="p">,</span> <span class="s2">&quot;anat&quot;</span><span class="p">,</span> <span class="s2">&quot;*_mask.nii.gz&quot;</span><span class="p">),</span>
</span><span id="PipelinePatientSelectionPage-257"><a href="#PipelinePatientSelectionPage-257"><span class="linenos"> 257</span></a>            <span class="c1"># Deep learning segmentation output</span>
</span><span id="PipelinePatientSelectionPage-258"><a href="#PipelinePatientSelectionPage-258"><span class="linenos"> 258</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workspace_path</span><span class="p">,</span> <span class="s2">&quot;derivatives&quot;</span><span class="p">,</span> <span class="s2">&quot;deep_learning_seg&quot;</span><span class="p">,</span> <span class="n">patient_id</span><span class="p">,</span> <span class="s2">&quot;anat&quot;</span><span class="p">,</span> <span class="s2">&quot;*_seg.nii&quot;</span><span class="p">),</span>
</span><span id="PipelinePatientSelectionPage-259"><a href="#PipelinePatientSelectionPage-259"><span class="linenos"> 259</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workspace_path</span><span class="p">,</span> <span class="s2">&quot;derivatives&quot;</span><span class="p">,</span> <span class="s2">&quot;deep_learning_seg&quot;</span><span class="p">,</span> <span class="n">patient_id</span><span class="p">,</span> <span class="s2">&quot;anat&quot;</span><span class="p">,</span> <span class="s2">&quot;*_seg.nii.gz&quot;</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-260"><a href="#PipelinePatientSelectionPage-260"><span class="linenos"> 260</span></a>        <span class="p">]</span>
</span><span id="PipelinePatientSelectionPage-261"><a href="#PipelinePatientSelectionPage-261"><span class="linenos"> 261</span></a>
</span><span id="PipelinePatientSelectionPage-262"><a href="#PipelinePatientSelectionPage-262"><span class="linenos"> 262</span></a>        <span class="n">segmentation_found</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="PipelinePatientSelectionPage-263"><a href="#PipelinePatientSelectionPage-263"><span class="linenos"> 263</span></a>        <span class="n">segmentation_type</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PipelinePatientSelectionPage-264"><a href="#PipelinePatientSelectionPage-264"><span class="linenos"> 264</span></a>        <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">segmentation_patterns</span><span class="p">:</span>
</span><span id="PipelinePatientSelectionPage-265"><a href="#PipelinePatientSelectionPage-265"><span class="linenos"> 265</span></a>            <span class="k">if</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">pattern</span><span class="p">):</span>
</span><span id="PipelinePatientSelectionPage-266"><a href="#PipelinePatientSelectionPage-266"><span class="linenos"> 266</span></a>                <span class="n">segmentation_found</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="PipelinePatientSelectionPage-267"><a href="#PipelinePatientSelectionPage-267"><span class="linenos"> 267</span></a>                <span class="c1"># Identify segmentation source type</span>
</span><span id="PipelinePatientSelectionPage-268"><a href="#PipelinePatientSelectionPage-268"><span class="linenos"> 268</span></a>                <span class="k">if</span> <span class="s2">&quot;manual_masks&quot;</span> <span class="ow">in</span> <span class="n">pattern</span><span class="p">:</span>
</span><span id="PipelinePatientSelectionPage-269"><a href="#PipelinePatientSelectionPage-269"><span class="linenos"> 269</span></a>                    <span class="n">segmentation_type</span> <span class="o">=</span> <span class="s2">&quot;Manual Mask&quot;</span>
</span><span id="PipelinePatientSelectionPage-270"><a href="#PipelinePatientSelectionPage-270"><span class="linenos"> 270</span></a>                <span class="k">elif</span> <span class="s2">&quot;deep_learning_seg&quot;</span> <span class="ow">in</span> <span class="n">pattern</span><span class="p">:</span>
</span><span id="PipelinePatientSelectionPage-271"><a href="#PipelinePatientSelectionPage-271"><span class="linenos"> 271</span></a>                    <span class="n">segmentation_type</span> <span class="o">=</span> <span class="s2">&quot;deep_learning_seg Segmentation&quot;</span>
</span><span id="PipelinePatientSelectionPage-272"><a href="#PipelinePatientSelectionPage-272"><span class="linenos"> 272</span></a>                <span class="k">break</span>
</span><span id="PipelinePatientSelectionPage-273"><a href="#PipelinePatientSelectionPage-273"><span class="linenos"> 273</span></a>
</span><span id="PipelinePatientSelectionPage-274"><a href="#PipelinePatientSelectionPage-274"><span class="linenos"> 274</span></a>        <span class="n">requirements</span><span class="p">[</span><span class="s1">&#39;segmentation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">segmentation_found</span>
</span><span id="PipelinePatientSelectionPage-275"><a href="#PipelinePatientSelectionPage-275"><span class="linenos"> 275</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">segmentation_found</span><span class="p">:</span>
</span><span id="PipelinePatientSelectionPage-276"><a href="#PipelinePatientSelectionPage-276"><span class="linenos"> 276</span></a>            <span class="n">missing_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span>
</span><span id="PipelinePatientSelectionPage-277"><a href="#PipelinePatientSelectionPage-277"><span class="linenos"> 277</span></a>                <span class="s2">&quot;PipelinePatientSelectionPage&quot;</span><span class="p">,</span> <span class="s2">&quot;Segmentation (manual_masks/*_mask.nii[.gz] or deep_learning_seg /*_seg.nii[.gz])&quot;</span><span class="p">))</span>
</span><span id="PipelinePatientSelectionPage-278"><a href="#PipelinePatientSelectionPage-278"><span class="linenos"> 278</span></a>
</span><span id="PipelinePatientSelectionPage-279"><a href="#PipelinePatientSelectionPage-279"><span class="linenos"> 279</span></a>        <span class="c1"># --- Final eligibility decision ---</span>
</span><span id="PipelinePatientSelectionPage-280"><a href="#PipelinePatientSelectionPage-280"><span class="linenos"> 280</span></a>        <span class="c1"># Patient is eligible if all required files are present</span>
</span><span id="PipelinePatientSelectionPage-281"><a href="#PipelinePatientSelectionPage-281"><span class="linenos"> 281</span></a>        <span class="n">is_eligible</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="n">requirements</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</span><span id="PipelinePatientSelectionPage-282"><a href="#PipelinePatientSelectionPage-282"><span class="linenos"> 282</span></a>
</span><span id="PipelinePatientSelectionPage-283"><a href="#PipelinePatientSelectionPage-283"><span class="linenos"> 283</span></a>        <span class="c1"># Return structured summary of findings</span>
</span><span id="PipelinePatientSelectionPage-284"><a href="#PipelinePatientSelectionPage-284"><span class="linenos"> 284</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="PipelinePatientSelectionPage-285"><a href="#PipelinePatientSelectionPage-285"><span class="linenos"> 285</span></a>            <span class="s1">&#39;eligible&#39;</span><span class="p">:</span> <span class="n">is_eligible</span><span class="p">,</span>
</span><span id="PipelinePatientSelectionPage-286"><a href="#PipelinePatientSelectionPage-286"><span class="linenos"> 286</span></a>            <span class="s1">&#39;requirements&#39;</span><span class="p">:</span> <span class="n">requirements</span><span class="p">,</span>
</span><span id="PipelinePatientSelectionPage-287"><a href="#PipelinePatientSelectionPage-287"><span class="linenos"> 287</span></a>            <span class="s1">&#39;missing_files&#39;</span><span class="p">:</span> <span class="n">missing_files</span><span class="p">,</span>
</span><span id="PipelinePatientSelectionPage-288"><a href="#PipelinePatientSelectionPage-288"><span class="linenos"> 288</span></a>            <span class="s1">&#39;segmentation_type&#39;</span><span class="p">:</span> <span class="n">segmentation_type</span>
</span><span id="PipelinePatientSelectionPage-289"><a href="#PipelinePatientSelectionPage-289"><span class="linenos"> 289</span></a>        <span class="p">}</span>
</span><span id="PipelinePatientSelectionPage-290"><a href="#PipelinePatientSelectionPage-290"><span class="linenos"> 290</span></a>
</span><span id="PipelinePatientSelectionPage-291"><a href="#PipelinePatientSelectionPage-291"><span class="linenos"> 291</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_load_patients</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="PipelinePatientSelectionPage-292"><a href="#PipelinePatientSelectionPage-292"><span class="linenos"> 292</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Load patients and verify their requirements&quot;&quot;&quot;</span>
</span><span id="PipelinePatientSelectionPage-293"><a href="#PipelinePatientSelectionPage-293"><span class="linenos"> 293</span></a>        <span class="c1"># Find all patient folders (sub-*)</span>
</span><span id="PipelinePatientSelectionPage-294"><a href="#PipelinePatientSelectionPage-294"><span class="linenos"> 294</span></a>        <span class="n">patient_dirs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_patient_dirs</span><span class="p">()</span>
</span><span id="PipelinePatientSelectionPage-295"><a href="#PipelinePatientSelectionPage-295"><span class="linenos"> 295</span></a>        <span class="n">patient_dirs</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>  <span class="c1"># Sort alphabetically for visual consistency</span>
</span><span id="PipelinePatientSelectionPage-296"><a href="#PipelinePatientSelectionPage-296"><span class="linenos"> 296</span></a>
</span><span id="PipelinePatientSelectionPage-297"><a href="#PipelinePatientSelectionPage-297"><span class="linenos"> 297</span></a>        <span class="c1"># Clear the dictionaries of buttons and patient states</span>
</span><span id="PipelinePatientSelectionPage-298"><a href="#PipelinePatientSelectionPage-298"><span class="linenos"> 298</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">patient_buttons</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="PipelinePatientSelectionPage-299"><a href="#PipelinePatientSelectionPage-299"><span class="linenos"> 299</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">patient_status</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="PipelinePatientSelectionPage-300"><a href="#PipelinePatientSelectionPage-300"><span class="linenos"> 300</span></a>
</span><span id="PipelinePatientSelectionPage-301"><a href="#PipelinePatientSelectionPage-301"><span class="linenos"> 301</span></a>        <span class="n">eligible_count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="PipelinePatientSelectionPage-302"><a href="#PipelinePatientSelectionPage-302"><span class="linenos"> 302</span></a>        <span class="n">total_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">patient_dirs</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-303"><a href="#PipelinePatientSelectionPage-303"><span class="linenos"> 303</span></a>
</span><span id="PipelinePatientSelectionPage-304"><a href="#PipelinePatientSelectionPage-304"><span class="linenos"> 304</span></a>        <span class="c1"># Iterate over all found patients</span>
</span><span id="PipelinePatientSelectionPage-305"><a href="#PipelinePatientSelectionPage-305"><span class="linenos"> 305</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">patient_path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">patient_dirs</span><span class="p">):</span>
</span><span id="PipelinePatientSelectionPage-306"><a href="#PipelinePatientSelectionPage-306"><span class="linenos"> 306</span></a>            <span class="n">patient_id</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">patient_path</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-307"><a href="#PipelinePatientSelectionPage-307"><span class="linenos"> 307</span></a>
</span><span id="PipelinePatientSelectionPage-308"><a href="#PipelinePatientSelectionPage-308"><span class="linenos"> 308</span></a>            <span class="c1"># Check the required conditions for each patient</span>
</span><span id="PipelinePatientSelectionPage-309"><a href="#PipelinePatientSelectionPage-309"><span class="linenos"> 309</span></a>            <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_patient_requirements</span><span class="p">(</span><span class="n">patient_path</span><span class="p">,</span> <span class="n">patient_id</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-310"><a href="#PipelinePatientSelectionPage-310"><span class="linenos"> 310</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">patient_status</span><span class="p">[</span><span class="n">patient_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">status</span>
</span><span id="PipelinePatientSelectionPage-311"><a href="#PipelinePatientSelectionPage-311"><span class="linenos"> 311</span></a>
</span><span id="PipelinePatientSelectionPage-312"><a href="#PipelinePatientSelectionPage-312"><span class="linenos"> 312</span></a>            <span class="c1"># Count eligible patients</span>
</span><span id="PipelinePatientSelectionPage-313"><a href="#PipelinePatientSelectionPage-313"><span class="linenos"> 313</span></a>            <span class="k">if</span> <span class="n">status</span><span class="p">[</span><span class="s1">&#39;eligible&#39;</span><span class="p">]:</span>
</span><span id="PipelinePatientSelectionPage-314"><a href="#PipelinePatientSelectionPage-314"><span class="linenos"> 314</span></a>                <span class="n">eligible_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="PipelinePatientSelectionPage-315"><a href="#PipelinePatientSelectionPage-315"><span class="linenos"> 315</span></a>
</span><span id="PipelinePatientSelectionPage-316"><a href="#PipelinePatientSelectionPage-316"><span class="linenos"> 316</span></a>            <span class="c1"># Create a card (frame) for the patient</span>
</span><span id="PipelinePatientSelectionPage-317"><a href="#PipelinePatientSelectionPage-317"><span class="linenos"> 317</span></a>            <span class="n">patient_frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_patient_frame</span><span class="p">(</span><span class="n">patient_id</span><span class="p">,</span> <span class="n">patient_path</span><span class="p">,</span> <span class="n">status</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-318"><a href="#PipelinePatientSelectionPage-318"><span class="linenos"> 318</span></a>
</span><span id="PipelinePatientSelectionPage-319"><a href="#PipelinePatientSelectionPage-319"><span class="linenos"> 319</span></a>            <span class="c1"># Insert the card into the grid layout</span>
</span><span id="PipelinePatientSelectionPage-320"><a href="#PipelinePatientSelectionPage-320"><span class="linenos"> 320</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">grid_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">patient_frame</span><span class="p">,</span> <span class="n">i</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">column_count</span><span class="p">,</span> <span class="n">i</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">column_count</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-321"><a href="#PipelinePatientSelectionPage-321"><span class="linenos"> 321</span></a>
</span><span id="PipelinePatientSelectionPage-322"><a href="#PipelinePatientSelectionPage-322"><span class="linenos"> 322</span></a>        <span class="c1"># Update the statistical summary</span>
</span><span id="PipelinePatientSelectionPage-323"><a href="#PipelinePatientSelectionPage-323"><span class="linenos"> 323</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_update_summary</span><span class="p">(</span><span class="n">eligible_count</span><span class="p">,</span> <span class="n">total_count</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-324"><a href="#PipelinePatientSelectionPage-324"><span class="linenos"> 324</span></a>
</span><span id="PipelinePatientSelectionPage-325"><a href="#PipelinePatientSelectionPage-325"><span class="linenos"> 325</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_create_patient_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patient_id</span><span class="p">,</span> <span class="n">patient_path</span><span class="p">,</span> <span class="n">status</span><span class="p">):</span>
</span><span id="PipelinePatientSelectionPage-326"><a href="#PipelinePatientSelectionPage-326"><span class="linenos"> 326</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create the frame for a single patient&quot;&quot;&quot;</span>
</span><span id="PipelinePatientSelectionPage-327"><a href="#PipelinePatientSelectionPage-327"><span class="linenos"> 327</span></a>        <span class="n">patient_frame</span> <span class="o">=</span> <span class="n">QFrame</span><span class="p">()</span>
</span><span id="PipelinePatientSelectionPage-328"><a href="#PipelinePatientSelectionPage-328"><span class="linenos"> 328</span></a>        <span class="n">patient_frame</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">&quot;patientCard&quot;</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-329"><a href="#PipelinePatientSelectionPage-329"><span class="linenos"> 329</span></a>        <span class="n">patient_frame</span><span class="o">.</span><span class="n">setMaximumHeight</span><span class="p">(</span><span class="mi">140</span><span class="p">)</span>  <span class="c1"># Card height limit</span>
</span><span id="PipelinePatientSelectionPage-330"><a href="#PipelinePatientSelectionPage-330"><span class="linenos"> 330</span></a>        <span class="n">patient_frame</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Policy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">,</span> <span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Policy</span><span class="o">.</span><span class="n">Fixed</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-331"><a href="#PipelinePatientSelectionPage-331"><span class="linenos"> 331</span></a>
</span><span id="PipelinePatientSelectionPage-332"><a href="#PipelinePatientSelectionPage-332"><span class="linenos"> 332</span></a>        <span class="c1"># Apply different visual style based on patient eligibility</span>
</span><span id="PipelinePatientSelectionPage-333"><a href="#PipelinePatientSelectionPage-333"><span class="linenos"> 333</span></a>        <span class="k">if</span> <span class="n">status</span><span class="p">[</span><span class="s1">&#39;eligible&#39;</span><span class="p">]:</span>
</span><span id="PipelinePatientSelectionPage-334"><a href="#PipelinePatientSelectionPage-334"><span class="linenos"> 334</span></a>            <span class="n">frame_style</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
</span><span id="PipelinePatientSelectionPage-335"><a href="#PipelinePatientSelectionPage-335"><span class="linenos"> 335</span></a><span class="s2">                QFrame#patientCard {</span>
</span><span id="PipelinePatientSelectionPage-336"><a href="#PipelinePatientSelectionPage-336"><span class="linenos"> 336</span></a><span class="s2">                    border: 2px solid #4CAF50;</span>
</span><span id="PipelinePatientSelectionPage-337"><a href="#PipelinePatientSelectionPage-337"><span class="linenos"> 337</span></a><span class="s2">                    border-radius: 10px;</span>
</span><span id="PipelinePatientSelectionPage-338"><a href="#PipelinePatientSelectionPage-338"><span class="linenos"> 338</span></a><span class="s2">                    background-color: #f0fff0;</span>
</span><span id="PipelinePatientSelectionPage-339"><a href="#PipelinePatientSelectionPage-339"><span class="linenos"> 339</span></a><span class="s2">                    padding: 10px;</span>
</span><span id="PipelinePatientSelectionPage-340"><a href="#PipelinePatientSelectionPage-340"><span class="linenos"> 340</span></a><span class="s2">                    margin: 2px;</span>
</span><span id="PipelinePatientSelectionPage-341"><a href="#PipelinePatientSelectionPage-341"><span class="linenos"> 341</span></a><span class="s2">                }</span>
</span><span id="PipelinePatientSelectionPage-342"><a href="#PipelinePatientSelectionPage-342"><span class="linenos"> 342</span></a><span class="s2">            &quot;&quot;&quot;</span>
</span><span id="PipelinePatientSelectionPage-343"><a href="#PipelinePatientSelectionPage-343"><span class="linenos"> 343</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PipelinePatientSelectionPage-344"><a href="#PipelinePatientSelectionPage-344"><span class="linenos"> 344</span></a>            <span class="n">frame_style</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
</span><span id="PipelinePatientSelectionPage-345"><a href="#PipelinePatientSelectionPage-345"><span class="linenos"> 345</span></a><span class="s2">                QFrame#patientCard {</span>
</span><span id="PipelinePatientSelectionPage-346"><a href="#PipelinePatientSelectionPage-346"><span class="linenos"> 346</span></a><span class="s2">                    border: 2px solid #f44336;</span>
</span><span id="PipelinePatientSelectionPage-347"><a href="#PipelinePatientSelectionPage-347"><span class="linenos"> 347</span></a><span class="s2">                    border-radius: 10px;</span>
</span><span id="PipelinePatientSelectionPage-348"><a href="#PipelinePatientSelectionPage-348"><span class="linenos"> 348</span></a><span class="s2">                    background-color: #fff0f0;</span>
</span><span id="PipelinePatientSelectionPage-349"><a href="#PipelinePatientSelectionPage-349"><span class="linenos"> 349</span></a><span class="s2">                    padding: 10px;</span>
</span><span id="PipelinePatientSelectionPage-350"><a href="#PipelinePatientSelectionPage-350"><span class="linenos"> 350</span></a><span class="s2">                    margin: 2px;</span>
</span><span id="PipelinePatientSelectionPage-351"><a href="#PipelinePatientSelectionPage-351"><span class="linenos"> 351</span></a><span class="s2">                }</span>
</span><span id="PipelinePatientSelectionPage-352"><a href="#PipelinePatientSelectionPage-352"><span class="linenos"> 352</span></a><span class="s2">            &quot;&quot;&quot;</span>
</span><span id="PipelinePatientSelectionPage-353"><a href="#PipelinePatientSelectionPage-353"><span class="linenos"> 353</span></a>
</span><span id="PipelinePatientSelectionPage-354"><a href="#PipelinePatientSelectionPage-354"><span class="linenos"> 354</span></a>        <span class="n">patient_frame</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="n">frame_style</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-355"><a href="#PipelinePatientSelectionPage-355"><span class="linenos"> 355</span></a>
</span><span id="PipelinePatientSelectionPage-356"><a href="#PipelinePatientSelectionPage-356"><span class="linenos"> 356</span></a>        <span class="c1"># Main horizontal layout (left  right)</span>
</span><span id="PipelinePatientSelectionPage-357"><a href="#PipelinePatientSelectionPage-357"><span class="linenos"> 357</span></a>        <span class="n">patient_layout</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">(</span><span class="n">patient_frame</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-358"><a href="#PipelinePatientSelectionPage-358"><span class="linenos"> 358</span></a>
</span><span id="PipelinePatientSelectionPage-359"><a href="#PipelinePatientSelectionPage-359"><span class="linenos"> 359</span></a>        <span class="c1"># Left section: profile information</span>
</span><span id="PipelinePatientSelectionPage-360"><a href="#PipelinePatientSelectionPage-360"><span class="linenos"> 360</span></a>        <span class="n">profile_frame</span> <span class="o">=</span> <span class="n">QFrame</span><span class="p">()</span>
</span><span id="PipelinePatientSelectionPage-361"><a href="#PipelinePatientSelectionPage-361"><span class="linenos"> 361</span></a>        <span class="n">profile_frame</span><span class="o">.</span><span class="n">setFixedSize</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-362"><a href="#PipelinePatientSelectionPage-362"><span class="linenos"> 362</span></a>        <span class="n">profile_layout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">(</span><span class="n">profile_frame</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-363"><a href="#PipelinePatientSelectionPage-363"><span class="linenos"> 363</span></a>        <span class="n">profile_layout</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignmentFlag</span><span class="o">.</span><span class="n">AlignLeft</span> <span class="o">|</span> <span class="n">Qt</span><span class="o">.</span><span class="n">AlignmentFlag</span><span class="o">.</span><span class="n">AlignVCenter</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-364"><a href="#PipelinePatientSelectionPage-364"><span class="linenos"> 364</span></a>
</span><span id="PipelinePatientSelectionPage-365"><a href="#PipelinePatientSelectionPage-365"><span class="linenos"> 365</span></a>        <span class="c1"># User image (icon)</span>
</span><span id="PipelinePatientSelectionPage-366"><a href="#PipelinePatientSelectionPage-366"><span class="linenos"> 366</span></a>        <span class="n">image</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">()</span>
</span><span id="PipelinePatientSelectionPage-367"><a href="#PipelinePatientSelectionPage-367"><span class="linenos"> 367</span></a>        <span class="n">pixmap</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QPixmap</span><span class="p">(</span><span class="n">resource_path</span><span class="p">(</span><span class="s2">&quot;resources/user.png&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">scaled</span><span class="p">(</span>
</span><span id="PipelinePatientSelectionPage-368"><a href="#PipelinePatientSelectionPage-368"><span class="linenos"> 368</span></a>            <span class="mi">30</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">AspectRatioMode</span><span class="o">.</span><span class="n">KeepAspectRatio</span><span class="p">,</span>
</span><span id="PipelinePatientSelectionPage-369"><a href="#PipelinePatientSelectionPage-369"><span class="linenos"> 369</span></a>            <span class="n">Qt</span><span class="o">.</span><span class="n">TransformationMode</span><span class="o">.</span><span class="n">SmoothTransformation</span>
</span><span id="PipelinePatientSelectionPage-370"><a href="#PipelinePatientSelectionPage-370"><span class="linenos"> 370</span></a>        <span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-371"><a href="#PipelinePatientSelectionPage-371"><span class="linenos"> 371</span></a>        <span class="n">image</span><span class="o">.</span><span class="n">setPixmap</span><span class="p">(</span><span class="n">pixmap</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-372"><a href="#PipelinePatientSelectionPage-372"><span class="linenos"> 372</span></a>        <span class="n">image</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignmentFlag</span><span class="o">.</span><span class="n">AlignCenter</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-373"><a href="#PipelinePatientSelectionPage-373"><span class="linenos"> 373</span></a>
</span><span id="PipelinePatientSelectionPage-374"><a href="#PipelinePatientSelectionPage-374"><span class="linenos"> 374</span></a>        <span class="c1"># Patient ID label</span>
</span><span id="PipelinePatientSelectionPage-375"><a href="#PipelinePatientSelectionPage-375"><span class="linenos"> 375</span></a>        <span class="n">patient_label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">patient_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-376"><a href="#PipelinePatientSelectionPage-376"><span class="linenos"> 376</span></a>        <span class="n">patient_label</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignmentFlag</span><span class="o">.</span><span class="n">AlignCenter</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-377"><a href="#PipelinePatientSelectionPage-377"><span class="linenos"> 377</span></a>        <span class="n">patient_label</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;font-weight: bold; font-size: 12px;&quot;</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-378"><a href="#PipelinePatientSelectionPage-378"><span class="linenos"> 378</span></a>
</span><span id="PipelinePatientSelectionPage-379"><a href="#PipelinePatientSelectionPage-379"><span class="linenos"> 379</span></a>        <span class="c1"># Status label (Eligible / Not eligible)</span>
</span><span id="PipelinePatientSelectionPage-380"><a href="#PipelinePatientSelectionPage-380"><span class="linenos"> 380</span></a>        <span class="k">if</span> <span class="n">status</span><span class="p">[</span><span class="s1">&#39;eligible&#39;</span><span class="p">]:</span>
</span><span id="PipelinePatientSelectionPage-381"><a href="#PipelinePatientSelectionPage-381"><span class="linenos"> 381</span></a>            <span class="n">status_label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;PipelinePatientSelectionPage&quot;</span><span class="p">,</span> <span class="s2">&quot; Ready for Pipeline&quot;</span><span class="p">))</span>
</span><span id="PipelinePatientSelectionPage-382"><a href="#PipelinePatientSelectionPage-382"><span class="linenos"> 382</span></a>            <span class="n">status_label</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: #4CAF50; font-weight: bold; font-size: 10px;&quot;</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-383"><a href="#PipelinePatientSelectionPage-383"><span class="linenos"> 383</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PipelinePatientSelectionPage-384"><a href="#PipelinePatientSelectionPage-384"><span class="linenos"> 384</span></a>            <span class="n">status_label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;PipelinePatientSelectionPage&quot;</span><span class="p">,</span> <span class="s2">&quot; Missing Requirements&quot;</span><span class="p">))</span>
</span><span id="PipelinePatientSelectionPage-385"><a href="#PipelinePatientSelectionPage-385"><span class="linenos"> 385</span></a>            <span class="n">status_label</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: #f44336; font-weight: bold; font-size: 10px;&quot;</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-386"><a href="#PipelinePatientSelectionPage-386"><span class="linenos"> 386</span></a>        <span class="n">status_label</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignmentFlag</span><span class="o">.</span><span class="n">AlignCenter</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-387"><a href="#PipelinePatientSelectionPage-387"><span class="linenos"> 387</span></a>
</span><span id="PipelinePatientSelectionPage-388"><a href="#PipelinePatientSelectionPage-388"><span class="linenos"> 388</span></a>        <span class="c1"># Add widgets to the profile layout</span>
</span><span id="PipelinePatientSelectionPage-389"><a href="#PipelinePatientSelectionPage-389"><span class="linenos"> 389</span></a>        <span class="n">profile_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-390"><a href="#PipelinePatientSelectionPage-390"><span class="linenos"> 390</span></a>        <span class="n">profile_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">patient_label</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-391"><a href="#PipelinePatientSelectionPage-391"><span class="linenos"> 391</span></a>        <span class="n">profile_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">status_label</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-392"><a href="#PipelinePatientSelectionPage-392"><span class="linenos"> 392</span></a>
</span><span id="PipelinePatientSelectionPage-393"><a href="#PipelinePatientSelectionPage-393"><span class="linenos"> 393</span></a>        <span class="c1"># Center section: requirement details</span>
</span><span id="PipelinePatientSelectionPage-394"><a href="#PipelinePatientSelectionPage-394"><span class="linenos"> 394</span></a>        <span class="n">details_frame</span> <span class="o">=</span> <span class="n">QFrame</span><span class="p">()</span>
</span><span id="PipelinePatientSelectionPage-395"><a href="#PipelinePatientSelectionPage-395"><span class="linenos"> 395</span></a>        <span class="n">details_layout</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">(</span><span class="n">details_frame</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-396"><a href="#PipelinePatientSelectionPage-396"><span class="linenos"> 396</span></a>        <span class="n">details_layout</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignmentFlag</span><span class="o">.</span><span class="n">AlignVCenter</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-397"><a href="#PipelinePatientSelectionPage-397"><span class="linenos"> 397</span></a>
</span><span id="PipelinePatientSelectionPage-398"><a href="#PipelinePatientSelectionPage-398"><span class="linenos"> 398</span></a>        <span class="c1"># Status indicators for each required step</span>
</span><span id="PipelinePatientSelectionPage-399"><a href="#PipelinePatientSelectionPage-399"><span class="linenos"> 399</span></a>        <span class="n">req_indicators</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="PipelinePatientSelectionPage-400"><a href="#PipelinePatientSelectionPage-400"><span class="linenos"> 400</span></a>        <span class="n">req_labels</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="PipelinePatientSelectionPage-401"><a href="#PipelinePatientSelectionPage-401"><span class="linenos"> 401</span></a>            <span class="s1">&#39;flair&#39;</span><span class="p">:</span> <span class="s1">&#39;FLAIR&#39;</span><span class="p">,</span>
</span><span id="PipelinePatientSelectionPage-402"><a href="#PipelinePatientSelectionPage-402"><span class="linenos"> 402</span></a>            <span class="s1">&#39;skull_stripping&#39;</span><span class="p">:</span> <span class="s1">&#39;Skull Strip&#39;</span><span class="p">,</span>
</span><span id="PipelinePatientSelectionPage-403"><a href="#PipelinePatientSelectionPage-403"><span class="linenos"> 403</span></a>            <span class="s1">&#39;segmentation&#39;</span><span class="p">:</span> <span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;PipelinePatientSelectionPage&quot;</span><span class="p">,</span> <span class="s1">&#39;Segmentation&#39;</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-404"><a href="#PipelinePatientSelectionPage-404"><span class="linenos"> 404</span></a>        <span class="p">}</span>
</span><span id="PipelinePatientSelectionPage-405"><a href="#PipelinePatientSelectionPage-405"><span class="linenos"> 405</span></a>
</span><span id="PipelinePatientSelectionPage-406"><a href="#PipelinePatientSelectionPage-406"><span class="linenos"> 406</span></a>        <span class="c1"># Display  or  next to each requirement</span>
</span><span id="PipelinePatientSelectionPage-407"><a href="#PipelinePatientSelectionPage-407"><span class="linenos"> 407</span></a>        <span class="k">for</span> <span class="n">req</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">req_labels</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="PipelinePatientSelectionPage-408"><a href="#PipelinePatientSelectionPage-408"><span class="linenos"> 408</span></a>            <span class="n">indicator</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">()</span>
</span><span id="PipelinePatientSelectionPage-409"><a href="#PipelinePatientSelectionPage-409"><span class="linenos"> 409</span></a>            <span class="k">if</span> <span class="n">status</span><span class="p">[</span><span class="s1">&#39;requirements&#39;</span><span class="p">][</span><span class="n">req</span><span class="p">]:</span>
</span><span id="PipelinePatientSelectionPage-410"><a href="#PipelinePatientSelectionPage-410"><span class="linenos"> 410</span></a>                <span class="n">indicator</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-411"><a href="#PipelinePatientSelectionPage-411"><span class="linenos"> 411</span></a>                <span class="n">indicator</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: #4CAF50; font-size: 10px; padding: 1px;&quot;</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-412"><a href="#PipelinePatientSelectionPage-412"><span class="linenos"> 412</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="PipelinePatientSelectionPage-413"><a href="#PipelinePatientSelectionPage-413"><span class="linenos"> 413</span></a>                <span class="n">indicator</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-414"><a href="#PipelinePatientSelectionPage-414"><span class="linenos"> 414</span></a>                <span class="n">indicator</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: #f44336; font-size: 10px; padding: 1px;&quot;</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-415"><a href="#PipelinePatientSelectionPage-415"><span class="linenos"> 415</span></a>            <span class="n">req_indicators</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indicator</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-416"><a href="#PipelinePatientSelectionPage-416"><span class="linenos"> 416</span></a>            <span class="n">details_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">indicator</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-417"><a href="#PipelinePatientSelectionPage-417"><span class="linenos"> 417</span></a>
</span><span id="PipelinePatientSelectionPage-418"><a href="#PipelinePatientSelectionPage-418"><span class="linenos"> 418</span></a>        <span class="c1"># Show segmentation type if available</span>
</span><span id="PipelinePatientSelectionPage-419"><a href="#PipelinePatientSelectionPage-419"><span class="linenos"> 419</span></a>        <span class="k">if</span> <span class="n">status</span><span class="p">[</span><span class="s1">&#39;segmentation_type&#39;</span><span class="p">]:</span>
</span><span id="PipelinePatientSelectionPage-420"><a href="#PipelinePatientSelectionPage-420"><span class="linenos"> 420</span></a>            <span class="n">seg_type_label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;segmentation_type&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-421"><a href="#PipelinePatientSelectionPage-421"><span class="linenos"> 421</span></a>            <span class="n">seg_type_label</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;color: #666666; font-size: 9px; font-style: italic;&quot;</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-422"><a href="#PipelinePatientSelectionPage-422"><span class="linenos"> 422</span></a>            <span class="n">details_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">seg_type_label</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-423"><a href="#PipelinePatientSelectionPage-423"><span class="linenos"> 423</span></a>
</span><span id="PipelinePatientSelectionPage-424"><a href="#PipelinePatientSelectionPage-424"><span class="linenos"> 424</span></a>        <span class="c1"># Right section: selection button</span>
</span><span id="PipelinePatientSelectionPage-425"><a href="#PipelinePatientSelectionPage-425"><span class="linenos"> 425</span></a>        <span class="n">button</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;PipelinePatientSelectionPage&quot;</span><span class="p">,</span> <span class="s2">&quot;Select&quot;</span><span class="p">))</span>
</span><span id="PipelinePatientSelectionPage-426"><a href="#PipelinePatientSelectionPage-426"><span class="linenos"> 426</span></a>        <span class="n">button</span><span class="o">.</span><span class="n">setCheckable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># Allows to toggle selection</span>
</span><span id="PipelinePatientSelectionPage-427"><a href="#PipelinePatientSelectionPage-427"><span class="linenos"> 427</span></a>
</span><span id="PipelinePatientSelectionPage-428"><a href="#PipelinePatientSelectionPage-428"><span class="linenos"> 428</span></a>        <span class="k">if</span> <span class="n">status</span><span class="p">[</span><span class="s1">&#39;eligible&#39;</span><span class="p">]:</span>
</span><span id="PipelinePatientSelectionPage-429"><a href="#PipelinePatientSelectionPage-429"><span class="linenos"> 429</span></a>            <span class="c1"># Style for active (eligible) button</span>
</span><span id="PipelinePatientSelectionPage-430"><a href="#PipelinePatientSelectionPage-430"><span class="linenos"> 430</span></a>            <span class="n">button</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="PipelinePatientSelectionPage-431"><a href="#PipelinePatientSelectionPage-431"><span class="linenos"> 431</span></a><span class="s2">                QPushButton {</span>
</span><span id="PipelinePatientSelectionPage-432"><a href="#PipelinePatientSelectionPage-432"><span class="linenos"> 432</span></a><span class="s2">                    border-radius: 12px;</span>
</span><span id="PipelinePatientSelectionPage-433"><a href="#PipelinePatientSelectionPage-433"><span class="linenos"> 433</span></a><span class="s2">                    padding: 8px 16px;</span>
</span><span id="PipelinePatientSelectionPage-434"><a href="#PipelinePatientSelectionPage-434"><span class="linenos"> 434</span></a><span class="s2">                    background-color: #DADADA;</span>
</span><span id="PipelinePatientSelectionPage-435"><a href="#PipelinePatientSelectionPage-435"><span class="linenos"> 435</span></a><span class="s2">                    font-weight: bold;</span>
</span><span id="PipelinePatientSelectionPage-436"><a href="#PipelinePatientSelectionPage-436"><span class="linenos"> 436</span></a><span class="s2">                    min-width: 80px;</span>
</span><span id="PipelinePatientSelectionPage-437"><a href="#PipelinePatientSelectionPage-437"><span class="linenos"> 437</span></a><span class="s2">                }</span>
</span><span id="PipelinePatientSelectionPage-438"><a href="#PipelinePatientSelectionPage-438"><span class="linenos"> 438</span></a><span class="s2">                QPushButton:checked {</span>
</span><span id="PipelinePatientSelectionPage-439"><a href="#PipelinePatientSelectionPage-439"><span class="linenos"> 439</span></a><span class="s2">                    background-color: #4CAF50;</span>
</span><span id="PipelinePatientSelectionPage-440"><a href="#PipelinePatientSelectionPage-440"><span class="linenos"> 440</span></a><span class="s2">                    color: white;</span>
</span><span id="PipelinePatientSelectionPage-441"><a href="#PipelinePatientSelectionPage-441"><span class="linenos"> 441</span></a><span class="s2">                }</span>
</span><span id="PipelinePatientSelectionPage-442"><a href="#PipelinePatientSelectionPage-442"><span class="linenos"> 442</span></a><span class="s2">                QPushButton:hover {</span>
</span><span id="PipelinePatientSelectionPage-443"><a href="#PipelinePatientSelectionPage-443"><span class="linenos"> 443</span></a><span class="s2">                    background-color: #c0c0c0;</span>
</span><span id="PipelinePatientSelectionPage-444"><a href="#PipelinePatientSelectionPage-444"><span class="linenos"> 444</span></a><span class="s2">                }</span>
</span><span id="PipelinePatientSelectionPage-445"><a href="#PipelinePatientSelectionPage-445"><span class="linenos"> 445</span></a><span class="s2">                QPushButton:checked:hover {</span>
</span><span id="PipelinePatientSelectionPage-446"><a href="#PipelinePatientSelectionPage-446"><span class="linenos"> 446</span></a><span class="s2">                    background-color: #45a049;</span>
</span><span id="PipelinePatientSelectionPage-447"><a href="#PipelinePatientSelectionPage-447"><span class="linenos"> 447</span></a><span class="s2">                }</span>
</span><span id="PipelinePatientSelectionPage-448"><a href="#PipelinePatientSelectionPage-448"><span class="linenos"> 448</span></a><span class="s2">            &quot;&quot;&quot;</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-449"><a href="#PipelinePatientSelectionPage-449"><span class="linenos"> 449</span></a>
</span><span id="PipelinePatientSelectionPage-450"><a href="#PipelinePatientSelectionPage-450"><span class="linenos"> 450</span></a>            <span class="c1"># Restore previous selection if it exists</span>
</span><span id="PipelinePatientSelectionPage-451"><a href="#PipelinePatientSelectionPage-451"><span class="linenos"> 451</span></a>            <span class="n">is_selected</span> <span class="o">=</span> <span class="n">patient_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_patients</span>
</span><span id="PipelinePatientSelectionPage-452"><a href="#PipelinePatientSelectionPage-452"><span class="linenos"> 452</span></a>            <span class="n">button</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="n">is_selected</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-453"><a href="#PipelinePatientSelectionPage-453"><span class="linenos"> 453</span></a>            <span class="n">button</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
</span><span id="PipelinePatientSelectionPage-454"><a href="#PipelinePatientSelectionPage-454"><span class="linenos"> 454</span></a>                <span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;PipelinePatientSelectionPage&quot;</span><span class="p">,</span> <span class="s2">&quot;Selected&quot;</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-455"><a href="#PipelinePatientSelectionPage-455"><span class="linenos"> 455</span></a>                <span class="k">if</span> <span class="n">is_selected</span> <span class="k">else</span> <span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;PipelinePatientSelectionPage&quot;</span><span class="p">,</span> <span class="s2">&quot;Select&quot;</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-456"><a href="#PipelinePatientSelectionPage-456"><span class="linenos"> 456</span></a>            <span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-457"><a href="#PipelinePatientSelectionPage-457"><span class="linenos"> 457</span></a>
</span><span id="PipelinePatientSelectionPage-458"><a href="#PipelinePatientSelectionPage-458"><span class="linenos"> 458</span></a>            <span class="c1"># Connect button click to selection handler</span>
</span><span id="PipelinePatientSelectionPage-459"><a href="#PipelinePatientSelectionPage-459"><span class="linenos"> 459</span></a>            <span class="n">button</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span> <span class="n">checked</span><span class="p">,</span> <span class="n">pid</span><span class="o">=</span><span class="n">patient_id</span><span class="p">,</span> <span class="n">btn</span><span class="o">=</span><span class="n">button</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_toggle_patient</span><span class="p">(</span><span class="n">pid</span><span class="p">,</span> <span class="n">checked</span><span class="p">,</span> <span class="n">btn</span><span class="p">))</span>
</span><span id="PipelinePatientSelectionPage-460"><a href="#PipelinePatientSelectionPage-460"><span class="linenos"> 460</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PipelinePatientSelectionPage-461"><a href="#PipelinePatientSelectionPage-461"><span class="linenos"> 461</span></a>            <span class="c1"># If not eligible, disable the button</span>
</span><span id="PipelinePatientSelectionPage-462"><a href="#PipelinePatientSelectionPage-462"><span class="linenos"> 462</span></a>            <span class="n">button</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;PipelinePatientSelectionPage&quot;</span><span class="p">,</span> <span class="s2">&quot;Not Eligible&quot;</span><span class="p">))</span>
</span><span id="PipelinePatientSelectionPage-463"><a href="#PipelinePatientSelectionPage-463"><span class="linenos"> 463</span></a>            <span class="n">button</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-464"><a href="#PipelinePatientSelectionPage-464"><span class="linenos"> 464</span></a>            <span class="n">button</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="PipelinePatientSelectionPage-465"><a href="#PipelinePatientSelectionPage-465"><span class="linenos"> 465</span></a><span class="s2">                QPushButton {</span>
</span><span id="PipelinePatientSelectionPage-466"><a href="#PipelinePatientSelectionPage-466"><span class="linenos"> 466</span></a><span class="s2">                    border-radius: 12px;</span>
</span><span id="PipelinePatientSelectionPage-467"><a href="#PipelinePatientSelectionPage-467"><span class="linenos"> 467</span></a><span class="s2">                    padding: 8px 16px;</span>
</span><span id="PipelinePatientSelectionPage-468"><a href="#PipelinePatientSelectionPage-468"><span class="linenos"> 468</span></a><span class="s2">                    background-color: #f0f0f0;</span>
</span><span id="PipelinePatientSelectionPage-469"><a href="#PipelinePatientSelectionPage-469"><span class="linenos"> 469</span></a><span class="s2">                    color: #888888;</span>
</span><span id="PipelinePatientSelectionPage-470"><a href="#PipelinePatientSelectionPage-470"><span class="linenos"> 470</span></a><span class="s2">                    font-weight: bold;</span>
</span><span id="PipelinePatientSelectionPage-471"><a href="#PipelinePatientSelectionPage-471"><span class="linenos"> 471</span></a><span class="s2">                    min-width: 80px;</span>
</span><span id="PipelinePatientSelectionPage-472"><a href="#PipelinePatientSelectionPage-472"><span class="linenos"> 472</span></a><span class="s2">                }</span>
</span><span id="PipelinePatientSelectionPage-473"><a href="#PipelinePatientSelectionPage-473"><span class="linenos"> 473</span></a><span class="s2">            &quot;&quot;&quot;</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-474"><a href="#PipelinePatientSelectionPage-474"><span class="linenos"> 474</span></a>
</span><span id="PipelinePatientSelectionPage-475"><a href="#PipelinePatientSelectionPage-475"><span class="linenos"> 475</span></a>        <span class="c1"># Save reference of the button in the dictionary</span>
</span><span id="PipelinePatientSelectionPage-476"><a href="#PipelinePatientSelectionPage-476"><span class="linenos"> 476</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">patient_buttons</span><span class="p">[</span><span class="n">patient_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">button</span>
</span><span id="PipelinePatientSelectionPage-477"><a href="#PipelinePatientSelectionPage-477"><span class="linenos"> 477</span></a>
</span><span id="PipelinePatientSelectionPage-478"><a href="#PipelinePatientSelectionPage-478"><span class="linenos"> 478</span></a>        <span class="c1"># Assemble all sections into the main layout</span>
</span><span id="PipelinePatientSelectionPage-479"><a href="#PipelinePatientSelectionPage-479"><span class="linenos"> 479</span></a>        <span class="n">patient_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">profile_frame</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-480"><a href="#PipelinePatientSelectionPage-480"><span class="linenos"> 480</span></a>        <span class="n">patient_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">details_frame</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-481"><a href="#PipelinePatientSelectionPage-481"><span class="linenos"> 481</span></a>        <span class="n">patient_layout</span><span class="o">.</span><span class="n">addStretch</span><span class="p">()</span>  <span class="c1"># Flexible space</span>
</span><span id="PipelinePatientSelectionPage-482"><a href="#PipelinePatientSelectionPage-482"><span class="linenos"> 482</span></a>        <span class="n">patient_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">button</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-483"><a href="#PipelinePatientSelectionPage-483"><span class="linenos"> 483</span></a>
</span><span id="PipelinePatientSelectionPage-484"><a href="#PipelinePatientSelectionPage-484"><span class="linenos"> 484</span></a>        <span class="k">return</span> <span class="n">patient_frame</span>
</span><span id="PipelinePatientSelectionPage-485"><a href="#PipelinePatientSelectionPage-485"><span class="linenos"> 485</span></a>
</span><span id="PipelinePatientSelectionPage-486"><a href="#PipelinePatientSelectionPage-486"><span class="linenos"> 486</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_update_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eligible_count</span><span class="p">,</span> <span class="n">total_count</span><span class="p">):</span>
</span><span id="PipelinePatientSelectionPage-487"><a href="#PipelinePatientSelectionPage-487"><span class="linenos"> 487</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the patient summary values&quot;&quot;&quot;</span>
</span><span id="PipelinePatientSelectionPage-488"><a href="#PipelinePatientSelectionPage-488"><span class="linenos"> 488</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">total_label</span><span class="o">.</span><span class="n">value_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">total_count</span><span class="p">))</span>
</span><span id="PipelinePatientSelectionPage-489"><a href="#PipelinePatientSelectionPage-489"><span class="linenos"> 489</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">eligible_label</span><span class="o">.</span><span class="n">value_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">eligible_count</span><span class="p">))</span>
</span><span id="PipelinePatientSelectionPage-490"><a href="#PipelinePatientSelectionPage-490"><span class="linenos"> 490</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">not_eligible_label</span><span class="o">.</span><span class="n">value_label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">total_count</span> <span class="o">-</span> <span class="n">eligible_count</span><span class="p">))</span>
</span><span id="PipelinePatientSelectionPage-491"><a href="#PipelinePatientSelectionPage-491"><span class="linenos"> 491</span></a>
</span><span id="PipelinePatientSelectionPage-492"><a href="#PipelinePatientSelectionPage-492"><span class="linenos"> 492</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_select_all_eligible_patients</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="PipelinePatientSelectionPage-493"><a href="#PipelinePatientSelectionPage-493"><span class="linenos"> 493</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Automatically select all eligible patients&quot;&quot;&quot;</span>
</span><span id="PipelinePatientSelectionPage-494"><a href="#PipelinePatientSelectionPage-494"><span class="linenos"> 494</span></a>        <span class="k">for</span> <span class="n">patient_id</span><span class="p">,</span> <span class="n">button</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">patient_buttons</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="PipelinePatientSelectionPage-495"><a href="#PipelinePatientSelectionPage-495"><span class="linenos"> 495</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">patient_status</span><span class="p">[</span><span class="n">patient_id</span><span class="p">][</span><span class="s1">&#39;eligible&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">button</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
</span><span id="PipelinePatientSelectionPage-496"><a href="#PipelinePatientSelectionPage-496"><span class="linenos"> 496</span></a>                <span class="n">button</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-497"><a href="#PipelinePatientSelectionPage-497"><span class="linenos"> 497</span></a>                <span class="n">button</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;PipelinePatientSelectionPage&quot;</span><span class="p">,</span> <span class="s2">&quot;Selected&quot;</span><span class="p">))</span>
</span><span id="PipelinePatientSelectionPage-498"><a href="#PipelinePatientSelectionPage-498"><span class="linenos"> 498</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">selected_patients</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">patient_id</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-499"><a href="#PipelinePatientSelectionPage-499"><span class="linenos"> 499</span></a>        <span class="c1"># Update main app buttons</span>
</span><span id="PipelinePatientSelectionPage-500"><a href="#PipelinePatientSelectionPage-500"><span class="linenos"> 500</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="ow">and</span> <span class="s2">&quot;update_main_buttons&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">:</span>
</span><span id="PipelinePatientSelectionPage-501"><a href="#PipelinePatientSelectionPage-501"><span class="linenos"> 501</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s2">&quot;update_main_buttons&quot;</span><span class="p">]()</span>
</span><span id="PipelinePatientSelectionPage-502"><a href="#PipelinePatientSelectionPage-502"><span class="linenos"> 502</span></a>
</span><span id="PipelinePatientSelectionPage-503"><a href="#PipelinePatientSelectionPage-503"><span class="linenos"> 503</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_deselect_all_patients</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="PipelinePatientSelectionPage-504"><a href="#PipelinePatientSelectionPage-504"><span class="linenos"> 504</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Deselect all patients&quot;&quot;&quot;</span>
</span><span id="PipelinePatientSelectionPage-505"><a href="#PipelinePatientSelectionPage-505"><span class="linenos"> 505</span></a>        <span class="k">for</span> <span class="n">patient_id</span><span class="p">,</span> <span class="n">button</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">patient_buttons</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="PipelinePatientSelectionPage-506"><a href="#PipelinePatientSelectionPage-506"><span class="linenos"> 506</span></a>            <span class="k">if</span> <span class="n">button</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span> <span class="ow">and</span> <span class="n">button</span><span class="o">.</span><span class="n">isEnabled</span><span class="p">():</span>
</span><span id="PipelinePatientSelectionPage-507"><a href="#PipelinePatientSelectionPage-507"><span class="linenos"> 507</span></a>                <span class="n">button</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-508"><a href="#PipelinePatientSelectionPage-508"><span class="linenos"> 508</span></a>                <span class="n">button</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;PipelinePatientSelectionPage&quot;</span><span class="p">,</span> <span class="s2">&quot;Select&quot;</span><span class="p">))</span>
</span><span id="PipelinePatientSelectionPage-509"><a href="#PipelinePatientSelectionPage-509"><span class="linenos"> 509</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">selected_patients</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">patient_id</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-510"><a href="#PipelinePatientSelectionPage-510"><span class="linenos"> 510</span></a>        <span class="c1"># Update main buttons</span>
</span><span id="PipelinePatientSelectionPage-511"><a href="#PipelinePatientSelectionPage-511"><span class="linenos"> 511</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="ow">and</span> <span class="s2">&quot;update_main_buttons&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">:</span>
</span><span id="PipelinePatientSelectionPage-512"><a href="#PipelinePatientSelectionPage-512"><span class="linenos"> 512</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s2">&quot;update_main_buttons&quot;</span><span class="p">]()</span>
</span><span id="PipelinePatientSelectionPage-513"><a href="#PipelinePatientSelectionPage-513"><span class="linenos"> 513</span></a>
</span><span id="PipelinePatientSelectionPage-514"><a href="#PipelinePatientSelectionPage-514"><span class="linenos"> 514</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_refresh_patient_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="PipelinePatientSelectionPage-515"><a href="#PipelinePatientSelectionPage-515"><span class="linenos"> 515</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Completely reload patient status&quot;&quot;&quot;</span>
</span><span id="PipelinePatientSelectionPage-516"><a href="#PipelinePatientSelectionPage-516"><span class="linenos"> 516</span></a>        <span class="c1"># Save current selections</span>
</span><span id="PipelinePatientSelectionPage-517"><a href="#PipelinePatientSelectionPage-517"><span class="linenos"> 517</span></a>        <span class="n">current_selections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_patients</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="PipelinePatientSelectionPage-518"><a href="#PipelinePatientSelectionPage-518"><span class="linenos"> 518</span></a>
</span><span id="PipelinePatientSelectionPage-519"><a href="#PipelinePatientSelectionPage-519"><span class="linenos"> 519</span></a>        <span class="c1"># Remove existing widgets from the grid</span>
</span><span id="PipelinePatientSelectionPage-520"><a href="#PipelinePatientSelectionPage-520"><span class="linenos"> 520</span></a>        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_layout</span><span class="o">.</span><span class="n">count</span><span class="p">():</span>
</span><span id="PipelinePatientSelectionPage-521"><a href="#PipelinePatientSelectionPage-521"><span class="linenos"> 521</span></a>            <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_layout</span><span class="o">.</span><span class="n">takeAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-522"><a href="#PipelinePatientSelectionPage-522"><span class="linenos"> 522</span></a>            <span class="n">widget</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span>
</span><span id="PipelinePatientSelectionPage-523"><a href="#PipelinePatientSelectionPage-523"><span class="linenos"> 523</span></a>            <span class="k">if</span> <span class="n">widget</span><span class="p">:</span>
</span><span id="PipelinePatientSelectionPage-524"><a href="#PipelinePatientSelectionPage-524"><span class="linenos"> 524</span></a>                <span class="n">widget</span><span class="o">.</span><span class="n">setParent</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-525"><a href="#PipelinePatientSelectionPage-525"><span class="linenos"> 525</span></a>                <span class="n">widget</span><span class="o">.</span><span class="n">deleteLater</span><span class="p">()</span>
</span><span id="PipelinePatientSelectionPage-526"><a href="#PipelinePatientSelectionPage-526"><span class="linenos"> 526</span></a>
</span><span id="PipelinePatientSelectionPage-527"><a href="#PipelinePatientSelectionPage-527"><span class="linenos"> 527</span></a>        <span class="c1"># Reload patients and update status</span>
</span><span id="PipelinePatientSelectionPage-528"><a href="#PipelinePatientSelectionPage-528"><span class="linenos"> 528</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_load_patients</span><span class="p">()</span>
</span><span id="PipelinePatientSelectionPage-529"><a href="#PipelinePatientSelectionPage-529"><span class="linenos"> 529</span></a>
</span><span id="PipelinePatientSelectionPage-530"><a href="#PipelinePatientSelectionPage-530"><span class="linenos"> 530</span></a>        <span class="c1"># Restore still-valid selections</span>
</span><span id="PipelinePatientSelectionPage-531"><a href="#PipelinePatientSelectionPage-531"><span class="linenos"> 531</span></a>        <span class="n">valid_selections</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="PipelinePatientSelectionPage-532"><a href="#PipelinePatientSelectionPage-532"><span class="linenos"> 532</span></a>        <span class="k">for</span> <span class="n">patient_id</span> <span class="ow">in</span> <span class="n">current_selections</span><span class="p">:</span>
</span><span id="PipelinePatientSelectionPage-533"><a href="#PipelinePatientSelectionPage-533"><span class="linenos"> 533</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">patient_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">patient_status</span> <span class="ow">and</span>
</span><span id="PipelinePatientSelectionPage-534"><a href="#PipelinePatientSelectionPage-534"><span class="linenos"> 534</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">patient_status</span><span class="p">[</span><span class="n">patient_id</span><span class="p">][</span><span class="s1">&#39;eligible&#39;</span><span class="p">]</span> <span class="ow">and</span>
</span><span id="PipelinePatientSelectionPage-535"><a href="#PipelinePatientSelectionPage-535"><span class="linenos"> 535</span></a>                    <span class="n">patient_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">patient_buttons</span><span class="p">):</span>
</span><span id="PipelinePatientSelectionPage-536"><a href="#PipelinePatientSelectionPage-536"><span class="linenos"> 536</span></a>                <span class="n">valid_selections</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">patient_id</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-537"><a href="#PipelinePatientSelectionPage-537"><span class="linenos"> 537</span></a>                <span class="n">button</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">patient_buttons</span><span class="p">[</span><span class="n">patient_id</span><span class="p">]</span>
</span><span id="PipelinePatientSelectionPage-538"><a href="#PipelinePatientSelectionPage-538"><span class="linenos"> 538</span></a>                <span class="n">button</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-539"><a href="#PipelinePatientSelectionPage-539"><span class="linenos"> 539</span></a>                <span class="n">button</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;PipelinePatientSelectionPage&quot;</span><span class="p">,</span> <span class="s2">&quot;Selected&quot;</span><span class="p">))</span>
</span><span id="PipelinePatientSelectionPage-540"><a href="#PipelinePatientSelectionPage-540"><span class="linenos"> 540</span></a>
</span><span id="PipelinePatientSelectionPage-541"><a href="#PipelinePatientSelectionPage-541"><span class="linenos"> 541</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">selected_patients</span> <span class="o">=</span> <span class="n">valid_selections</span>
</span><span id="PipelinePatientSelectionPage-542"><a href="#PipelinePatientSelectionPage-542"><span class="linenos"> 542</span></a>
</span><span id="PipelinePatientSelectionPage-543"><a href="#PipelinePatientSelectionPage-543"><span class="linenos"> 543</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_toggle_patient</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patient_id</span><span class="p">,</span> <span class="n">is_selected</span><span class="p">,</span> <span class="n">button</span><span class="p">):</span>
</span><span id="PipelinePatientSelectionPage-544"><a href="#PipelinePatientSelectionPage-544"><span class="linenos"> 544</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle selection/deselection of a single patient&quot;&quot;&quot;</span>
</span><span id="PipelinePatientSelectionPage-545"><a href="#PipelinePatientSelectionPage-545"><span class="linenos"> 545</span></a>        <span class="k">if</span> <span class="n">is_selected</span><span class="p">:</span>
</span><span id="PipelinePatientSelectionPage-546"><a href="#PipelinePatientSelectionPage-546"><span class="linenos"> 546</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">selected_patients</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">patient_id</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-547"><a href="#PipelinePatientSelectionPage-547"><span class="linenos"> 547</span></a>            <span class="n">button</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;PipelinePatientSelectionPage&quot;</span><span class="p">,</span> <span class="s2">&quot;Selected&quot;</span><span class="p">))</span>
</span><span id="PipelinePatientSelectionPage-548"><a href="#PipelinePatientSelectionPage-548"><span class="linenos"> 548</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PipelinePatientSelectionPage-549"><a href="#PipelinePatientSelectionPage-549"><span class="linenos"> 549</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">selected_patients</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">patient_id</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-550"><a href="#PipelinePatientSelectionPage-550"><span class="linenos"> 550</span></a>            <span class="n">button</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;PipelinePatientSelectionPage&quot;</span><span class="p">,</span> <span class="s2">&quot;Select&quot;</span><span class="p">))</span>
</span><span id="PipelinePatientSelectionPage-551"><a href="#PipelinePatientSelectionPage-551"><span class="linenos"> 551</span></a>        <span class="c1"># Update main buttons</span>
</span><span id="PipelinePatientSelectionPage-552"><a href="#PipelinePatientSelectionPage-552"><span class="linenos"> 552</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="ow">and</span> <span class="s2">&quot;update_main_buttons&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">:</span>
</span><span id="PipelinePatientSelectionPage-553"><a href="#PipelinePatientSelectionPage-553"><span class="linenos"> 553</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s2">&quot;update_main_buttons&quot;</span><span class="p">]()</span>
</span><span id="PipelinePatientSelectionPage-554"><a href="#PipelinePatientSelectionPage-554"><span class="linenos"> 554</span></a>
</span><span id="PipelinePatientSelectionPage-555"><a href="#PipelinePatientSelectionPage-555"><span class="linenos"> 555</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_find_patient_dirs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="PipelinePatientSelectionPage-556"><a href="#PipelinePatientSelectionPage-556"><span class="linenos"> 556</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Search for all patient directories in the workspace (excluding derivatives and pipeline)&quot;&quot;&quot;</span>
</span><span id="PipelinePatientSelectionPage-557"><a href="#PipelinePatientSelectionPage-557"><span class="linenos"> 557</span></a>        <span class="n">patient_dirs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="PipelinePatientSelectionPage-558"><a href="#PipelinePatientSelectionPage-558"><span class="linenos"> 558</span></a>
</span><span id="PipelinePatientSelectionPage-559"><a href="#PipelinePatientSelectionPage-559"><span class="linenos"> 559</span></a>        <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workspace_path</span><span class="p">):</span>
</span><span id="PipelinePatientSelectionPage-560"><a href="#PipelinePatientSelectionPage-560"><span class="linenos"> 560</span></a>            <span class="c1"># Exclude irrelevant folders</span>
</span><span id="PipelinePatientSelectionPage-561"><a href="#PipelinePatientSelectionPage-561"><span class="linenos"> 561</span></a>            <span class="k">if</span> <span class="s2">&quot;derivatives&quot;</span> <span class="ow">in</span> <span class="n">dirs</span><span class="p">:</span>
</span><span id="PipelinePatientSelectionPage-562"><a href="#PipelinePatientSelectionPage-562"><span class="linenos"> 562</span></a>                <span class="n">dirs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;derivatives&quot;</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-563"><a href="#PipelinePatientSelectionPage-563"><span class="linenos"> 563</span></a>            <span class="k">if</span> <span class="s2">&quot;pipeline&quot;</span> <span class="ow">in</span> <span class="n">dirs</span><span class="p">:</span>
</span><span id="PipelinePatientSelectionPage-564"><a href="#PipelinePatientSelectionPage-564"><span class="linenos"> 564</span></a>                <span class="n">dirs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;pipeline&quot;</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-565"><a href="#PipelinePatientSelectionPage-565"><span class="linenos"> 565</span></a>
</span><span id="PipelinePatientSelectionPage-566"><a href="#PipelinePatientSelectionPage-566"><span class="linenos"> 566</span></a>            <span class="c1"># Add directories starting with &quot;sub-&quot;</span>
</span><span id="PipelinePatientSelectionPage-567"><a href="#PipelinePatientSelectionPage-567"><span class="linenos"> 567</span></a>            <span class="k">for</span> <span class="n">dir_name</span> <span class="ow">in</span> <span class="n">dirs</span><span class="p">:</span>
</span><span id="PipelinePatientSelectionPage-568"><a href="#PipelinePatientSelectionPage-568"><span class="linenos"> 568</span></a>                <span class="k">if</span> <span class="n">dir_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;sub-&quot;</span><span class="p">):</span>
</span><span id="PipelinePatientSelectionPage-569"><a href="#PipelinePatientSelectionPage-569"><span class="linenos"> 569</span></a>                    <span class="n">full_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">dir_name</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-570"><a href="#PipelinePatientSelectionPage-570"><span class="linenos"> 570</span></a>                    <span class="n">patient_dirs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">full_path</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-571"><a href="#PipelinePatientSelectionPage-571"><span class="linenos"> 571</span></a>
</span><span id="PipelinePatientSelectionPage-572"><a href="#PipelinePatientSelectionPage-572"><span class="linenos"> 572</span></a>            <span class="c1"># Prevent going deeper into sub-* directories</span>
</span><span id="PipelinePatientSelectionPage-573"><a href="#PipelinePatientSelectionPage-573"><span class="linenos"> 573</span></a>            <span class="n">dirs</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dirs</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">d</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;sub-&quot;</span><span class="p">)]</span>
</span><span id="PipelinePatientSelectionPage-574"><a href="#PipelinePatientSelectionPage-574"><span class="linenos"> 574</span></a>
</span><span id="PipelinePatientSelectionPage-575"><a href="#PipelinePatientSelectionPage-575"><span class="linenos"> 575</span></a>        <span class="k">return</span> <span class="n">patient_dirs</span>
</span><span id="PipelinePatientSelectionPage-576"><a href="#PipelinePatientSelectionPage-576"><span class="linenos"> 576</span></a>
</span><span id="PipelinePatientSelectionPage-577"><a href="#PipelinePatientSelectionPage-577"><span class="linenos"> 577</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_update_column_count</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="PipelinePatientSelectionPage-578"><a href="#PipelinePatientSelectionPage-578"><span class="linenos"> 578</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the number of grid columns based on available width&quot;&quot;&quot;</span>
</span><span id="PipelinePatientSelectionPage-579"><a href="#PipelinePatientSelectionPage-579"><span class="linenos"> 579</span></a>        <span class="n">available_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scroll_area</span><span class="o">.</span><span class="n">viewport</span><span class="p">()</span><span class="o">.</span><span class="n">width</span><span class="p">()</span> <span class="o">-</span> <span class="mi">40</span>
</span><span id="PipelinePatientSelectionPage-580"><a href="#PipelinePatientSelectionPage-580"><span class="linenos"> 580</span></a>        <span class="n">min_card_width</span> <span class="o">=</span> <span class="mi">400</span>  <span class="c1"># Minimum width for a card</span>
</span><span id="PipelinePatientSelectionPage-581"><a href="#PipelinePatientSelectionPage-581"><span class="linenos"> 581</span></a>
</span><span id="PipelinePatientSelectionPage-582"><a href="#PipelinePatientSelectionPage-582"><span class="linenos"> 582</span></a>        <span class="n">new_column_count</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">available_width</span> <span class="o">//</span> <span class="n">min_card_width</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-583"><a href="#PipelinePatientSelectionPage-583"><span class="linenos"> 583</span></a>
</span><span id="PipelinePatientSelectionPage-584"><a href="#PipelinePatientSelectionPage-584"><span class="linenos"> 584</span></a>        <span class="c1"># If column count changes, reload the grid</span>
</span><span id="PipelinePatientSelectionPage-585"><a href="#PipelinePatientSelectionPage-585"><span class="linenos"> 585</span></a>        <span class="k">if</span> <span class="n">new_column_count</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">column_count</span><span class="p">:</span>
</span><span id="PipelinePatientSelectionPage-586"><a href="#PipelinePatientSelectionPage-586"><span class="linenos"> 586</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">column_count</span> <span class="o">=</span> <span class="n">new_column_count</span>
</span><span id="PipelinePatientSelectionPage-587"><a href="#PipelinePatientSelectionPage-587"><span class="linenos"> 587</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_reload_patient_grid</span><span class="p">()</span>
</span><span id="PipelinePatientSelectionPage-588"><a href="#PipelinePatientSelectionPage-588"><span class="linenos"> 588</span></a>
</span><span id="PipelinePatientSelectionPage-589"><a href="#PipelinePatientSelectionPage-589"><span class="linenos"> 589</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_reload_patient_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="PipelinePatientSelectionPage-590"><a href="#PipelinePatientSelectionPage-590"><span class="linenos"> 590</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Reload the grid while keeping current selections&quot;&quot;&quot;</span>
</span><span id="PipelinePatientSelectionPage-591"><a href="#PipelinePatientSelectionPage-591"><span class="linenos"> 591</span></a>        <span class="n">selected</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_patients</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="PipelinePatientSelectionPage-592"><a href="#PipelinePatientSelectionPage-592"><span class="linenos"> 592</span></a>
</span><span id="PipelinePatientSelectionPage-593"><a href="#PipelinePatientSelectionPage-593"><span class="linenos"> 593</span></a>        <span class="c1"># Remove existing widgets</span>
</span><span id="PipelinePatientSelectionPage-594"><a href="#PipelinePatientSelectionPage-594"><span class="linenos"> 594</span></a>        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_layout</span><span class="o">.</span><span class="n">count</span><span class="p">():</span>
</span><span id="PipelinePatientSelectionPage-595"><a href="#PipelinePatientSelectionPage-595"><span class="linenos"> 595</span></a>            <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_layout</span><span class="o">.</span><span class="n">takeAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-596"><a href="#PipelinePatientSelectionPage-596"><span class="linenos"> 596</span></a>            <span class="n">widget</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span>
</span><span id="PipelinePatientSelectionPage-597"><a href="#PipelinePatientSelectionPage-597"><span class="linenos"> 597</span></a>            <span class="k">if</span> <span class="n">widget</span><span class="p">:</span>
</span><span id="PipelinePatientSelectionPage-598"><a href="#PipelinePatientSelectionPage-598"><span class="linenos"> 598</span></a>                <span class="n">widget</span><span class="o">.</span><span class="n">setParent</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-599"><a href="#PipelinePatientSelectionPage-599"><span class="linenos"> 599</span></a>                <span class="n">widget</span><span class="o">.</span><span class="n">deleteLater</span><span class="p">()</span>
</span><span id="PipelinePatientSelectionPage-600"><a href="#PipelinePatientSelectionPage-600"><span class="linenos"> 600</span></a>
</span><span id="PipelinePatientSelectionPage-601"><a href="#PipelinePatientSelectionPage-601"><span class="linenos"> 601</span></a>        <span class="c1"># Reload patients in the new layout</span>
</span><span id="PipelinePatientSelectionPage-602"><a href="#PipelinePatientSelectionPage-602"><span class="linenos"> 602</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_load_patients</span><span class="p">()</span>
</span><span id="PipelinePatientSelectionPage-603"><a href="#PipelinePatientSelectionPage-603"><span class="linenos"> 603</span></a>
</span><span id="PipelinePatientSelectionPage-604"><a href="#PipelinePatientSelectionPage-604"><span class="linenos"> 604</span></a>        <span class="c1"># Restore valid selections</span>
</span><span id="PipelinePatientSelectionPage-605"><a href="#PipelinePatientSelectionPage-605"><span class="linenos"> 605</span></a>        <span class="n">valid_selections</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="PipelinePatientSelectionPage-606"><a href="#PipelinePatientSelectionPage-606"><span class="linenos"> 606</span></a>        <span class="k">for</span> <span class="n">patient_id</span> <span class="ow">in</span> <span class="n">selected</span><span class="p">:</span>
</span><span id="PipelinePatientSelectionPage-607"><a href="#PipelinePatientSelectionPage-607"><span class="linenos"> 607</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">patient_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">patient_status</span> <span class="ow">and</span>
</span><span id="PipelinePatientSelectionPage-608"><a href="#PipelinePatientSelectionPage-608"><span class="linenos"> 608</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">patient_status</span><span class="p">[</span><span class="n">patient_id</span><span class="p">][</span><span class="s1">&#39;eligible&#39;</span><span class="p">]</span> <span class="ow">and</span>
</span><span id="PipelinePatientSelectionPage-609"><a href="#PipelinePatientSelectionPage-609"><span class="linenos"> 609</span></a>                    <span class="n">patient_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">patient_buttons</span><span class="p">):</span>
</span><span id="PipelinePatientSelectionPage-610"><a href="#PipelinePatientSelectionPage-610"><span class="linenos"> 610</span></a>                <span class="n">valid_selections</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">patient_id</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-611"><a href="#PipelinePatientSelectionPage-611"><span class="linenos"> 611</span></a>                <span class="n">button</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">patient_buttons</span><span class="p">[</span><span class="n">patient_id</span><span class="p">]</span>
</span><span id="PipelinePatientSelectionPage-612"><a href="#PipelinePatientSelectionPage-612"><span class="linenos"> 612</span></a>                <span class="n">button</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-613"><a href="#PipelinePatientSelectionPage-613"><span class="linenos"> 613</span></a>                <span class="n">button</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;PipelinePatientSelectionPage&quot;</span><span class="p">,</span> <span class="s2">&quot;Selected&quot;</span><span class="p">))</span>
</span><span id="PipelinePatientSelectionPage-614"><a href="#PipelinePatientSelectionPage-614"><span class="linenos"> 614</span></a>
</span><span id="PipelinePatientSelectionPage-615"><a href="#PipelinePatientSelectionPage-615"><span class="linenos"> 615</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">selected_patients</span> <span class="o">=</span> <span class="n">valid_selections</span>
</span><span id="PipelinePatientSelectionPage-616"><a href="#PipelinePatientSelectionPage-616"><span class="linenos"> 616</span></a>
</span><span id="PipelinePatientSelectionPage-617"><a href="#PipelinePatientSelectionPage-617"><span class="linenos"> 617</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_build_pipeline_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="PipelinePatientSelectionPage-618"><a href="#PipelinePatientSelectionPage-618"><span class="linenos"> 618</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create and save a JSON file containing the initial pipeline configuration.</span>
</span><span id="PipelinePatientSelectionPage-619"><a href="#PipelinePatientSelectionPage-619"><span class="linenos"> 619</span></a>
</span><span id="PipelinePatientSelectionPage-620"><a href="#PipelinePatientSelectionPage-620"><span class="linenos"> 620</span></a><span class="sd">        All paths inside the JSON are relative to the `workspace_path`.</span>
</span><span id="PipelinePatientSelectionPage-621"><a href="#PipelinePatientSelectionPage-621"><span class="linenos"> 621</span></a><span class="sd">        The configuration file is saved with a sequential numeric ID (e.g., 01_config.json).</span>
</span><span id="PipelinePatientSelectionPage-622"><a href="#PipelinePatientSelectionPage-622"><span class="linenos"> 622</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PipelinePatientSelectionPage-623"><a href="#PipelinePatientSelectionPage-623"><span class="linenos"> 623</span></a>        <span class="n">config</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Main dictionary that will store configuration data for all patients</span>
</span><span id="PipelinePatientSelectionPage-624"><a href="#PipelinePatientSelectionPage-624"><span class="linenos"> 624</span></a>
</span><span id="PipelinePatientSelectionPage-625"><a href="#PipelinePatientSelectionPage-625"><span class="linenos"> 625</span></a>        <span class="c1"># Iterate over all selected patients</span>
</span><span id="PipelinePatientSelectionPage-626"><a href="#PipelinePatientSelectionPage-626"><span class="linenos"> 626</span></a>        <span class="k">for</span> <span class="n">patient_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_patients</span><span class="p">:</span>
</span><span id="PipelinePatientSelectionPage-627"><a href="#PipelinePatientSelectionPage-627"><span class="linenos"> 627</span></a>            <span class="n">patient_entry</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Holds the configuration for a single patient</span>
</span><span id="PipelinePatientSelectionPage-628"><a href="#PipelinePatientSelectionPage-628"><span class="linenos"> 628</span></a>            <span class="n">need_revision</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Flag indicating if manual review is required due to ambiguities</span>
</span><span id="PipelinePatientSelectionPage-629"><a href="#PipelinePatientSelectionPage-629"><span class="linenos"> 629</span></a>
</span><span id="PipelinePatientSelectionPage-630"><a href="#PipelinePatientSelectionPage-630"><span class="linenos"> 630</span></a>            <span class="c1"># ----------------------------------------------------</span>
</span><span id="PipelinePatientSelectionPage-631"><a href="#PipelinePatientSelectionPage-631"><span class="linenos"> 631</span></a>            <span class="c1"># MRI (FLAIR)</span>
</span><span id="PipelinePatientSelectionPage-632"><a href="#PipelinePatientSelectionPage-632"><span class="linenos"> 632</span></a>            <span class="c1"># ----------------------------------------------------</span>
</span><span id="PipelinePatientSelectionPage-633"><a href="#PipelinePatientSelectionPage-633"><span class="linenos"> 633</span></a>            <span class="n">flair_patterns</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="PipelinePatientSelectionPage-634"><a href="#PipelinePatientSelectionPage-634"><span class="linenos"> 634</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workspace_path</span><span class="p">,</span> <span class="n">patient_id</span><span class="p">,</span> <span class="s2">&quot;anat&quot;</span><span class="p">,</span> <span class="s2">&quot;*_flair.nii&quot;</span><span class="p">),</span>
</span><span id="PipelinePatientSelectionPage-635"><a href="#PipelinePatientSelectionPage-635"><span class="linenos"> 635</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workspace_path</span><span class="p">,</span> <span class="n">patient_id</span><span class="p">,</span> <span class="s2">&quot;anat&quot;</span><span class="p">,</span> <span class="s2">&quot;*_flair.nii.gz&quot;</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-636"><a href="#PipelinePatientSelectionPage-636"><span class="linenos"> 636</span></a>            <span class="p">]</span>
</span><span id="PipelinePatientSelectionPage-637"><a href="#PipelinePatientSelectionPage-637"><span class="linenos"> 637</span></a>            <span class="n">flair_files</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="PipelinePatientSelectionPage-638"><a href="#PipelinePatientSelectionPage-638"><span class="linenos"> 638</span></a>            <span class="c1"># Search for FLAIR MRI files matching the defined patterns</span>
</span><span id="PipelinePatientSelectionPage-639"><a href="#PipelinePatientSelectionPage-639"><span class="linenos"> 639</span></a>            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">flair_patterns</span><span class="p">:</span>
</span><span id="PipelinePatientSelectionPage-640"><a href="#PipelinePatientSelectionPage-640"><span class="linenos"> 640</span></a>                <span class="n">flair_files</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
</span><span id="PipelinePatientSelectionPage-641"><a href="#PipelinePatientSelectionPage-641"><span class="linenos"> 641</span></a>            <span class="c1"># If more than one FLAIR file exists, mark for manual revision</span>
</span><span id="PipelinePatientSelectionPage-642"><a href="#PipelinePatientSelectionPage-642"><span class="linenos"> 642</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">flair_files</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="PipelinePatientSelectionPage-643"><a href="#PipelinePatientSelectionPage-643"><span class="linenos"> 643</span></a>                <span class="n">need_revision</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="PipelinePatientSelectionPage-644"><a href="#PipelinePatientSelectionPage-644"><span class="linenos"> 644</span></a>            <span class="c1"># Store the relative path of the FLAIR file if found</span>
</span><span id="PipelinePatientSelectionPage-645"><a href="#PipelinePatientSelectionPage-645"><span class="linenos"> 645</span></a>            <span class="n">patient_entry</span><span class="p">[</span><span class="s2">&quot;mri&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">flair_files</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">workspace_path</span><span class="p">)</span> <span class="k">if</span> <span class="n">flair_files</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="PipelinePatientSelectionPage-646"><a href="#PipelinePatientSelectionPage-646"><span class="linenos"> 646</span></a>
</span><span id="PipelinePatientSelectionPage-647"><a href="#PipelinePatientSelectionPage-647"><span class="linenos"> 647</span></a>            <span class="c1"># ----------------------------------------------------</span>
</span><span id="PipelinePatientSelectionPage-648"><a href="#PipelinePatientSelectionPage-648"><span class="linenos"> 648</span></a>            <span class="c1"># MRI Skull Stripped</span>
</span><span id="PipelinePatientSelectionPage-649"><a href="#PipelinePatientSelectionPage-649"><span class="linenos"> 649</span></a>            <span class="c1"># ----------------------------------------------------</span>
</span><span id="PipelinePatientSelectionPage-650"><a href="#PipelinePatientSelectionPage-650"><span class="linenos"> 650</span></a>            <span class="n">mri_str_patterns</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="PipelinePatientSelectionPage-651"><a href="#PipelinePatientSelectionPage-651"><span class="linenos"> 651</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workspace_path</span><span class="p">,</span> <span class="s2">&quot;derivatives&quot;</span><span class="p">,</span> <span class="s2">&quot;skullstrips&quot;</span><span class="p">,</span> <span class="n">patient_id</span><span class="p">,</span> <span class="s2">&quot;anat&quot;</span><span class="p">,</span> <span class="s2">&quot;*_brain.nii&quot;</span><span class="p">),</span>
</span><span id="PipelinePatientSelectionPage-652"><a href="#PipelinePatientSelectionPage-652"><span class="linenos"> 652</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workspace_path</span><span class="p">,</span> <span class="s2">&quot;derivatives&quot;</span><span class="p">,</span> <span class="s2">&quot;skullstrips&quot;</span><span class="p">,</span> <span class="n">patient_id</span><span class="p">,</span> <span class="s2">&quot;anat&quot;</span><span class="p">,</span> <span class="s2">&quot;*_brain.nii.gz&quot;</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-653"><a href="#PipelinePatientSelectionPage-653"><span class="linenos"> 653</span></a>            <span class="p">]</span>
</span><span id="PipelinePatientSelectionPage-654"><a href="#PipelinePatientSelectionPage-654"><span class="linenos"> 654</span></a>            <span class="n">mri_str_files</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="PipelinePatientSelectionPage-655"><a href="#PipelinePatientSelectionPage-655"><span class="linenos"> 655</span></a>            <span class="c1"># Search for preprocessed (skull-stripped) MRI files</span>
</span><span id="PipelinePatientSelectionPage-656"><a href="#PipelinePatientSelectionPage-656"><span class="linenos"> 656</span></a>            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">mri_str_patterns</span><span class="p">:</span>
</span><span id="PipelinePatientSelectionPage-657"><a href="#PipelinePatientSelectionPage-657"><span class="linenos"> 657</span></a>                <span class="n">mri_str_files</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
</span><span id="PipelinePatientSelectionPage-658"><a href="#PipelinePatientSelectionPage-658"><span class="linenos"> 658</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mri_str_files</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="PipelinePatientSelectionPage-659"><a href="#PipelinePatientSelectionPage-659"><span class="linenos"> 659</span></a>                <span class="n">need_revision</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="PipelinePatientSelectionPage-660"><a href="#PipelinePatientSelectionPage-660"><span class="linenos"> 660</span></a>            <span class="n">patient_entry</span><span class="p">[</span><span class="s2">&quot;mri_str&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">mri_str_files</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">workspace_path</span><span class="p">)</span> <span class="k">if</span> <span class="n">mri_str_files</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="PipelinePatientSelectionPage-661"><a href="#PipelinePatientSelectionPage-661"><span class="linenos"> 661</span></a>
</span><span id="PipelinePatientSelectionPage-662"><a href="#PipelinePatientSelectionPage-662"><span class="linenos"> 662</span></a>            <span class="c1"># ----------------------------------------------------</span>
</span><span id="PipelinePatientSelectionPage-663"><a href="#PipelinePatientSelectionPage-663"><span class="linenos"> 663</span></a>            <span class="c1"># Static PET (Session 01)</span>
</span><span id="PipelinePatientSelectionPage-664"><a href="#PipelinePatientSelectionPage-664"><span class="linenos"> 664</span></a>            <span class="c1"># ----------------------------------------------------</span>
</span><span id="PipelinePatientSelectionPage-665"><a href="#PipelinePatientSelectionPage-665"><span class="linenos"> 665</span></a>            <span class="n">pet_patterns</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="PipelinePatientSelectionPage-666"><a href="#PipelinePatientSelectionPage-666"><span class="linenos"> 666</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workspace_path</span><span class="p">,</span> <span class="n">patient_id</span><span class="p">,</span> <span class="s2">&quot;ses-01&quot;</span><span class="p">,</span> <span class="s2">&quot;pet&quot;</span><span class="p">,</span> <span class="s2">&quot;*_pet.nii&quot;</span><span class="p">),</span>
</span><span id="PipelinePatientSelectionPage-667"><a href="#PipelinePatientSelectionPage-667"><span class="linenos"> 667</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workspace_path</span><span class="p">,</span> <span class="n">patient_id</span><span class="p">,</span> <span class="s2">&quot;ses-01&quot;</span><span class="p">,</span> <span class="s2">&quot;pet&quot;</span><span class="p">,</span> <span class="s2">&quot;*_pet.nii.gz&quot;</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-668"><a href="#PipelinePatientSelectionPage-668"><span class="linenos"> 668</span></a>            <span class="p">]</span>
</span><span id="PipelinePatientSelectionPage-669"><a href="#PipelinePatientSelectionPage-669"><span class="linenos"> 669</span></a>            <span class="n">pet_files</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="PipelinePatientSelectionPage-670"><a href="#PipelinePatientSelectionPage-670"><span class="linenos"> 670</span></a>            <span class="c1"># Locate static PET scans</span>
</span><span id="PipelinePatientSelectionPage-671"><a href="#PipelinePatientSelectionPage-671"><span class="linenos"> 671</span></a>            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pet_patterns</span><span class="p">:</span>
</span><span id="PipelinePatientSelectionPage-672"><a href="#PipelinePatientSelectionPage-672"><span class="linenos"> 672</span></a>                <span class="n">pet_files</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
</span><span id="PipelinePatientSelectionPage-673"><a href="#PipelinePatientSelectionPage-673"><span class="linenos"> 673</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pet_files</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="PipelinePatientSelectionPage-674"><a href="#PipelinePatientSelectionPage-674"><span class="linenos"> 674</span></a>                <span class="n">need_revision</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="PipelinePatientSelectionPage-675"><a href="#PipelinePatientSelectionPage-675"><span class="linenos"> 675</span></a>            <span class="n">patient_entry</span><span class="p">[</span><span class="s2">&quot;pet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">pet_files</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">workspace_path</span><span class="p">)</span> <span class="k">if</span> <span class="n">pet_files</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="PipelinePatientSelectionPage-676"><a href="#PipelinePatientSelectionPage-676"><span class="linenos"> 676</span></a>
</span><span id="PipelinePatientSelectionPage-677"><a href="#PipelinePatientSelectionPage-677"><span class="linenos"> 677</span></a>            <span class="c1"># ----------------------------------------------------</span>
</span><span id="PipelinePatientSelectionPage-678"><a href="#PipelinePatientSelectionPage-678"><span class="linenos"> 678</span></a>            <span class="c1"># Dynamic PET (4D, optional)</span>
</span><span id="PipelinePatientSelectionPage-679"><a href="#PipelinePatientSelectionPage-679"><span class="linenos"> 679</span></a>            <span class="c1"># ----------------------------------------------------</span>
</span><span id="PipelinePatientSelectionPage-680"><a href="#PipelinePatientSelectionPage-680"><span class="linenos"> 680</span></a>            <span class="n">pet4d_patterns</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="PipelinePatientSelectionPage-681"><a href="#PipelinePatientSelectionPage-681"><span class="linenos"> 681</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workspace_path</span><span class="p">,</span> <span class="n">patient_id</span><span class="p">,</span> <span class="s2">&quot;ses-02&quot;</span><span class="p">,</span> <span class="s2">&quot;pet&quot;</span><span class="p">,</span> <span class="s2">&quot;*_pet.nii&quot;</span><span class="p">),</span>
</span><span id="PipelinePatientSelectionPage-682"><a href="#PipelinePatientSelectionPage-682"><span class="linenos"> 682</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workspace_path</span><span class="p">,</span> <span class="n">patient_id</span><span class="p">,</span> <span class="s2">&quot;ses-02&quot;</span><span class="p">,</span> <span class="s2">&quot;pet&quot;</span><span class="p">,</span> <span class="s2">&quot;*_pet.nii.gz&quot;</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-683"><a href="#PipelinePatientSelectionPage-683"><span class="linenos"> 683</span></a>            <span class="p">]</span>
</span><span id="PipelinePatientSelectionPage-684"><a href="#PipelinePatientSelectionPage-684"><span class="linenos"> 684</span></a>            <span class="n">pet4d_files</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="PipelinePatientSelectionPage-685"><a href="#PipelinePatientSelectionPage-685"><span class="linenos"> 685</span></a>            <span class="c1"># Locate dynamic PET files (4D data)</span>
</span><span id="PipelinePatientSelectionPage-686"><a href="#PipelinePatientSelectionPage-686"><span class="linenos"> 686</span></a>            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pet4d_patterns</span><span class="p">:</span>
</span><span id="PipelinePatientSelectionPage-687"><a href="#PipelinePatientSelectionPage-687"><span class="linenos"> 687</span></a>                <span class="n">pet4d_files</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
</span><span id="PipelinePatientSelectionPage-688"><a href="#PipelinePatientSelectionPage-688"><span class="linenos"> 688</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pet4d_files</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="PipelinePatientSelectionPage-689"><a href="#PipelinePatientSelectionPage-689"><span class="linenos"> 689</span></a>                <span class="n">need_revision</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="PipelinePatientSelectionPage-690"><a href="#PipelinePatientSelectionPage-690"><span class="linenos"> 690</span></a>            <span class="n">pet4d_file</span> <span class="o">=</span> <span class="n">pet4d_files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">pet4d_files</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="PipelinePatientSelectionPage-691"><a href="#PipelinePatientSelectionPage-691"><span class="linenos"> 691</span></a>            <span class="n">patient_entry</span><span class="p">[</span><span class="s2">&quot;pet4d&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">pet4d_files</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">workspace_path</span><span class="p">)</span> <span class="k">if</span> <span class="n">pet4d_files</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="PipelinePatientSelectionPage-692"><a href="#PipelinePatientSelectionPage-692"><span class="linenos"> 692</span></a>
</span><span id="PipelinePatientSelectionPage-693"><a href="#PipelinePatientSelectionPage-693"><span class="linenos"> 693</span></a>            <span class="c1"># ----------------------------------------------------</span>
</span><span id="PipelinePatientSelectionPage-694"><a href="#PipelinePatientSelectionPage-694"><span class="linenos"> 694</span></a>            <span class="c1"># PET JSON sidecar (metadata for dynamic PET)</span>
</span><span id="PipelinePatientSelectionPage-695"><a href="#PipelinePatientSelectionPage-695"><span class="linenos"> 695</span></a>            <span class="c1"># ----------------------------------------------------</span>
</span><span id="PipelinePatientSelectionPage-696"><a href="#PipelinePatientSelectionPage-696"><span class="linenos"> 696</span></a>            <span class="n">pet_json_file</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PipelinePatientSelectionPage-697"><a href="#PipelinePatientSelectionPage-697"><span class="linenos"> 697</span></a>            <span class="k">if</span> <span class="n">pet4d_file</span><span class="p">:</span>
</span><span id="PipelinePatientSelectionPage-698"><a href="#PipelinePatientSelectionPage-698"><span class="linenos"> 698</span></a>                <span class="c1"># Derive the expected .json filename from the PET file prefix</span>
</span><span id="PipelinePatientSelectionPage-699"><a href="#PipelinePatientSelectionPage-699"><span class="linenos"> 699</span></a>                <span class="n">basename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">pet4d_file</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-700"><a href="#PipelinePatientSelectionPage-700"><span class="linenos"> 700</span></a>                <span class="n">stem_no_ext</span> <span class="o">=</span> <span class="n">basename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="PipelinePatientSelectionPage-701"><a href="#PipelinePatientSelectionPage-701"><span class="linenos"> 701</span></a>                <span class="n">candidate</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">pet4d_file</span><span class="p">),</span> <span class="n">stem_no_ext</span> <span class="o">+</span> <span class="s1">&#39;.json&#39;</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-702"><a href="#PipelinePatientSelectionPage-702"><span class="linenos"> 702</span></a>                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">candidate</span><span class="p">):</span>
</span><span id="PipelinePatientSelectionPage-703"><a href="#PipelinePatientSelectionPage-703"><span class="linenos"> 703</span></a>                    <span class="n">pet_json_file</span> <span class="o">=</span> <span class="n">candidate</span>
</span><span id="PipelinePatientSelectionPage-704"><a href="#PipelinePatientSelectionPage-704"><span class="linenos"> 704</span></a>            <span class="c1"># Store relative path to PET JSON file if it exists</span>
</span><span id="PipelinePatientSelectionPage-705"><a href="#PipelinePatientSelectionPage-705"><span class="linenos"> 705</span></a>            <span class="n">patient_entry</span><span class="p">[</span><span class="s2">&quot;pet4d_json&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">pet_json_file</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">workspace_path</span><span class="p">)</span> <span class="k">if</span> <span class="n">pet_json_file</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="PipelinePatientSelectionPage-706"><a href="#PipelinePatientSelectionPage-706"><span class="linenos"> 706</span></a>
</span><span id="PipelinePatientSelectionPage-707"><a href="#PipelinePatientSelectionPage-707"><span class="linenos"> 707</span></a>            <span class="c1"># ----------------------------------------------------</span>
</span><span id="PipelinePatientSelectionPage-708"><a href="#PipelinePatientSelectionPage-708"><span class="linenos"> 708</span></a>            <span class="c1"># Tumor MRI Mask (manual or automated)</span>
</span><span id="PipelinePatientSelectionPage-709"><a href="#PipelinePatientSelectionPage-709"><span class="linenos"> 709</span></a>            <span class="c1"># ----------------------------------------------------</span>
</span><span id="PipelinePatientSelectionPage-710"><a href="#PipelinePatientSelectionPage-710"><span class="linenos"> 710</span></a>            <span class="n">tumor_patterns</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="PipelinePatientSelectionPage-711"><a href="#PipelinePatientSelectionPage-711"><span class="linenos"> 711</span></a>                <span class="c1"># Manual segmentation masks</span>
</span><span id="PipelinePatientSelectionPage-712"><a href="#PipelinePatientSelectionPage-712"><span class="linenos"> 712</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workspace_path</span><span class="p">,</span> <span class="s2">&quot;derivatives&quot;</span><span class="p">,</span> <span class="s2">&quot;manual_masks&quot;</span><span class="p">,</span> <span class="n">patient_id</span><span class="p">,</span> <span class="s2">&quot;anat&quot;</span><span class="p">,</span> <span class="s2">&quot;*_mask.nii&quot;</span><span class="p">),</span>
</span><span id="PipelinePatientSelectionPage-713"><a href="#PipelinePatientSelectionPage-713"><span class="linenos"> 713</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workspace_path</span><span class="p">,</span> <span class="s2">&quot;derivatives&quot;</span><span class="p">,</span> <span class="s2">&quot;manual_masks&quot;</span><span class="p">,</span> <span class="n">patient_id</span><span class="p">,</span> <span class="s2">&quot;anat&quot;</span><span class="p">,</span> <span class="s2">&quot;*_mask.nii.gz&quot;</span><span class="p">),</span>
</span><span id="PipelinePatientSelectionPage-714"><a href="#PipelinePatientSelectionPage-714"><span class="linenos"> 714</span></a>                <span class="c1"># Deep learning-based segmentations</span>
</span><span id="PipelinePatientSelectionPage-715"><a href="#PipelinePatientSelectionPage-715"><span class="linenos"> 715</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workspace_path</span><span class="p">,</span> <span class="s2">&quot;derivatives&quot;</span><span class="p">,</span> <span class="s2">&quot;deep_learning_seg&quot;</span><span class="p">,</span> <span class="n">patient_id</span><span class="p">,</span> <span class="s2">&quot;anat&quot;</span><span class="p">,</span>
</span><span id="PipelinePatientSelectionPage-716"><a href="#PipelinePatientSelectionPage-716"><span class="linenos"> 716</span></a>                             <span class="s2">&quot;*_seg.nii&quot;</span><span class="p">),</span>
</span><span id="PipelinePatientSelectionPage-717"><a href="#PipelinePatientSelectionPage-717"><span class="linenos"> 717</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workspace_path</span><span class="p">,</span> <span class="s2">&quot;derivatives&quot;</span><span class="p">,</span> <span class="s2">&quot;deep_learning_seg&quot;</span><span class="p">,</span> <span class="n">patient_id</span><span class="p">,</span> <span class="s2">&quot;anat&quot;</span><span class="p">,</span>
</span><span id="PipelinePatientSelectionPage-718"><a href="#PipelinePatientSelectionPage-718"><span class="linenos"> 718</span></a>                             <span class="s2">&quot;*_seg.nii.gz&quot;</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-719"><a href="#PipelinePatientSelectionPage-719"><span class="linenos"> 719</span></a>            <span class="p">]</span>
</span><span id="PipelinePatientSelectionPage-720"><a href="#PipelinePatientSelectionPage-720"><span class="linenos"> 720</span></a>            <span class="n">tumor_files</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="PipelinePatientSelectionPage-721"><a href="#PipelinePatientSelectionPage-721"><span class="linenos"> 721</span></a>            <span class="c1"># Search for tumor mask files</span>
</span><span id="PipelinePatientSelectionPage-722"><a href="#PipelinePatientSelectionPage-722"><span class="linenos"> 722</span></a>            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">tumor_patterns</span><span class="p">:</span>
</span><span id="PipelinePatientSelectionPage-723"><a href="#PipelinePatientSelectionPage-723"><span class="linenos"> 723</span></a>                <span class="n">tumor_files</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
</span><span id="PipelinePatientSelectionPage-724"><a href="#PipelinePatientSelectionPage-724"><span class="linenos"> 724</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tumor_files</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="PipelinePatientSelectionPage-725"><a href="#PipelinePatientSelectionPage-725"><span class="linenos"> 725</span></a>                <span class="n">need_revision</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="PipelinePatientSelectionPage-726"><a href="#PipelinePatientSelectionPage-726"><span class="linenos"> 726</span></a>            <span class="n">patient_entry</span><span class="p">[</span><span class="s2">&quot;tumor_mri&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">tumor_files</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">workspace_path</span><span class="p">)</span> <span class="k">if</span> <span class="n">tumor_files</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="PipelinePatientSelectionPage-727"><a href="#PipelinePatientSelectionPage-727"><span class="linenos"> 727</span></a>
</span><span id="PipelinePatientSelectionPage-728"><a href="#PipelinePatientSelectionPage-728"><span class="linenos"> 728</span></a>            <span class="c1"># Add the final review flag to indicate if manual review is needed</span>
</span><span id="PipelinePatientSelectionPage-729"><a href="#PipelinePatientSelectionPage-729"><span class="linenos"> 729</span></a>            <span class="n">patient_entry</span><span class="p">[</span><span class="s2">&quot;need_revision&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">need_revision</span>
</span><span id="PipelinePatientSelectionPage-730"><a href="#PipelinePatientSelectionPage-730"><span class="linenos"> 730</span></a>
</span><span id="PipelinePatientSelectionPage-731"><a href="#PipelinePatientSelectionPage-731"><span class="linenos"> 731</span></a>            <span class="c1"># Store the patient&#39;s configuration in the main config dictionary</span>
</span><span id="PipelinePatientSelectionPage-732"><a href="#PipelinePatientSelectionPage-732"><span class="linenos"> 732</span></a>            <span class="n">config</span><span class="p">[</span><span class="n">patient_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">patient_entry</span>
</span><span id="PipelinePatientSelectionPage-733"><a href="#PipelinePatientSelectionPage-733"><span class="linenos"> 733</span></a>
</span><span id="PipelinePatientSelectionPage-734"><a href="#PipelinePatientSelectionPage-734"><span class="linenos"> 734</span></a>        <span class="c1"># ----------------------------------------------------</span>
</span><span id="PipelinePatientSelectionPage-735"><a href="#PipelinePatientSelectionPage-735"><span class="linenos"> 735</span></a>        <span class="c1"># Create and save the pipeline configuration JSON file</span>
</span><span id="PipelinePatientSelectionPage-736"><a href="#PipelinePatientSelectionPage-736"><span class="linenos"> 736</span></a>        <span class="c1"># ----------------------------------------------------</span>
</span><span id="PipelinePatientSelectionPage-737"><a href="#PipelinePatientSelectionPage-737"><span class="linenos"> 737</span></a>        <span class="n">pipeline_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workspace_path</span><span class="p">,</span> <span class="s2">&quot;pipeline&quot;</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-738"><a href="#PipelinePatientSelectionPage-738"><span class="linenos"> 738</span></a>
</span><span id="PipelinePatientSelectionPage-739"><a href="#PipelinePatientSelectionPage-739"><span class="linenos"> 739</span></a>        <span class="c1"># Create the &#39;pipeline&#39; directory if it doesn&#39;t exist</span>
</span><span id="PipelinePatientSelectionPage-740"><a href="#PipelinePatientSelectionPage-740"><span class="linenos"> 740</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">pipeline_dir</span><span class="p">):</span>
</span><span id="PipelinePatientSelectionPage-741"><a href="#PipelinePatientSelectionPage-741"><span class="linenos"> 741</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">pipeline_dir</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-742"><a href="#PipelinePatientSelectionPage-742"><span class="linenos"> 742</span></a>            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created pipeline directory: </span><span class="si">{</span><span class="n">pipeline_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-743"><a href="#PipelinePatientSelectionPage-743"><span class="linenos"> 743</span></a>
</span><span id="PipelinePatientSelectionPage-744"><a href="#PipelinePatientSelectionPage-744"><span class="linenos"> 744</span></a>        <span class="c1"># Determine the next sequential ID number (e.g., 01, 02, 03, ...)</span>
</span><span id="PipelinePatientSelectionPage-745"><a href="#PipelinePatientSelectionPage-745"><span class="linenos"> 745</span></a>        <span class="n">config_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_next_config_id</span><span class="p">(</span><span class="n">pipeline_dir</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-746"><a href="#PipelinePatientSelectionPage-746"><span class="linenos"> 746</span></a>
</span><span id="PipelinePatientSelectionPage-747"><a href="#PipelinePatientSelectionPage-747"><span class="linenos"> 747</span></a>        <span class="c1"># Build the filename using the sequential ID</span>
</span><span id="PipelinePatientSelectionPage-748"><a href="#PipelinePatientSelectionPage-748"><span class="linenos"> 748</span></a>        <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">config_id</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">_config.json&quot;</span>
</span><span id="PipelinePatientSelectionPage-749"><a href="#PipelinePatientSelectionPage-749"><span class="linenos"> 749</span></a>        <span class="n">output_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pipeline_dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-750"><a href="#PipelinePatientSelectionPage-750"><span class="linenos"> 750</span></a>
</span><span id="PipelinePatientSelectionPage-751"><a href="#PipelinePatientSelectionPage-751"><span class="linenos"> 751</span></a>        <span class="c1"># Save the configuration dictionary as a formatted JSON file</span>
</span><span id="PipelinePatientSelectionPage-752"><a href="#PipelinePatientSelectionPage-752"><span class="linenos"> 752</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="PipelinePatientSelectionPage-753"><a href="#PipelinePatientSelectionPage-753"><span class="linenos"> 753</span></a>            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-754"><a href="#PipelinePatientSelectionPage-754"><span class="linenos"> 754</span></a>
</span><span id="PipelinePatientSelectionPage-755"><a href="#PipelinePatientSelectionPage-755"><span class="linenos"> 755</span></a>        <span class="c1"># Log the output path for reference</span>
</span><span id="PipelinePatientSelectionPage-756"><a href="#PipelinePatientSelectionPage-756"><span class="linenos"> 756</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pipeline configuration saved to: </span><span class="si">{</span><span class="n">output_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-757"><a href="#PipelinePatientSelectionPage-757"><span class="linenos"> 757</span></a>
</span><span id="PipelinePatientSelectionPage-758"><a href="#PipelinePatientSelectionPage-758"><span class="linenos"> 758</span></a>        <span class="c1"># Return the full path to the generated configuration file</span>
</span><span id="PipelinePatientSelectionPage-759"><a href="#PipelinePatientSelectionPage-759"><span class="linenos"> 759</span></a>        <span class="k">return</span> <span class="n">output_path</span>
</span><span id="PipelinePatientSelectionPage-760"><a href="#PipelinePatientSelectionPage-760"><span class="linenos"> 760</span></a>
</span><span id="PipelinePatientSelectionPage-761"><a href="#PipelinePatientSelectionPage-761"><span class="linenos"> 761</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_next_config_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pipeline_dir</span><span class="p">):</span>
</span><span id="PipelinePatientSelectionPage-762"><a href="#PipelinePatientSelectionPage-762"><span class="linenos"> 762</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Find the next available sequential numeric ID for configuration files.</span>
</span><span id="PipelinePatientSelectionPage-763"><a href="#PipelinePatientSelectionPage-763"><span class="linenos"> 763</span></a>
</span><span id="PipelinePatientSelectionPage-764"><a href="#PipelinePatientSelectionPage-764"><span class="linenos"> 764</span></a><span class="sd">        This method scans the pipeline directory for existing configuration files</span>
</span><span id="PipelinePatientSelectionPage-765"><a href="#PipelinePatientSelectionPage-765"><span class="linenos"> 765</span></a><span class="sd">        that match the pattern `*_config.json`. It extracts the numeric prefix from</span>
</span><span id="PipelinePatientSelectionPage-766"><a href="#PipelinePatientSelectionPage-766"><span class="linenos"> 766</span></a><span class="sd">        each file name (e.g., `12_config.json`  12) and returns the next available</span>
</span><span id="PipelinePatientSelectionPage-767"><a href="#PipelinePatientSelectionPage-767"><span class="linenos"> 767</span></a><span class="sd">        number in sequence.</span>
</span><span id="PipelinePatientSelectionPage-768"><a href="#PipelinePatientSelectionPage-768"><span class="linenos"> 768</span></a>
</span><span id="PipelinePatientSelectionPage-769"><a href="#PipelinePatientSelectionPage-769"><span class="linenos"> 769</span></a><span class="sd">        Args:</span>
</span><span id="PipelinePatientSelectionPage-770"><a href="#PipelinePatientSelectionPage-770"><span class="linenos"> 770</span></a><span class="sd">            pipeline_dir (str): Path to the pipeline directory where config files are stored.</span>
</span><span id="PipelinePatientSelectionPage-771"><a href="#PipelinePatientSelectionPage-771"><span class="linenos"> 771</span></a>
</span><span id="PipelinePatientSelectionPage-772"><a href="#PipelinePatientSelectionPage-772"><span class="linenos"> 772</span></a><span class="sd">        Returns:</span>
</span><span id="PipelinePatientSelectionPage-773"><a href="#PipelinePatientSelectionPage-773"><span class="linenos"> 773</span></a><span class="sd">            int: The next available numeric ID for a new configuration file.</span>
</span><span id="PipelinePatientSelectionPage-774"><a href="#PipelinePatientSelectionPage-774"><span class="linenos"> 774</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PipelinePatientSelectionPage-775"><a href="#PipelinePatientSelectionPage-775"><span class="linenos"> 775</span></a>        <span class="c1"># Pattern used to search for existing pipeline configuration files</span>
</span><span id="PipelinePatientSelectionPage-776"><a href="#PipelinePatientSelectionPage-776"><span class="linenos"> 776</span></a>        <span class="n">config_pattern</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pipeline_dir</span><span class="p">,</span> <span class="s2">&quot;*_config.json&quot;</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-777"><a href="#PipelinePatientSelectionPage-777"><span class="linenos"> 777</span></a>        <span class="n">existing_configs</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">config_pattern</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-778"><a href="#PipelinePatientSelectionPage-778"><span class="linenos"> 778</span></a>
</span><span id="PipelinePatientSelectionPage-779"><a href="#PipelinePatientSelectionPage-779"><span class="linenos"> 779</span></a>        <span class="c1"># If no config files exist, start numbering from 1</span>
</span><span id="PipelinePatientSelectionPage-780"><a href="#PipelinePatientSelectionPage-780"><span class="linenos"> 780</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">existing_configs</span><span class="p">:</span>
</span><span id="PipelinePatientSelectionPage-781"><a href="#PipelinePatientSelectionPage-781"><span class="linenos"> 781</span></a>            <span class="k">return</span> <span class="mi">1</span>
</span><span id="PipelinePatientSelectionPage-782"><a href="#PipelinePatientSelectionPage-782"><span class="linenos"> 782</span></a>
</span><span id="PipelinePatientSelectionPage-783"><a href="#PipelinePatientSelectionPage-783"><span class="linenos"> 783</span></a>        <span class="n">existing_ids</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Stores all numeric IDs extracted from existing filenames</span>
</span><span id="PipelinePatientSelectionPage-784"><a href="#PipelinePatientSelectionPage-784"><span class="linenos"> 784</span></a>
</span><span id="PipelinePatientSelectionPage-785"><a href="#PipelinePatientSelectionPage-785"><span class="linenos"> 785</span></a>        <span class="c1"># Iterate through all existing config files to extract their numeric IDs</span>
</span><span id="PipelinePatientSelectionPage-786"><a href="#PipelinePatientSelectionPage-786"><span class="linenos"> 786</span></a>        <span class="k">for</span> <span class="n">config_file</span> <span class="ow">in</span> <span class="n">existing_configs</span><span class="p">:</span>
</span><span id="PipelinePatientSelectionPage-787"><a href="#PipelinePatientSelectionPage-787"><span class="linenos"> 787</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span>  <span class="c1"># Example: &quot;12_config.json&quot;</span>
</span><span id="PipelinePatientSelectionPage-788"><a href="#PipelinePatientSelectionPage-788"><span class="linenos"> 788</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="PipelinePatientSelectionPage-789"><a href="#PipelinePatientSelectionPage-789"><span class="linenos"> 789</span></a>                <span class="c1"># Extract the numeric part before &quot;_config.json&quot;</span>
</span><span id="PipelinePatientSelectionPage-790"><a href="#PipelinePatientSelectionPage-790"><span class="linenos"> 790</span></a>                <span class="n">id_str</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1">#  &quot;12&quot;</span>
</span><span id="PipelinePatientSelectionPage-791"><a href="#PipelinePatientSelectionPage-791"><span class="linenos"> 791</span></a>                <span class="n">config_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">id_str</span><span class="p">)</span>  <span class="c1"># Convert to integer</span>
</span><span id="PipelinePatientSelectionPage-792"><a href="#PipelinePatientSelectionPage-792"><span class="linenos"> 792</span></a>                <span class="n">existing_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">config_id</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-793"><a href="#PipelinePatientSelectionPage-793"><span class="linenos"> 793</span></a>            <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">):</span>
</span><span id="PipelinePatientSelectionPage-794"><a href="#PipelinePatientSelectionPage-794"><span class="linenos"> 794</span></a>                <span class="c1"># Skip any files that don&#39;t follow the expected naming format</span>
</span><span id="PipelinePatientSelectionPage-795"><a href="#PipelinePatientSelectionPage-795"><span class="linenos"> 795</span></a>                <span class="k">continue</span>
</span><span id="PipelinePatientSelectionPage-796"><a href="#PipelinePatientSelectionPage-796"><span class="linenos"> 796</span></a>
</span><span id="PipelinePatientSelectionPage-797"><a href="#PipelinePatientSelectionPage-797"><span class="linenos"> 797</span></a>        <span class="c1"># If no valid numeric IDs were found, default to 1</span>
</span><span id="PipelinePatientSelectionPage-798"><a href="#PipelinePatientSelectionPage-798"><span class="linenos"> 798</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">existing_ids</span><span class="p">:</span>
</span><span id="PipelinePatientSelectionPage-799"><a href="#PipelinePatientSelectionPage-799"><span class="linenos"> 799</span></a>            <span class="k">return</span> <span class="mi">1</span>
</span><span id="PipelinePatientSelectionPage-800"><a href="#PipelinePatientSelectionPage-800"><span class="linenos"> 800</span></a>
</span><span id="PipelinePatientSelectionPage-801"><a href="#PipelinePatientSelectionPage-801"><span class="linenos"> 801</span></a>        <span class="c1"># Return the next sequential ID (maximum existing + 1)</span>
</span><span id="PipelinePatientSelectionPage-802"><a href="#PipelinePatientSelectionPage-802"><span class="linenos"> 802</span></a>        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">existing_ids</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="PipelinePatientSelectionPage-803"><a href="#PipelinePatientSelectionPage-803"><span class="linenos"> 803</span></a>
</span><span id="PipelinePatientSelectionPage-804"><a href="#PipelinePatientSelectionPage-804"><span class="linenos"> 804</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">on_enter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="PipelinePatientSelectionPage-805"><a href="#PipelinePatientSelectionPage-805"><span class="linenos"> 805</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Triggered when entering this page of the application.</span>
</span><span id="PipelinePatientSelectionPage-806"><a href="#PipelinePatientSelectionPage-806"><span class="linenos"> 806</span></a>
</span><span id="PipelinePatientSelectionPage-807"><a href="#PipelinePatientSelectionPage-807"><span class="linenos"> 807</span></a><span class="sd">        Used to refresh patient statuses when the user navigates to this page.</span>
</span><span id="PipelinePatientSelectionPage-808"><a href="#PipelinePatientSelectionPage-808"><span class="linenos"> 808</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PipelinePatientSelectionPage-809"><a href="#PipelinePatientSelectionPage-809"><span class="linenos"> 809</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_refresh_patient_status</span><span class="p">()</span>
</span><span id="PipelinePatientSelectionPage-810"><a href="#PipelinePatientSelectionPage-810"><span class="linenos"> 810</span></a>
</span><span id="PipelinePatientSelectionPage-811"><a href="#PipelinePatientSelectionPage-811"><span class="linenos"> 811</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">is_ready_to_advance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="PipelinePatientSelectionPage-812"><a href="#PipelinePatientSelectionPage-812"><span class="linenos"> 812</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check whether the application can proceed to the next page.</span>
</span><span id="PipelinePatientSelectionPage-813"><a href="#PipelinePatientSelectionPage-813"><span class="linenos"> 813</span></a>
</span><span id="PipelinePatientSelectionPage-814"><a href="#PipelinePatientSelectionPage-814"><span class="linenos"> 814</span></a><span class="sd">        Returns:</span>
</span><span id="PipelinePatientSelectionPage-815"><a href="#PipelinePatientSelectionPage-815"><span class="linenos"> 815</span></a><span class="sd">            bool: True if at least one patient has been selected, otherwise False.</span>
</span><span id="PipelinePatientSelectionPage-816"><a href="#PipelinePatientSelectionPage-816"><span class="linenos"> 816</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PipelinePatientSelectionPage-817"><a href="#PipelinePatientSelectionPage-817"><span class="linenos"> 817</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_patients</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="PipelinePatientSelectionPage-818"><a href="#PipelinePatientSelectionPage-818"><span class="linenos"> 818</span></a>
</span><span id="PipelinePatientSelectionPage-819"><a href="#PipelinePatientSelectionPage-819"><span class="linenos"> 819</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">is_ready_to_go_back</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="PipelinePatientSelectionPage-820"><a href="#PipelinePatientSelectionPage-820"><span class="linenos"> 820</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check whether the user can navigate back to the previous page.</span>
</span><span id="PipelinePatientSelectionPage-821"><a href="#PipelinePatientSelectionPage-821"><span class="linenos"> 821</span></a>
</span><span id="PipelinePatientSelectionPage-822"><a href="#PipelinePatientSelectionPage-822"><span class="linenos"> 822</span></a><span class="sd">        Returns:</span>
</span><span id="PipelinePatientSelectionPage-823"><a href="#PipelinePatientSelectionPage-823"><span class="linenos"> 823</span></a><span class="sd">            bool: Always True (navigation backward is always allowed).</span>
</span><span id="PipelinePatientSelectionPage-824"><a href="#PipelinePatientSelectionPage-824"><span class="linenos"> 824</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PipelinePatientSelectionPage-825"><a href="#PipelinePatientSelectionPage-825"><span class="linenos"> 825</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="PipelinePatientSelectionPage-826"><a href="#PipelinePatientSelectionPage-826"><span class="linenos"> 826</span></a>
</span><span id="PipelinePatientSelectionPage-827"><a href="#PipelinePatientSelectionPage-827"><span class="linenos"> 827</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
</span><span id="PipelinePatientSelectionPage-828"><a href="#PipelinePatientSelectionPage-828"><span class="linenos"> 828</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Proceed to the next page in the pipeline process.</span>
</span><span id="PipelinePatientSelectionPage-829"><a href="#PipelinePatientSelectionPage-829"><span class="linenos"> 829</span></a>
</span><span id="PipelinePatientSelectionPage-830"><a href="#PipelinePatientSelectionPage-830"><span class="linenos"> 830</span></a><span class="sd">        This method builds the pipeline configuration and navigates</span>
</span><span id="PipelinePatientSelectionPage-831"><a href="#PipelinePatientSelectionPage-831"><span class="linenos"> 831</span></a><span class="sd">        to the review page (`PipelineReviewPage`).</span>
</span><span id="PipelinePatientSelectionPage-832"><a href="#PipelinePatientSelectionPage-832"><span class="linenos"> 832</span></a>
</span><span id="PipelinePatientSelectionPage-833"><a href="#PipelinePatientSelectionPage-833"><span class="linenos"> 833</span></a><span class="sd">        Args:</span>
</span><span id="PipelinePatientSelectionPage-834"><a href="#PipelinePatientSelectionPage-834"><span class="linenos"> 834</span></a><span class="sd">            context (dict): Application context containing state and shared data.</span>
</span><span id="PipelinePatientSelectionPage-835"><a href="#PipelinePatientSelectionPage-835"><span class="linenos"> 835</span></a>
</span><span id="PipelinePatientSelectionPage-836"><a href="#PipelinePatientSelectionPage-836"><span class="linenos"> 836</span></a><span class="sd">        Returns:</span>
</span><span id="PipelinePatientSelectionPage-837"><a href="#PipelinePatientSelectionPage-837"><span class="linenos"> 837</span></a><span class="sd">            Page: The next page to display.</span>
</span><span id="PipelinePatientSelectionPage-838"><a href="#PipelinePatientSelectionPage-838"><span class="linenos"> 838</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PipelinePatientSelectionPage-839"><a href="#PipelinePatientSelectionPage-839"><span class="linenos"> 839</span></a>        <span class="c1"># Generate a new pipeline configuration file before continuing</span>
</span><span id="PipelinePatientSelectionPage-840"><a href="#PipelinePatientSelectionPage-840"><span class="linenos"> 840</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_build_pipeline_config</span><span class="p">()</span>
</span><span id="PipelinePatientSelectionPage-841"><a href="#PipelinePatientSelectionPage-841"><span class="linenos"> 841</span></a>
</span><span id="PipelinePatientSelectionPage-842"><a href="#PipelinePatientSelectionPage-842"><span class="linenos"> 842</span></a>        <span class="c1"># If a next page already exists, reuse it</span>
</span><span id="PipelinePatientSelectionPage-843"><a href="#PipelinePatientSelectionPage-843"><span class="linenos"> 843</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_page</span><span class="p">:</span>
</span><span id="PipelinePatientSelectionPage-844"><a href="#PipelinePatientSelectionPage-844"><span class="linenos"> 844</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next_page</span><span class="o">.</span><span class="n">on_enter</span><span class="p">()</span>
</span><span id="PipelinePatientSelectionPage-845"><a href="#PipelinePatientSelectionPage-845"><span class="linenos"> 845</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_page</span>
</span><span id="PipelinePatientSelectionPage-846"><a href="#PipelinePatientSelectionPage-846"><span class="linenos"> 846</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PipelinePatientSelectionPage-847"><a href="#PipelinePatientSelectionPage-847"><span class="linenos"> 847</span></a>            <span class="c1"># Otherwise, create a new review page and register it in navigation history</span>
</span><span id="PipelinePatientSelectionPage-848"><a href="#PipelinePatientSelectionPage-848"><span class="linenos"> 848</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next_page</span> <span class="o">=</span> <span class="n">PipelineReviewPage</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-849"><a href="#PipelinePatientSelectionPage-849"><span class="linenos"> 849</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s2">&quot;history&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">next_page</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-850"><a href="#PipelinePatientSelectionPage-850"><span class="linenos"> 850</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next_page</span><span class="o">.</span><span class="n">on_enter</span><span class="p">()</span>
</span><span id="PipelinePatientSelectionPage-851"><a href="#PipelinePatientSelectionPage-851"><span class="linenos"> 851</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_page</span>
</span><span id="PipelinePatientSelectionPage-852"><a href="#PipelinePatientSelectionPage-852"><span class="linenos"> 852</span></a>
</span><span id="PipelinePatientSelectionPage-853"><a href="#PipelinePatientSelectionPage-853"><span class="linenos"> 853</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">back</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="PipelinePatientSelectionPage-854"><a href="#PipelinePatientSelectionPage-854"><span class="linenos"> 854</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Navigate back to the previous page.</span>
</span><span id="PipelinePatientSelectionPage-855"><a href="#PipelinePatientSelectionPage-855"><span class="linenos"> 855</span></a>
</span><span id="PipelinePatientSelectionPage-856"><a href="#PipelinePatientSelectionPage-856"><span class="linenos"> 856</span></a><span class="sd">        Returns:</span>
</span><span id="PipelinePatientSelectionPage-857"><a href="#PipelinePatientSelectionPage-857"><span class="linenos"> 857</span></a><span class="sd">            Page or None: The previous page if available, otherwise None.</span>
</span><span id="PipelinePatientSelectionPage-858"><a href="#PipelinePatientSelectionPage-858"><span class="linenos"> 858</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PipelinePatientSelectionPage-859"><a href="#PipelinePatientSelectionPage-859"><span class="linenos"> 859</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_page</span><span class="p">:</span>
</span><span id="PipelinePatientSelectionPage-860"><a href="#PipelinePatientSelectionPage-860"><span class="linenos"> 860</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">previous_page</span><span class="o">.</span><span class="n">on_enter</span><span class="p">()</span>
</span><span id="PipelinePatientSelectionPage-861"><a href="#PipelinePatientSelectionPage-861"><span class="linenos"> 861</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_page</span>
</span><span id="PipelinePatientSelectionPage-862"><a href="#PipelinePatientSelectionPage-862"><span class="linenos"> 862</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="PipelinePatientSelectionPage-863"><a href="#PipelinePatientSelectionPage-863"><span class="linenos"> 863</span></a>
</span><span id="PipelinePatientSelectionPage-864"><a href="#PipelinePatientSelectionPage-864"><span class="linenos"> 864</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_selected_patients</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="PipelinePatientSelectionPage-865"><a href="#PipelinePatientSelectionPage-865"><span class="linenos"> 865</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve the list of currently selected patients.</span>
</span><span id="PipelinePatientSelectionPage-866"><a href="#PipelinePatientSelectionPage-866"><span class="linenos"> 866</span></a>
</span><span id="PipelinePatientSelectionPage-867"><a href="#PipelinePatientSelectionPage-867"><span class="linenos"> 867</span></a><span class="sd">        Returns:</span>
</span><span id="PipelinePatientSelectionPage-868"><a href="#PipelinePatientSelectionPage-868"><span class="linenos"> 868</span></a><span class="sd">            list[str]: A list of selected patient IDs.</span>
</span><span id="PipelinePatientSelectionPage-869"><a href="#PipelinePatientSelectionPage-869"><span class="linenos"> 869</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PipelinePatientSelectionPage-870"><a href="#PipelinePatientSelectionPage-870"><span class="linenos"> 870</span></a>        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_patients</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-871"><a href="#PipelinePatientSelectionPage-871"><span class="linenos"> 871</span></a>
</span><span id="PipelinePatientSelectionPage-872"><a href="#PipelinePatientSelectionPage-872"><span class="linenos"> 872</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_eligible_patients</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="PipelinePatientSelectionPage-873"><a href="#PipelinePatientSelectionPage-873"><span class="linenos"> 873</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve the list of patients marked as eligible.</span>
</span><span id="PipelinePatientSelectionPage-874"><a href="#PipelinePatientSelectionPage-874"><span class="linenos"> 874</span></a>
</span><span id="PipelinePatientSelectionPage-875"><a href="#PipelinePatientSelectionPage-875"><span class="linenos"> 875</span></a><span class="sd">        Returns:</span>
</span><span id="PipelinePatientSelectionPage-876"><a href="#PipelinePatientSelectionPage-876"><span class="linenos"> 876</span></a><span class="sd">            list[str]: A list of patient IDs where `status[&#39;eligible&#39;]` is True.</span>
</span><span id="PipelinePatientSelectionPage-877"><a href="#PipelinePatientSelectionPage-877"><span class="linenos"> 877</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PipelinePatientSelectionPage-878"><a href="#PipelinePatientSelectionPage-878"><span class="linenos"> 878</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">pid</span> <span class="k">for</span> <span class="n">pid</span><span class="p">,</span> <span class="n">status</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">patient_status</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">status</span><span class="p">[</span><span class="s1">&#39;eligible&#39;</span><span class="p">]]</span>
</span><span id="PipelinePatientSelectionPage-879"><a href="#PipelinePatientSelectionPage-879"><span class="linenos"> 879</span></a>
</span><span id="PipelinePatientSelectionPage-880"><a href="#PipelinePatientSelectionPage-880"><span class="linenos"> 880</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_patient_status_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="PipelinePatientSelectionPage-881"><a href="#PipelinePatientSelectionPage-881"><span class="linenos"> 881</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a summary of the current patient status.</span>
</span><span id="PipelinePatientSelectionPage-882"><a href="#PipelinePatientSelectionPage-882"><span class="linenos"> 882</span></a>
</span><span id="PipelinePatientSelectionPage-883"><a href="#PipelinePatientSelectionPage-883"><span class="linenos"> 883</span></a><span class="sd">        This method calculates basic statistics about the patients in the current</span>
</span><span id="PipelinePatientSelectionPage-884"><a href="#PipelinePatientSelectionPage-884"><span class="linenos"> 884</span></a><span class="sd">        workspace, including total number, number of eligible patients, and number</span>
</span><span id="PipelinePatientSelectionPage-885"><a href="#PipelinePatientSelectionPage-885"><span class="linenos"> 885</span></a><span class="sd">        of selected patients. It also computes how many are not eligible.</span>
</span><span id="PipelinePatientSelectionPage-886"><a href="#PipelinePatientSelectionPage-886"><span class="linenos"> 886</span></a>
</span><span id="PipelinePatientSelectionPage-887"><a href="#PipelinePatientSelectionPage-887"><span class="linenos"> 887</span></a><span class="sd">        Returns:</span>
</span><span id="PipelinePatientSelectionPage-888"><a href="#PipelinePatientSelectionPage-888"><span class="linenos"> 888</span></a><span class="sd">            dict: A dictionary containing patient status counts:</span>
</span><span id="PipelinePatientSelectionPage-889"><a href="#PipelinePatientSelectionPage-889"><span class="linenos"> 889</span></a><span class="sd">                - &#39;total&#39;: Total number of patients</span>
</span><span id="PipelinePatientSelectionPage-890"><a href="#PipelinePatientSelectionPage-890"><span class="linenos"> 890</span></a><span class="sd">                - &#39;eligible&#39;: Number of eligible patients</span>
</span><span id="PipelinePatientSelectionPage-891"><a href="#PipelinePatientSelectionPage-891"><span class="linenos"> 891</span></a><span class="sd">                - &#39;selected&#39;: Number of currently selected patients</span>
</span><span id="PipelinePatientSelectionPage-892"><a href="#PipelinePatientSelectionPage-892"><span class="linenos"> 892</span></a><span class="sd">                - &#39;not_eligible&#39;: Number of non-eligible patients</span>
</span><span id="PipelinePatientSelectionPage-893"><a href="#PipelinePatientSelectionPage-893"><span class="linenos"> 893</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PipelinePatientSelectionPage-894"><a href="#PipelinePatientSelectionPage-894"><span class="linenos"> 894</span></a>        <span class="n">total</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">patient_status</span><span class="p">)</span>  <span class="c1"># Count total patients being tracked</span>
</span><span id="PipelinePatientSelectionPage-895"><a href="#PipelinePatientSelectionPage-895"><span class="linenos"> 895</span></a>        <span class="n">eligible</span> <span class="o">=</span> <span class="nb">len</span><span class="p">([</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">patient_status</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;eligible&#39;</span><span class="p">]])</span>  <span class="c1"># Count eligible ones</span>
</span><span id="PipelinePatientSelectionPage-896"><a href="#PipelinePatientSelectionPage-896"><span class="linenos"> 896</span></a>        <span class="n">selected</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_patients</span><span class="p">)</span>  <span class="c1"># Count selected patients</span>
</span><span id="PipelinePatientSelectionPage-897"><a href="#PipelinePatientSelectionPage-897"><span class="linenos"> 897</span></a>
</span><span id="PipelinePatientSelectionPage-898"><a href="#PipelinePatientSelectionPage-898"><span class="linenos"> 898</span></a>        <span class="c1"># Return a dictionary summarizing all relevant counts</span>
</span><span id="PipelinePatientSelectionPage-899"><a href="#PipelinePatientSelectionPage-899"><span class="linenos"> 899</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="PipelinePatientSelectionPage-900"><a href="#PipelinePatientSelectionPage-900"><span class="linenos"> 900</span></a>            <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="n">total</span><span class="p">,</span>
</span><span id="PipelinePatientSelectionPage-901"><a href="#PipelinePatientSelectionPage-901"><span class="linenos"> 901</span></a>            <span class="s1">&#39;eligible&#39;</span><span class="p">:</span> <span class="n">eligible</span><span class="p">,</span>
</span><span id="PipelinePatientSelectionPage-902"><a href="#PipelinePatientSelectionPage-902"><span class="linenos"> 902</span></a>            <span class="s1">&#39;selected&#39;</span><span class="p">:</span> <span class="n">selected</span><span class="p">,</span>
</span><span id="PipelinePatientSelectionPage-903"><a href="#PipelinePatientSelectionPage-903"><span class="linenos"> 903</span></a>            <span class="s1">&#39;not_eligible&#39;</span><span class="p">:</span> <span class="n">total</span> <span class="o">-</span> <span class="n">eligible</span>
</span><span id="PipelinePatientSelectionPage-904"><a href="#PipelinePatientSelectionPage-904"><span class="linenos"> 904</span></a>        <span class="p">}</span>
</span><span id="PipelinePatientSelectionPage-905"><a href="#PipelinePatientSelectionPage-905"><span class="linenos"> 905</span></a>
</span><span id="PipelinePatientSelectionPage-906"><a href="#PipelinePatientSelectionPage-906"><span class="linenos"> 906</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">reset_page</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="PipelinePatientSelectionPage-907"><a href="#PipelinePatientSelectionPage-907"><span class="linenos"> 907</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Completely reset the current page.</span>
</span><span id="PipelinePatientSelectionPage-908"><a href="#PipelinePatientSelectionPage-908"><span class="linenos"> 908</span></a>
</span><span id="PipelinePatientSelectionPage-909"><a href="#PipelinePatientSelectionPage-909"><span class="linenos"> 909</span></a><span class="sd">        This method clears the UI grid, removes all patient-related widgets,</span>
</span><span id="PipelinePatientSelectionPage-910"><a href="#PipelinePatientSelectionPage-910"><span class="linenos"> 910</span></a><span class="sd">        resets the internal data structures tracking patient selection and status,</span>
</span><span id="PipelinePatientSelectionPage-911"><a href="#PipelinePatientSelectionPage-911"><span class="linenos"> 911</span></a><span class="sd">        and then reloads the list of patients.</span>
</span><span id="PipelinePatientSelectionPage-912"><a href="#PipelinePatientSelectionPage-912"><span class="linenos"> 912</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PipelinePatientSelectionPage-913"><a href="#PipelinePatientSelectionPage-913"><span class="linenos"> 913</span></a>        <span class="c1"># Clear all widgets from the grid layout</span>
</span><span id="PipelinePatientSelectionPage-914"><a href="#PipelinePatientSelectionPage-914"><span class="linenos"> 914</span></a>        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_layout</span><span class="o">.</span><span class="n">count</span><span class="p">():</span>
</span><span id="PipelinePatientSelectionPage-915"><a href="#PipelinePatientSelectionPage-915"><span class="linenos"> 915</span></a>            <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_layout</span><span class="o">.</span><span class="n">takeAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-916"><a href="#PipelinePatientSelectionPage-916"><span class="linenos"> 916</span></a>            <span class="n">widget</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span>
</span><span id="PipelinePatientSelectionPage-917"><a href="#PipelinePatientSelectionPage-917"><span class="linenos"> 917</span></a>            <span class="k">if</span> <span class="n">widget</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PipelinePatientSelectionPage-918"><a href="#PipelinePatientSelectionPage-918"><span class="linenos"> 918</span></a>                <span class="n">widget</span><span class="o">.</span><span class="n">setParent</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>  <span class="c1"># Detach widget from layout</span>
</span><span id="PipelinePatientSelectionPage-919"><a href="#PipelinePatientSelectionPage-919"><span class="linenos"> 919</span></a>                <span class="n">widget</span><span class="o">.</span><span class="n">deleteLater</span><span class="p">()</span>  <span class="c1"># Schedule for deletion</span>
</span><span id="PipelinePatientSelectionPage-920"><a href="#PipelinePatientSelectionPage-920"><span class="linenos"> 920</span></a>
</span><span id="PipelinePatientSelectionPage-921"><a href="#PipelinePatientSelectionPage-921"><span class="linenos"> 921</span></a>        <span class="c1"># Reset all patient-related states</span>
</span><span id="PipelinePatientSelectionPage-922"><a href="#PipelinePatientSelectionPage-922"><span class="linenos"> 922</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">selected_patients</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>  <span class="c1"># Clear selected patients</span>
</span><span id="PipelinePatientSelectionPage-923"><a href="#PipelinePatientSelectionPage-923"><span class="linenos"> 923</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">patient_buttons</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>  <span class="c1"># Clear patient button references</span>
</span><span id="PipelinePatientSelectionPage-924"><a href="#PipelinePatientSelectionPage-924"><span class="linenos"> 924</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">patient_status</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>  <span class="c1"># Clear patient status dictionary</span>
</span><span id="PipelinePatientSelectionPage-925"><a href="#PipelinePatientSelectionPage-925"><span class="linenos"> 925</span></a>
</span><span id="PipelinePatientSelectionPage-926"><a href="#PipelinePatientSelectionPage-926"><span class="linenos"> 926</span></a>        <span class="c1"># Reload all patient data from the workspace</span>
</span><span id="PipelinePatientSelectionPage-927"><a href="#PipelinePatientSelectionPage-927"><span class="linenos"> 927</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_load_patients</span><span class="p">()</span>
</span><span id="PipelinePatientSelectionPage-928"><a href="#PipelinePatientSelectionPage-928"><span class="linenos"> 928</span></a>
</span><span id="PipelinePatientSelectionPage-929"><a href="#PipelinePatientSelectionPage-929"><span class="linenos"> 929</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">resizeEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
</span><span id="PipelinePatientSelectionPage-930"><a href="#PipelinePatientSelectionPage-930"><span class="linenos"> 930</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Make the interface responsive based on the window height.</span>
</span><span id="PipelinePatientSelectionPage-931"><a href="#PipelinePatientSelectionPage-931"><span class="linenos"> 931</span></a>
</span><span id="PipelinePatientSelectionPage-932"><a href="#PipelinePatientSelectionPage-932"><span class="linenos"> 932</span></a><span class="sd">        This event handler adjusts font sizes, button padding, and layout proportions</span>
</span><span id="PipelinePatientSelectionPage-933"><a href="#PipelinePatientSelectionPage-933"><span class="linenos"> 933</span></a><span class="sd">        dynamically when the main window is resized. It ensures usability and readability</span>
</span><span id="PipelinePatientSelectionPage-934"><a href="#PipelinePatientSelectionPage-934"><span class="linenos"> 934</span></a><span class="sd">        for both small and large window sizes.</span>
</span><span id="PipelinePatientSelectionPage-935"><a href="#PipelinePatientSelectionPage-935"><span class="linenos"> 935</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PipelinePatientSelectionPage-936"><a href="#PipelinePatientSelectionPage-936"><span class="linenos"> 936</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">resizeEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-937"><a href="#PipelinePatientSelectionPage-937"><span class="linenos"> 937</span></a>
</span><span id="PipelinePatientSelectionPage-938"><a href="#PipelinePatientSelectionPage-938"><span class="linenos"> 938</span></a>        <span class="c1"># Update column count dynamically based on width</span>
</span><span id="PipelinePatientSelectionPage-939"><a href="#PipelinePatientSelectionPage-939"><span class="linenos"> 939</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_update_column_count</span><span class="p">()</span>
</span><span id="PipelinePatientSelectionPage-940"><a href="#PipelinePatientSelectionPage-940"><span class="linenos"> 940</span></a>
</span><span id="PipelinePatientSelectionPage-941"><a href="#PipelinePatientSelectionPage-941"><span class="linenos"> 941</span></a>        <span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">()</span>  <span class="c1"># Current window height</span>
</span><span id="PipelinePatientSelectionPage-942"><a href="#PipelinePatientSelectionPage-942"><span class="linenos"> 942</span></a>
</span><span id="PipelinePatientSelectionPage-943"><a href="#PipelinePatientSelectionPage-943"><span class="linenos"> 943</span></a>        <span class="c1"># Adjust UI style dynamically for small or large window height</span>
</span><span id="PipelinePatientSelectionPage-944"><a href="#PipelinePatientSelectionPage-944"><span class="linenos"> 944</span></a>        <span class="k">if</span> <span class="n">height</span> <span class="o">&lt;</span> <span class="mi">500</span><span class="p">:</span>
</span><span id="PipelinePatientSelectionPage-945"><a href="#PipelinePatientSelectionPage-945"><span class="linenos"> 945</span></a>            <span class="c1"># Compact layout for small windows</span>
</span><span id="PipelinePatientSelectionPage-946"><a href="#PipelinePatientSelectionPage-946"><span class="linenos"> 946</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;font-size: 14px; font-weight: bold; margin-bottom: 5px;&quot;</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-947"><a href="#PipelinePatientSelectionPage-947"><span class="linenos"> 947</span></a>            <span class="n">btn_padding</span> <span class="o">=</span> <span class="s2">&quot;5px 10px&quot;</span>
</span><span id="PipelinePatientSelectionPage-948"><a href="#PipelinePatientSelectionPage-948"><span class="linenos"> 948</span></a>            <span class="n">font_size_btn</span> <span class="o">=</span> <span class="mi">11</span>
</span><span id="PipelinePatientSelectionPage-949"><a href="#PipelinePatientSelectionPage-949"><span class="linenos"> 949</span></a>            <span class="n">max_pill_height</span> <span class="o">=</span> <span class="mi">70</span>
</span><span id="PipelinePatientSelectionPage-950"><a href="#PipelinePatientSelectionPage-950"><span class="linenos"> 950</span></a>            <span class="n">font_size_title</span> <span class="o">=</span> <span class="mi">12</span>
</span><span id="PipelinePatientSelectionPage-951"><a href="#PipelinePatientSelectionPage-951"><span class="linenos"> 951</span></a>            <span class="n">font_size_value</span> <span class="o">=</span> <span class="mi">14</span>
</span><span id="PipelinePatientSelectionPage-952"><a href="#PipelinePatientSelectionPage-952"><span class="linenos"> 952</span></a>            <span class="n">font_size_label</span> <span class="o">=</span> <span class="mi">10</span>
</span><span id="PipelinePatientSelectionPage-953"><a href="#PipelinePatientSelectionPage-953"><span class="linenos"> 953</span></a>            <span class="n">max_pill_height</span> <span class="o">=</span> <span class="mi">60</span>
</span><span id="PipelinePatientSelectionPage-954"><a href="#PipelinePatientSelectionPage-954"><span class="linenos"> 954</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PipelinePatientSelectionPage-955"><a href="#PipelinePatientSelectionPage-955"><span class="linenos"> 955</span></a>            <span class="c1"># Normal layout for larger windows</span>
</span><span id="PipelinePatientSelectionPage-956"><a href="#PipelinePatientSelectionPage-956"><span class="linenos"> 956</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;font-size: 18px; font-weight: bold; margin-bottom: 10px;&quot;</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-957"><a href="#PipelinePatientSelectionPage-957"><span class="linenos"> 957</span></a>            <span class="n">btn_padding</span> <span class="o">=</span> <span class="s2">&quot;10px 20px&quot;</span>
</span><span id="PipelinePatientSelectionPage-958"><a href="#PipelinePatientSelectionPage-958"><span class="linenos"> 958</span></a>            <span class="n">font_size_btn</span> <span class="o">=</span> <span class="mi">13</span>
</span><span id="PipelinePatientSelectionPage-959"><a href="#PipelinePatientSelectionPage-959"><span class="linenos"> 959</span></a>            <span class="n">font_size_title</span> <span class="o">=</span> <span class="mi">16</span>
</span><span id="PipelinePatientSelectionPage-960"><a href="#PipelinePatientSelectionPage-960"><span class="linenos"> 960</span></a>            <span class="n">font_size_value</span> <span class="o">=</span> <span class="mi">20</span>
</span><span id="PipelinePatientSelectionPage-961"><a href="#PipelinePatientSelectionPage-961"><span class="linenos"> 961</span></a>            <span class="n">font_size_label</span> <span class="o">=</span> <span class="mi">13</span>
</span><span id="PipelinePatientSelectionPage-962"><a href="#PipelinePatientSelectionPage-962"><span class="linenos"> 962</span></a>            <span class="n">max_pill_height</span> <span class="o">=</span> <span class="mi">100</span>
</span><span id="PipelinePatientSelectionPage-963"><a href="#PipelinePatientSelectionPage-963"><span class="linenos"> 963</span></a>
</span><span id="PipelinePatientSelectionPage-964"><a href="#PipelinePatientSelectionPage-964"><span class="linenos"> 964</span></a>        <span class="c1"># Update button styles dynamically</span>
</span><span id="PipelinePatientSelectionPage-965"><a href="#PipelinePatientSelectionPage-965"><span class="linenos"> 965</span></a>        <span class="k">for</span> <span class="n">btn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">buttons</span><span class="p">:</span>
</span><span id="PipelinePatientSelectionPage-966"><a href="#PipelinePatientSelectionPage-966"><span class="linenos"> 966</span></a>            <span class="n">btn</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="PipelinePatientSelectionPage-967"><a href="#PipelinePatientSelectionPage-967"><span class="linenos"> 967</span></a><span class="s2">                QPushButton </span><span class="se">{{</span>
</span><span id="PipelinePatientSelectionPage-968"><a href="#PipelinePatientSelectionPage-968"><span class="linenos"> 968</span></a><span class="s2">                    background-color: #e0e0e0;</span>
</span><span id="PipelinePatientSelectionPage-969"><a href="#PipelinePatientSelectionPage-969"><span class="linenos"> 969</span></a><span class="s2">                    padding: </span><span class="si">{</span><span class="n">btn_padding</span><span class="si">}</span><span class="s2">;</span>
</span><span id="PipelinePatientSelectionPage-970"><a href="#PipelinePatientSelectionPage-970"><span class="linenos"> 970</span></a><span class="s2">                    border-radius: 10px;</span>
</span><span id="PipelinePatientSelectionPage-971"><a href="#PipelinePatientSelectionPage-971"><span class="linenos"> 971</span></a><span class="s2">                    border: 1px solid #bdc3c7;</span>
</span><span id="PipelinePatientSelectionPage-972"><a href="#PipelinePatientSelectionPage-972"><span class="linenos"> 972</span></a><span class="s2">                    font-weight: bold;</span>
</span><span id="PipelinePatientSelectionPage-973"><a href="#PipelinePatientSelectionPage-973"><span class="linenos"> 973</span></a><span class="s2">                    font-size: </span><span class="si">{</span><span class="n">font_size_btn</span><span class="si">}</span><span class="s2">px;</span>
</span><span id="PipelinePatientSelectionPage-974"><a href="#PipelinePatientSelectionPage-974"><span class="linenos"> 974</span></a><span class="s2">                    margin: 2px;</span>
</span><span id="PipelinePatientSelectionPage-975"><a href="#PipelinePatientSelectionPage-975"><span class="linenos"> 975</span></a><span class="s2">                </span><span class="se">}}</span>
</span><span id="PipelinePatientSelectionPage-976"><a href="#PipelinePatientSelectionPage-976"><span class="linenos"> 976</span></a><span class="s2">                QPushButton:hover </span><span class="se">{{</span>
</span><span id="PipelinePatientSelectionPage-977"><a href="#PipelinePatientSelectionPage-977"><span class="linenos"> 977</span></a><span class="s2">                    background-color: #d0d0d0;</span>
</span><span id="PipelinePatientSelectionPage-978"><a href="#PipelinePatientSelectionPage-978"><span class="linenos"> 978</span></a><span class="s2">                </span><span class="se">}}</span>
</span><span id="PipelinePatientSelectionPage-979"><a href="#PipelinePatientSelectionPage-979"><span class="linenos"> 979</span></a><span class="s2">                QPushButton:disabled </span><span class="se">{{</span>
</span><span id="PipelinePatientSelectionPage-980"><a href="#PipelinePatientSelectionPage-980"><span class="linenos"> 980</span></a><span class="s2">                    background-color: #f0f0f0;</span>
</span><span id="PipelinePatientSelectionPage-981"><a href="#PipelinePatientSelectionPage-981"><span class="linenos"> 981</span></a><span class="s2">                    color: #888888;</span>
</span><span id="PipelinePatientSelectionPage-982"><a href="#PipelinePatientSelectionPage-982"><span class="linenos"> 982</span></a><span class="s2">                </span><span class="se">}}</span>
</span><span id="PipelinePatientSelectionPage-983"><a href="#PipelinePatientSelectionPage-983"><span class="linenos"> 983</span></a><span class="s2">            &quot;&quot;&quot;</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-984"><a href="#PipelinePatientSelectionPage-984"><span class="linenos"> 984</span></a>
</span><span id="PipelinePatientSelectionPage-985"><a href="#PipelinePatientSelectionPage-985"><span class="linenos"> 985</span></a>        <span class="c1"># Update summary title styling</span>
</span><span id="PipelinePatientSelectionPage-986"><a href="#PipelinePatientSelectionPage-986"><span class="linenos"> 986</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">title_summary</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span>
</span><span id="PipelinePatientSelectionPage-987"><a href="#PipelinePatientSelectionPage-987"><span class="linenos"> 987</span></a>            <span class="sa">f</span><span class="s2">&quot;font-size: </span><span class="si">{</span><span class="n">font_size_title</span><span class="si">}</span><span class="s2">px; font-weight: bold; color: #000000; margin-bottom: 8px;&quot;</span>
</span><span id="PipelinePatientSelectionPage-988"><a href="#PipelinePatientSelectionPage-988"><span class="linenos"> 988</span></a>        <span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-989"><a href="#PipelinePatientSelectionPage-989"><span class="linenos"> 989</span></a>
</span><span id="PipelinePatientSelectionPage-990"><a href="#PipelinePatientSelectionPage-990"><span class="linenos"> 990</span></a>        <span class="c1"># Update pill-style status indicators (total, eligible, not eligible)</span>
</span><span id="PipelinePatientSelectionPage-991"><a href="#PipelinePatientSelectionPage-991"><span class="linenos"> 991</span></a>        <span class="k">for</span> <span class="n">pill</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">total_label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eligible_label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">not_eligible_label</span><span class="p">]:</span>
</span><span id="PipelinePatientSelectionPage-992"><a href="#PipelinePatientSelectionPage-992"><span class="linenos"> 992</span></a>            <span class="n">pill</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;font-size: </span><span class="si">{</span><span class="n">font_size_label</span><span class="si">}</span><span class="s2">px; font-weight: bold;&quot;</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-993"><a href="#PipelinePatientSelectionPage-993"><span class="linenos"> 993</span></a>            <span class="n">pill</span><span class="o">.</span><span class="n">value_label</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span>
</span><span id="PipelinePatientSelectionPage-994"><a href="#PipelinePatientSelectionPage-994"><span class="linenos"> 994</span></a>                <span class="sa">f</span><span class="s2">&quot;font-size: </span><span class="si">{</span><span class="n">font_size_value</span><span class="si">}</span><span class="s2">px; font-weight: bold; color: </span><span class="si">{</span><span class="n">pill</span><span class="o">.</span><span class="n">value_label</span><span class="o">.</span><span class="n">palette</span><span class="p">()</span><span class="o">.</span><span class="n">color</span><span class="p">(</span><span class="n">pill</span><span class="o">.</span><span class="n">value_label</span><span class="o">.</span><span class="n">foregroundRole</span><span class="p">())</span><span class="o">.</span><span class="n">name</span><span class="p">()</span><span class="si">}</span><span class="s2">;&quot;</span>
</span><span id="PipelinePatientSelectionPage-995"><a href="#PipelinePatientSelectionPage-995"><span class="linenos"> 995</span></a>            <span class="p">)</span>
</span><span id="PipelinePatientSelectionPage-996"><a href="#PipelinePatientSelectionPage-996"><span class="linenos"> 996</span></a>            <span class="n">pill</span><span class="o">.</span><span class="n">setMaximumHeight</span><span class="p">(</span><span class="n">max_pill_height</span><span class="p">)</span>  <span class="c1"># Limit vertical space</span>
</span><span id="PipelinePatientSelectionPage-997"><a href="#PipelinePatientSelectionPage-997"><span class="linenos"> 997</span></a>
</span><span id="PipelinePatientSelectionPage-998"><a href="#PipelinePatientSelectionPage-998"><span class="linenos"> 998</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_translate_ui</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="PipelinePatientSelectionPage-999"><a href="#PipelinePatientSelectionPage-999"><span class="linenos"> 999</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Translate all UI text elements.</span>
</span><span id="PipelinePatientSelectionPage-1000"><a href="#PipelinePatientSelectionPage-1000"><span class="linenos">1000</span></a>
</span><span id="PipelinePatientSelectionPage-1001"><a href="#PipelinePatientSelectionPage-1001"><span class="linenos">1001</span></a><span class="sd">        This method updates all labels, buttons, and titles with localized</span>
</span><span id="PipelinePatientSelectionPage-1002"><a href="#PipelinePatientSelectionPage-1002"><span class="linenos">1002</span></a><span class="sd">        (translated) strings using Qt&#39;s translation system. It ensures</span>
</span><span id="PipelinePatientSelectionPage-1003"><a href="#PipelinePatientSelectionPage-1003"><span class="linenos">1003</span></a><span class="sd">        multilingual compatibility of the interface.</span>
</span><span id="PipelinePatientSelectionPage-1004"><a href="#PipelinePatientSelectionPage-1004"><span class="linenos">1004</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PipelinePatientSelectionPage-1005"><a href="#PipelinePatientSelectionPage-1005"><span class="linenos">1005</span></a>        <span class="c1"># Set translated texts for main title and control buttons</span>
</span><span id="PipelinePatientSelectionPage-1006"><a href="#PipelinePatientSelectionPage-1006"><span class="linenos">1006</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
</span><span id="PipelinePatientSelectionPage-1007"><a href="#PipelinePatientSelectionPage-1007"><span class="linenos">1007</span></a>            <span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;PipelinePatientSelectionPage&quot;</span><span class="p">,</span> <span class="s2">&quot;Select Patients for Pipeline Analysis&quot;</span><span class="p">))</span>
</span><span id="PipelinePatientSelectionPage-1008"><a href="#PipelinePatientSelectionPage-1008"><span class="linenos">1008</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">select_eligible_btn</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
</span><span id="PipelinePatientSelectionPage-1009"><a href="#PipelinePatientSelectionPage-1009"><span class="linenos">1009</span></a>            <span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;PipelinePatientSelectionPage&quot;</span><span class="p">,</span> <span class="s2">&quot;Select All Eligible&quot;</span><span class="p">))</span>
</span><span id="PipelinePatientSelectionPage-1010"><a href="#PipelinePatientSelectionPage-1010"><span class="linenos">1010</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">deselect_all_btn</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;PipelinePatientSelectionPage&quot;</span><span class="p">,</span> <span class="s2">&quot;Deselect All&quot;</span><span class="p">))</span>
</span><span id="PipelinePatientSelectionPage-1011"><a href="#PipelinePatientSelectionPage-1011"><span class="linenos">1011</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_btn</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;PipelinePatientSelectionPage&quot;</span><span class="p">,</span> <span class="s2">&quot;Refresh Status&quot;</span><span class="p">))</span>
</span><span id="PipelinePatientSelectionPage-1012"><a href="#PipelinePatientSelectionPage-1012"><span class="linenos">1012</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">title_summary</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
</span><span id="PipelinePatientSelectionPage-1013"><a href="#PipelinePatientSelectionPage-1013"><span class="linenos">1013</span></a>            <span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;PipelinePatientSelectionPage&quot;</span><span class="p">,</span> <span class="s2">&quot;Pipeline Requirements Summary&quot;</span><span class="p">))</span>
</span><span id="PipelinePatientSelectionPage-1014"><a href="#PipelinePatientSelectionPage-1014"><span class="linenos">1014</span></a>
</span><span id="PipelinePatientSelectionPage-1015"><a href="#PipelinePatientSelectionPage-1015"><span class="linenos">1015</span></a>        <span class="c1"># Set translated labels for patient status summary</span>
</span><span id="PipelinePatientSelectionPage-1016"><a href="#PipelinePatientSelectionPage-1016"><span class="linenos">1016</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">total_label</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;PipelinePatientSelectionPage&quot;</span><span class="p">,</span> <span class="s2">&quot;Total Patients&quot;</span><span class="p">))</span>
</span><span id="PipelinePatientSelectionPage-1017"><a href="#PipelinePatientSelectionPage-1017"><span class="linenos">1017</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">eligible_label</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;PipelinePatientSelectionPage&quot;</span><span class="p">,</span> <span class="s2">&quot;Eligible&quot;</span><span class="p">))</span>
</span><span id="PipelinePatientSelectionPage-1018"><a href="#PipelinePatientSelectionPage-1018"><span class="linenos">1018</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">not_eligible_label</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
</span><span id="PipelinePatientSelectionPage-1019"><a href="#PipelinePatientSelectionPage-1019"><span class="linenos">1019</span></a>            <span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;PipelinePatientSelectionPage&quot;</span><span class="p">,</span> <span class="s2">&quot;Not Eligible&quot;</span><span class="p">))</span>
</span><span id="PipelinePatientSelectionPage-1020"><a href="#PipelinePatientSelectionPage-1020"><span class="linenos">1020</span></a>
</span><span id="PipelinePatientSelectionPage-1021"><a href="#PipelinePatientSelectionPage-1021"><span class="linenos">1021</span></a>        <span class="c1"># Reload patient list after updating UI text</span>
</span><span id="PipelinePatientSelectionPage-1022"><a href="#PipelinePatientSelectionPage-1022"><span class="linenos">1022</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_load_patients</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Base class for all application pages.</p>

<p>This abstract widget defines the lifecycle and navigation interface
shared by all pages in the UI (e.g., <code><a href="#PipelinePatientSelectionPage.on_enter">on_enter</a></code>, <code><a href="#PipelinePatientSelectionPage.next">next</a></code>, <code><a href="#PipelinePatientSelectionPage.back">back</a></code>).
Subclasses should override relevant methods to implement page-specific
logic, layout, and transitions.</p>
</div>


                            <div id="PipelinePatientSelectionPage.__init__" class="classattr">
                                        <input id="PipelinePatientSelectionPage.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">PipelinePatientSelectionPage</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">context</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">previous_page</span><span class="o">=</span><span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="PipelinePatientSelectionPage.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PipelinePatientSelectionPage.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PipelinePatientSelectionPage.__init__-21"><a href="#PipelinePatientSelectionPage.__init__-21"><span class="linenos">21</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">previous_page</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="PipelinePatientSelectionPage.__init__-22"><a href="#PipelinePatientSelectionPage.__init__-22"><span class="linenos">22</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="PipelinePatientSelectionPage.__init__-23"><a href="#PipelinePatientSelectionPage.__init__-23"><span class="linenos">23</span></a>
</span><span id="PipelinePatientSelectionPage.__init__-24"><a href="#PipelinePatientSelectionPage.__init__-24"><span class="linenos">24</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">context</span>
</span><span id="PipelinePatientSelectionPage.__init__-25"><a href="#PipelinePatientSelectionPage.__init__-25"><span class="linenos">25</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">previous_page</span> <span class="o">=</span> <span class="n">previous_page</span>
</span><span id="PipelinePatientSelectionPage.__init__-26"><a href="#PipelinePatientSelectionPage.__init__-26"><span class="linenos">26</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">next_page</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="PipelinePatientSelectionPage.__init__-27"><a href="#PipelinePatientSelectionPage.__init__-27"><span class="linenos">27</span></a>
</span><span id="PipelinePatientSelectionPage.__init__-28"><a href="#PipelinePatientSelectionPage.__init__-28"><span class="linenos">28</span></a>        <span class="c1"># Path to the workspace directory containing patient data</span>
</span><span id="PipelinePatientSelectionPage.__init__-29"><a href="#PipelinePatientSelectionPage.__init__-29"><span class="linenos">29</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">workspace_path</span> <span class="o">=</span> <span class="n">context</span><span class="p">[</span><span class="s2">&quot;workspace_path&quot;</span><span class="p">]</span>
</span><span id="PipelinePatientSelectionPage.__init__-30"><a href="#PipelinePatientSelectionPage.__init__-30"><span class="linenos">30</span></a>
</span><span id="PipelinePatientSelectionPage.__init__-31"><a href="#PipelinePatientSelectionPage.__init__-31"><span class="linenos">31</span></a>        <span class="c1"># Dictionaries to track patient widgets, selected patients, and their processing status</span>
</span><span id="PipelinePatientSelectionPage.__init__-32"><a href="#PipelinePatientSelectionPage.__init__-32"><span class="linenos">32</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">patient_buttons</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="PipelinePatientSelectionPage.__init__-33"><a href="#PipelinePatientSelectionPage.__init__-33"><span class="linenos">33</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">selected_patients</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="PipelinePatientSelectionPage.__init__-34"><a href="#PipelinePatientSelectionPage.__init__-34"><span class="linenos">34</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">patient_status</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Stores eligibility and missing data for each patient</span>
</span><span id="PipelinePatientSelectionPage.__init__-35"><a href="#PipelinePatientSelectionPage.__init__-35"><span class="linenos">35</span></a>
</span><span id="PipelinePatientSelectionPage.__init__-36"><a href="#PipelinePatientSelectionPage.__init__-36"><span class="linenos">36</span></a>        <span class="c1"># Initialize the user interface</span>
</span><span id="PipelinePatientSelectionPage.__init__-37"><a href="#PipelinePatientSelectionPage.__init__-37"><span class="linenos">37</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_ui</span><span class="p">()</span>
</span><span id="PipelinePatientSelectionPage.__init__-38"><a href="#PipelinePatientSelectionPage.__init__-38"><span class="linenos">38</span></a>
</span><span id="PipelinePatientSelectionPage.__init__-39"><a href="#PipelinePatientSelectionPage.__init__-39"><span class="linenos">39</span></a>        <span class="c1"># Set translations (for multilingual UI)</span>
</span><span id="PipelinePatientSelectionPage.__init__-40"><a href="#PipelinePatientSelectionPage.__init__-40"><span class="linenos">40</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_translate_ui</span><span class="p">()</span>
</span><span id="PipelinePatientSelectionPage.__init__-41"><a href="#PipelinePatientSelectionPage.__init__-41"><span class="linenos">41</span></a>        <span class="k">if</span> <span class="n">context</span> <span class="ow">and</span> <span class="s2">&quot;language_changed&quot;</span> <span class="ow">in</span> <span class="n">context</span><span class="p">:</span>
</span><span id="PipelinePatientSelectionPage.__init__-42"><a href="#PipelinePatientSelectionPage.__init__-42"><span class="linenos">42</span></a>            <span class="c1"># Connect language change signal for dynamic translation</span>
</span><span id="PipelinePatientSelectionPage.__init__-43"><a href="#PipelinePatientSelectionPage.__init__-43"><span class="linenos">43</span></a>            <span class="n">context</span><span class="p">[</span><span class="s2">&quot;language_changed&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_translate_ui</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="PipelinePatientSelectionPage.context" class="classattr">
                                <div class="attr variable">
            <span class="name">context</span>

        
    </div>
    <a class="headerlink" href="#PipelinePatientSelectionPage.context"></a>
    
    

                            </div>
                            <div id="PipelinePatientSelectionPage.previous_page" class="classattr">
                                <div class="attr variable">
            <span class="name">previous_page</span>

        
    </div>
    <a class="headerlink" href="#PipelinePatientSelectionPage.previous_page"></a>
    
    

                            </div>
                            <div id="PipelinePatientSelectionPage.next_page" class="classattr">
                                <div class="attr variable">
            <span class="name">next_page</span>

        
    </div>
    <a class="headerlink" href="#PipelinePatientSelectionPage.next_page"></a>
    
    

                            </div>
                            <div id="PipelinePatientSelectionPage.workspace_path" class="classattr">
                                <div class="attr variable">
            <span class="name">workspace_path</span>

        
    </div>
    <a class="headerlink" href="#PipelinePatientSelectionPage.workspace_path"></a>
    
    

                            </div>
                            <div id="PipelinePatientSelectionPage.patient_buttons" class="classattr">
                                <div class="attr variable">
            <span class="name">patient_buttons</span>

        
    </div>
    <a class="headerlink" href="#PipelinePatientSelectionPage.patient_buttons"></a>
    
    

                            </div>
                            <div id="PipelinePatientSelectionPage.selected_patients" class="classattr">
                                <div class="attr variable">
            <span class="name">selected_patients</span>

        
    </div>
    <a class="headerlink" href="#PipelinePatientSelectionPage.selected_patients"></a>
    
    

                            </div>
                            <div id="PipelinePatientSelectionPage.patient_status" class="classattr">
                                <div class="attr variable">
            <span class="name">patient_status</span>

        
    </div>
    <a class="headerlink" href="#PipelinePatientSelectionPage.patient_status"></a>
    
    

                            </div>
                            <div id="PipelinePatientSelectionPage.on_enter" class="classattr">
                                        <input id="PipelinePatientSelectionPage.on_enter-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">on_enter</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="PipelinePatientSelectionPage.on_enter-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PipelinePatientSelectionPage.on_enter"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PipelinePatientSelectionPage.on_enter-804"><a href="#PipelinePatientSelectionPage.on_enter-804"><span class="linenos">804</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">on_enter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="PipelinePatientSelectionPage.on_enter-805"><a href="#PipelinePatientSelectionPage.on_enter-805"><span class="linenos">805</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Triggered when entering this page of the application.</span>
</span><span id="PipelinePatientSelectionPage.on_enter-806"><a href="#PipelinePatientSelectionPage.on_enter-806"><span class="linenos">806</span></a>
</span><span id="PipelinePatientSelectionPage.on_enter-807"><a href="#PipelinePatientSelectionPage.on_enter-807"><span class="linenos">807</span></a><span class="sd">        Used to refresh patient statuses when the user navigates to this page.</span>
</span><span id="PipelinePatientSelectionPage.on_enter-808"><a href="#PipelinePatientSelectionPage.on_enter-808"><span class="linenos">808</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PipelinePatientSelectionPage.on_enter-809"><a href="#PipelinePatientSelectionPage.on_enter-809"><span class="linenos">809</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_refresh_patient_status</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Triggered when entering this page of the application.</p>

<p>Used to refresh patient statuses when the user navigates to this page.</p>
</div>


                            </div>
                            <div id="PipelinePatientSelectionPage.is_ready_to_advance" class="classattr">
                                        <input id="PipelinePatientSelectionPage.is_ready_to_advance-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">is_ready_to_advance</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="PipelinePatientSelectionPage.is_ready_to_advance-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PipelinePatientSelectionPage.is_ready_to_advance"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PipelinePatientSelectionPage.is_ready_to_advance-811"><a href="#PipelinePatientSelectionPage.is_ready_to_advance-811"><span class="linenos">811</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">is_ready_to_advance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="PipelinePatientSelectionPage.is_ready_to_advance-812"><a href="#PipelinePatientSelectionPage.is_ready_to_advance-812"><span class="linenos">812</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check whether the application can proceed to the next page.</span>
</span><span id="PipelinePatientSelectionPage.is_ready_to_advance-813"><a href="#PipelinePatientSelectionPage.is_ready_to_advance-813"><span class="linenos">813</span></a>
</span><span id="PipelinePatientSelectionPage.is_ready_to_advance-814"><a href="#PipelinePatientSelectionPage.is_ready_to_advance-814"><span class="linenos">814</span></a><span class="sd">        Returns:</span>
</span><span id="PipelinePatientSelectionPage.is_ready_to_advance-815"><a href="#PipelinePatientSelectionPage.is_ready_to_advance-815"><span class="linenos">815</span></a><span class="sd">            bool: True if at least one patient has been selected, otherwise False.</span>
</span><span id="PipelinePatientSelectionPage.is_ready_to_advance-816"><a href="#PipelinePatientSelectionPage.is_ready_to_advance-816"><span class="linenos">816</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PipelinePatientSelectionPage.is_ready_to_advance-817"><a href="#PipelinePatientSelectionPage.is_ready_to_advance-817"><span class="linenos">817</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_patients</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span></pre></div>


            <div class="docstring"><p>Check whether the application can proceed to the next page.</p>

<p>Returns:
    bool: True if at least one patient has been selected, otherwise False.</p>
</div>


                            </div>
                            <div id="PipelinePatientSelectionPage.is_ready_to_go_back" class="classattr">
                                        <input id="PipelinePatientSelectionPage.is_ready_to_go_back-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">is_ready_to_go_back</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="PipelinePatientSelectionPage.is_ready_to_go_back-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PipelinePatientSelectionPage.is_ready_to_go_back"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PipelinePatientSelectionPage.is_ready_to_go_back-819"><a href="#PipelinePatientSelectionPage.is_ready_to_go_back-819"><span class="linenos">819</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">is_ready_to_go_back</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="PipelinePatientSelectionPage.is_ready_to_go_back-820"><a href="#PipelinePatientSelectionPage.is_ready_to_go_back-820"><span class="linenos">820</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check whether the user can navigate back to the previous page.</span>
</span><span id="PipelinePatientSelectionPage.is_ready_to_go_back-821"><a href="#PipelinePatientSelectionPage.is_ready_to_go_back-821"><span class="linenos">821</span></a>
</span><span id="PipelinePatientSelectionPage.is_ready_to_go_back-822"><a href="#PipelinePatientSelectionPage.is_ready_to_go_back-822"><span class="linenos">822</span></a><span class="sd">        Returns:</span>
</span><span id="PipelinePatientSelectionPage.is_ready_to_go_back-823"><a href="#PipelinePatientSelectionPage.is_ready_to_go_back-823"><span class="linenos">823</span></a><span class="sd">            bool: Always True (navigation backward is always allowed).</span>
</span><span id="PipelinePatientSelectionPage.is_ready_to_go_back-824"><a href="#PipelinePatientSelectionPage.is_ready_to_go_back-824"><span class="linenos">824</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PipelinePatientSelectionPage.is_ready_to_go_back-825"><a href="#PipelinePatientSelectionPage.is_ready_to_go_back-825"><span class="linenos">825</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>Check whether the user can navigate back to the previous page.</p>

<p>Returns:
    bool: Always True (navigation backward is always allowed).</p>
</div>


                            </div>
                            <div id="PipelinePatientSelectionPage.next" class="classattr">
                                        <input id="PipelinePatientSelectionPage.next-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">next</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">context</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="PipelinePatientSelectionPage.next-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PipelinePatientSelectionPage.next"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PipelinePatientSelectionPage.next-827"><a href="#PipelinePatientSelectionPage.next-827"><span class="linenos">827</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
</span><span id="PipelinePatientSelectionPage.next-828"><a href="#PipelinePatientSelectionPage.next-828"><span class="linenos">828</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Proceed to the next page in the pipeline process.</span>
</span><span id="PipelinePatientSelectionPage.next-829"><a href="#PipelinePatientSelectionPage.next-829"><span class="linenos">829</span></a>
</span><span id="PipelinePatientSelectionPage.next-830"><a href="#PipelinePatientSelectionPage.next-830"><span class="linenos">830</span></a><span class="sd">        This method builds the pipeline configuration and navigates</span>
</span><span id="PipelinePatientSelectionPage.next-831"><a href="#PipelinePatientSelectionPage.next-831"><span class="linenos">831</span></a><span class="sd">        to the review page (`PipelineReviewPage`).</span>
</span><span id="PipelinePatientSelectionPage.next-832"><a href="#PipelinePatientSelectionPage.next-832"><span class="linenos">832</span></a>
</span><span id="PipelinePatientSelectionPage.next-833"><a href="#PipelinePatientSelectionPage.next-833"><span class="linenos">833</span></a><span class="sd">        Args:</span>
</span><span id="PipelinePatientSelectionPage.next-834"><a href="#PipelinePatientSelectionPage.next-834"><span class="linenos">834</span></a><span class="sd">            context (dict): Application context containing state and shared data.</span>
</span><span id="PipelinePatientSelectionPage.next-835"><a href="#PipelinePatientSelectionPage.next-835"><span class="linenos">835</span></a>
</span><span id="PipelinePatientSelectionPage.next-836"><a href="#PipelinePatientSelectionPage.next-836"><span class="linenos">836</span></a><span class="sd">        Returns:</span>
</span><span id="PipelinePatientSelectionPage.next-837"><a href="#PipelinePatientSelectionPage.next-837"><span class="linenos">837</span></a><span class="sd">            Page: The next page to display.</span>
</span><span id="PipelinePatientSelectionPage.next-838"><a href="#PipelinePatientSelectionPage.next-838"><span class="linenos">838</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PipelinePatientSelectionPage.next-839"><a href="#PipelinePatientSelectionPage.next-839"><span class="linenos">839</span></a>        <span class="c1"># Generate a new pipeline configuration file before continuing</span>
</span><span id="PipelinePatientSelectionPage.next-840"><a href="#PipelinePatientSelectionPage.next-840"><span class="linenos">840</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_build_pipeline_config</span><span class="p">()</span>
</span><span id="PipelinePatientSelectionPage.next-841"><a href="#PipelinePatientSelectionPage.next-841"><span class="linenos">841</span></a>
</span><span id="PipelinePatientSelectionPage.next-842"><a href="#PipelinePatientSelectionPage.next-842"><span class="linenos">842</span></a>        <span class="c1"># If a next page already exists, reuse it</span>
</span><span id="PipelinePatientSelectionPage.next-843"><a href="#PipelinePatientSelectionPage.next-843"><span class="linenos">843</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_page</span><span class="p">:</span>
</span><span id="PipelinePatientSelectionPage.next-844"><a href="#PipelinePatientSelectionPage.next-844"><span class="linenos">844</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next_page</span><span class="o">.</span><span class="n">on_enter</span><span class="p">()</span>
</span><span id="PipelinePatientSelectionPage.next-845"><a href="#PipelinePatientSelectionPage.next-845"><span class="linenos">845</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_page</span>
</span><span id="PipelinePatientSelectionPage.next-846"><a href="#PipelinePatientSelectionPage.next-846"><span class="linenos">846</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PipelinePatientSelectionPage.next-847"><a href="#PipelinePatientSelectionPage.next-847"><span class="linenos">847</span></a>            <span class="c1"># Otherwise, create a new review page and register it in navigation history</span>
</span><span id="PipelinePatientSelectionPage.next-848"><a href="#PipelinePatientSelectionPage.next-848"><span class="linenos">848</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next_page</span> <span class="o">=</span> <span class="n">PipelineReviewPage</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage.next-849"><a href="#PipelinePatientSelectionPage.next-849"><span class="linenos">849</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s2">&quot;history&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">next_page</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage.next-850"><a href="#PipelinePatientSelectionPage.next-850"><span class="linenos">850</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">next_page</span><span class="o">.</span><span class="n">on_enter</span><span class="p">()</span>
</span><span id="PipelinePatientSelectionPage.next-851"><a href="#PipelinePatientSelectionPage.next-851"><span class="linenos">851</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_page</span>
</span></pre></div>


            <div class="docstring"><p>Proceed to the next page in the pipeline process.</p>

<p>This method builds the pipeline configuration and navigates
to the review page (<code>PipelineReviewPage</code>).</p>

<p>Args:
    context (dict): Application context containing state and shared data.</p>

<p>Returns:
    Page: The next page to display.</p>
</div>


                            </div>
                            <div id="PipelinePatientSelectionPage.back" class="classattr">
                                        <input id="PipelinePatientSelectionPage.back-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">back</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="PipelinePatientSelectionPage.back-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PipelinePatientSelectionPage.back"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PipelinePatientSelectionPage.back-853"><a href="#PipelinePatientSelectionPage.back-853"><span class="linenos">853</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">back</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="PipelinePatientSelectionPage.back-854"><a href="#PipelinePatientSelectionPage.back-854"><span class="linenos">854</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Navigate back to the previous page.</span>
</span><span id="PipelinePatientSelectionPage.back-855"><a href="#PipelinePatientSelectionPage.back-855"><span class="linenos">855</span></a>
</span><span id="PipelinePatientSelectionPage.back-856"><a href="#PipelinePatientSelectionPage.back-856"><span class="linenos">856</span></a><span class="sd">        Returns:</span>
</span><span id="PipelinePatientSelectionPage.back-857"><a href="#PipelinePatientSelectionPage.back-857"><span class="linenos">857</span></a><span class="sd">            Page or None: The previous page if available, otherwise None.</span>
</span><span id="PipelinePatientSelectionPage.back-858"><a href="#PipelinePatientSelectionPage.back-858"><span class="linenos">858</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PipelinePatientSelectionPage.back-859"><a href="#PipelinePatientSelectionPage.back-859"><span class="linenos">859</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_page</span><span class="p">:</span>
</span><span id="PipelinePatientSelectionPage.back-860"><a href="#PipelinePatientSelectionPage.back-860"><span class="linenos">860</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">previous_page</span><span class="o">.</span><span class="n">on_enter</span><span class="p">()</span>
</span><span id="PipelinePatientSelectionPage.back-861"><a href="#PipelinePatientSelectionPage.back-861"><span class="linenos">861</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_page</span>
</span><span id="PipelinePatientSelectionPage.back-862"><a href="#PipelinePatientSelectionPage.back-862"><span class="linenos">862</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Navigate back to the previous page.</p>

<p>Returns:
    Page or None: The previous page if available, otherwise None.</p>
</div>


                            </div>
                            <div id="PipelinePatientSelectionPage.get_selected_patients" class="classattr">
                                        <input id="PipelinePatientSelectionPage.get_selected_patients-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_selected_patients</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="PipelinePatientSelectionPage.get_selected_patients-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PipelinePatientSelectionPage.get_selected_patients"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PipelinePatientSelectionPage.get_selected_patients-864"><a href="#PipelinePatientSelectionPage.get_selected_patients-864"><span class="linenos">864</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_selected_patients</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="PipelinePatientSelectionPage.get_selected_patients-865"><a href="#PipelinePatientSelectionPage.get_selected_patients-865"><span class="linenos">865</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve the list of currently selected patients.</span>
</span><span id="PipelinePatientSelectionPage.get_selected_patients-866"><a href="#PipelinePatientSelectionPage.get_selected_patients-866"><span class="linenos">866</span></a>
</span><span id="PipelinePatientSelectionPage.get_selected_patients-867"><a href="#PipelinePatientSelectionPage.get_selected_patients-867"><span class="linenos">867</span></a><span class="sd">        Returns:</span>
</span><span id="PipelinePatientSelectionPage.get_selected_patients-868"><a href="#PipelinePatientSelectionPage.get_selected_patients-868"><span class="linenos">868</span></a><span class="sd">            list[str]: A list of selected patient IDs.</span>
</span><span id="PipelinePatientSelectionPage.get_selected_patients-869"><a href="#PipelinePatientSelectionPage.get_selected_patients-869"><span class="linenos">869</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PipelinePatientSelectionPage.get_selected_patients-870"><a href="#PipelinePatientSelectionPage.get_selected_patients-870"><span class="linenos">870</span></a>        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_patients</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Retrieve the list of currently selected patients.</p>

<p>Returns:
    list[str]: A list of selected patient IDs.</p>
</div>


                            </div>
                            <div id="PipelinePatientSelectionPage.get_eligible_patients" class="classattr">
                                        <input id="PipelinePatientSelectionPage.get_eligible_patients-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_eligible_patients</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="PipelinePatientSelectionPage.get_eligible_patients-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PipelinePatientSelectionPage.get_eligible_patients"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PipelinePatientSelectionPage.get_eligible_patients-872"><a href="#PipelinePatientSelectionPage.get_eligible_patients-872"><span class="linenos">872</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_eligible_patients</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="PipelinePatientSelectionPage.get_eligible_patients-873"><a href="#PipelinePatientSelectionPage.get_eligible_patients-873"><span class="linenos">873</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve the list of patients marked as eligible.</span>
</span><span id="PipelinePatientSelectionPage.get_eligible_patients-874"><a href="#PipelinePatientSelectionPage.get_eligible_patients-874"><span class="linenos">874</span></a>
</span><span id="PipelinePatientSelectionPage.get_eligible_patients-875"><a href="#PipelinePatientSelectionPage.get_eligible_patients-875"><span class="linenos">875</span></a><span class="sd">        Returns:</span>
</span><span id="PipelinePatientSelectionPage.get_eligible_patients-876"><a href="#PipelinePatientSelectionPage.get_eligible_patients-876"><span class="linenos">876</span></a><span class="sd">            list[str]: A list of patient IDs where `status[&#39;eligible&#39;]` is True.</span>
</span><span id="PipelinePatientSelectionPage.get_eligible_patients-877"><a href="#PipelinePatientSelectionPage.get_eligible_patients-877"><span class="linenos">877</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PipelinePatientSelectionPage.get_eligible_patients-878"><a href="#PipelinePatientSelectionPage.get_eligible_patients-878"><span class="linenos">878</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">pid</span> <span class="k">for</span> <span class="n">pid</span><span class="p">,</span> <span class="n">status</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">patient_status</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">status</span><span class="p">[</span><span class="s1">&#39;eligible&#39;</span><span class="p">]]</span>
</span></pre></div>


            <div class="docstring"><p>Retrieve the list of patients marked as eligible.</p>

<p>Returns:
    list[str]: A list of patient IDs where <code>status['eligible']</code> is True.</p>
</div>


                            </div>
                            <div id="PipelinePatientSelectionPage.get_patient_status_summary" class="classattr">
                                        <input id="PipelinePatientSelectionPage.get_patient_status_summary-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_patient_status_summary</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="PipelinePatientSelectionPage.get_patient_status_summary-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PipelinePatientSelectionPage.get_patient_status_summary"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PipelinePatientSelectionPage.get_patient_status_summary-880"><a href="#PipelinePatientSelectionPage.get_patient_status_summary-880"><span class="linenos">880</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_patient_status_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="PipelinePatientSelectionPage.get_patient_status_summary-881"><a href="#PipelinePatientSelectionPage.get_patient_status_summary-881"><span class="linenos">881</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a summary of the current patient status.</span>
</span><span id="PipelinePatientSelectionPage.get_patient_status_summary-882"><a href="#PipelinePatientSelectionPage.get_patient_status_summary-882"><span class="linenos">882</span></a>
</span><span id="PipelinePatientSelectionPage.get_patient_status_summary-883"><a href="#PipelinePatientSelectionPage.get_patient_status_summary-883"><span class="linenos">883</span></a><span class="sd">        This method calculates basic statistics about the patients in the current</span>
</span><span id="PipelinePatientSelectionPage.get_patient_status_summary-884"><a href="#PipelinePatientSelectionPage.get_patient_status_summary-884"><span class="linenos">884</span></a><span class="sd">        workspace, including total number, number of eligible patients, and number</span>
</span><span id="PipelinePatientSelectionPage.get_patient_status_summary-885"><a href="#PipelinePatientSelectionPage.get_patient_status_summary-885"><span class="linenos">885</span></a><span class="sd">        of selected patients. It also computes how many are not eligible.</span>
</span><span id="PipelinePatientSelectionPage.get_patient_status_summary-886"><a href="#PipelinePatientSelectionPage.get_patient_status_summary-886"><span class="linenos">886</span></a>
</span><span id="PipelinePatientSelectionPage.get_patient_status_summary-887"><a href="#PipelinePatientSelectionPage.get_patient_status_summary-887"><span class="linenos">887</span></a><span class="sd">        Returns:</span>
</span><span id="PipelinePatientSelectionPage.get_patient_status_summary-888"><a href="#PipelinePatientSelectionPage.get_patient_status_summary-888"><span class="linenos">888</span></a><span class="sd">            dict: A dictionary containing patient status counts:</span>
</span><span id="PipelinePatientSelectionPage.get_patient_status_summary-889"><a href="#PipelinePatientSelectionPage.get_patient_status_summary-889"><span class="linenos">889</span></a><span class="sd">                - &#39;total&#39;: Total number of patients</span>
</span><span id="PipelinePatientSelectionPage.get_patient_status_summary-890"><a href="#PipelinePatientSelectionPage.get_patient_status_summary-890"><span class="linenos">890</span></a><span class="sd">                - &#39;eligible&#39;: Number of eligible patients</span>
</span><span id="PipelinePatientSelectionPage.get_patient_status_summary-891"><a href="#PipelinePatientSelectionPage.get_patient_status_summary-891"><span class="linenos">891</span></a><span class="sd">                - &#39;selected&#39;: Number of currently selected patients</span>
</span><span id="PipelinePatientSelectionPage.get_patient_status_summary-892"><a href="#PipelinePatientSelectionPage.get_patient_status_summary-892"><span class="linenos">892</span></a><span class="sd">                - &#39;not_eligible&#39;: Number of non-eligible patients</span>
</span><span id="PipelinePatientSelectionPage.get_patient_status_summary-893"><a href="#PipelinePatientSelectionPage.get_patient_status_summary-893"><span class="linenos">893</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PipelinePatientSelectionPage.get_patient_status_summary-894"><a href="#PipelinePatientSelectionPage.get_patient_status_summary-894"><span class="linenos">894</span></a>        <span class="n">total</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">patient_status</span><span class="p">)</span>  <span class="c1"># Count total patients being tracked</span>
</span><span id="PipelinePatientSelectionPage.get_patient_status_summary-895"><a href="#PipelinePatientSelectionPage.get_patient_status_summary-895"><span class="linenos">895</span></a>        <span class="n">eligible</span> <span class="o">=</span> <span class="nb">len</span><span class="p">([</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">patient_status</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;eligible&#39;</span><span class="p">]])</span>  <span class="c1"># Count eligible ones</span>
</span><span id="PipelinePatientSelectionPage.get_patient_status_summary-896"><a href="#PipelinePatientSelectionPage.get_patient_status_summary-896"><span class="linenos">896</span></a>        <span class="n">selected</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_patients</span><span class="p">)</span>  <span class="c1"># Count selected patients</span>
</span><span id="PipelinePatientSelectionPage.get_patient_status_summary-897"><a href="#PipelinePatientSelectionPage.get_patient_status_summary-897"><span class="linenos">897</span></a>
</span><span id="PipelinePatientSelectionPage.get_patient_status_summary-898"><a href="#PipelinePatientSelectionPage.get_patient_status_summary-898"><span class="linenos">898</span></a>        <span class="c1"># Return a dictionary summarizing all relevant counts</span>
</span><span id="PipelinePatientSelectionPage.get_patient_status_summary-899"><a href="#PipelinePatientSelectionPage.get_patient_status_summary-899"><span class="linenos">899</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="PipelinePatientSelectionPage.get_patient_status_summary-900"><a href="#PipelinePatientSelectionPage.get_patient_status_summary-900"><span class="linenos">900</span></a>            <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="n">total</span><span class="p">,</span>
</span><span id="PipelinePatientSelectionPage.get_patient_status_summary-901"><a href="#PipelinePatientSelectionPage.get_patient_status_summary-901"><span class="linenos">901</span></a>            <span class="s1">&#39;eligible&#39;</span><span class="p">:</span> <span class="n">eligible</span><span class="p">,</span>
</span><span id="PipelinePatientSelectionPage.get_patient_status_summary-902"><a href="#PipelinePatientSelectionPage.get_patient_status_summary-902"><span class="linenos">902</span></a>            <span class="s1">&#39;selected&#39;</span><span class="p">:</span> <span class="n">selected</span><span class="p">,</span>
</span><span id="PipelinePatientSelectionPage.get_patient_status_summary-903"><a href="#PipelinePatientSelectionPage.get_patient_status_summary-903"><span class="linenos">903</span></a>            <span class="s1">&#39;not_eligible&#39;</span><span class="p">:</span> <span class="n">total</span> <span class="o">-</span> <span class="n">eligible</span>
</span><span id="PipelinePatientSelectionPage.get_patient_status_summary-904"><a href="#PipelinePatientSelectionPage.get_patient_status_summary-904"><span class="linenos">904</span></a>        <span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Return a summary of the current patient status.</p>

<p>This method calculates basic statistics about the patients in the current
workspace, including total number, number of eligible patients, and number
of selected patients. It also computes how many are not eligible.</p>

<p>Returns:
    dict: A dictionary containing patient status counts:
        - 'total': Total number of patients
        - 'eligible': Number of eligible patients
        - 'selected': Number of currently selected patients
        - 'not_eligible': Number of non-eligible patients</p>
</div>


                            </div>
                            <div id="PipelinePatientSelectionPage.reset_page" class="classattr">
                                        <input id="PipelinePatientSelectionPage.reset_page-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">reset_page</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="PipelinePatientSelectionPage.reset_page-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PipelinePatientSelectionPage.reset_page"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PipelinePatientSelectionPage.reset_page-906"><a href="#PipelinePatientSelectionPage.reset_page-906"><span class="linenos">906</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">reset_page</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="PipelinePatientSelectionPage.reset_page-907"><a href="#PipelinePatientSelectionPage.reset_page-907"><span class="linenos">907</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Completely reset the current page.</span>
</span><span id="PipelinePatientSelectionPage.reset_page-908"><a href="#PipelinePatientSelectionPage.reset_page-908"><span class="linenos">908</span></a>
</span><span id="PipelinePatientSelectionPage.reset_page-909"><a href="#PipelinePatientSelectionPage.reset_page-909"><span class="linenos">909</span></a><span class="sd">        This method clears the UI grid, removes all patient-related widgets,</span>
</span><span id="PipelinePatientSelectionPage.reset_page-910"><a href="#PipelinePatientSelectionPage.reset_page-910"><span class="linenos">910</span></a><span class="sd">        resets the internal data structures tracking patient selection and status,</span>
</span><span id="PipelinePatientSelectionPage.reset_page-911"><a href="#PipelinePatientSelectionPage.reset_page-911"><span class="linenos">911</span></a><span class="sd">        and then reloads the list of patients.</span>
</span><span id="PipelinePatientSelectionPage.reset_page-912"><a href="#PipelinePatientSelectionPage.reset_page-912"><span class="linenos">912</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PipelinePatientSelectionPage.reset_page-913"><a href="#PipelinePatientSelectionPage.reset_page-913"><span class="linenos">913</span></a>        <span class="c1"># Clear all widgets from the grid layout</span>
</span><span id="PipelinePatientSelectionPage.reset_page-914"><a href="#PipelinePatientSelectionPage.reset_page-914"><span class="linenos">914</span></a>        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_layout</span><span class="o">.</span><span class="n">count</span><span class="p">():</span>
</span><span id="PipelinePatientSelectionPage.reset_page-915"><a href="#PipelinePatientSelectionPage.reset_page-915"><span class="linenos">915</span></a>            <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_layout</span><span class="o">.</span><span class="n">takeAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage.reset_page-916"><a href="#PipelinePatientSelectionPage.reset_page-916"><span class="linenos">916</span></a>            <span class="n">widget</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span>
</span><span id="PipelinePatientSelectionPage.reset_page-917"><a href="#PipelinePatientSelectionPage.reset_page-917"><span class="linenos">917</span></a>            <span class="k">if</span> <span class="n">widget</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PipelinePatientSelectionPage.reset_page-918"><a href="#PipelinePatientSelectionPage.reset_page-918"><span class="linenos">918</span></a>                <span class="n">widget</span><span class="o">.</span><span class="n">setParent</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>  <span class="c1"># Detach widget from layout</span>
</span><span id="PipelinePatientSelectionPage.reset_page-919"><a href="#PipelinePatientSelectionPage.reset_page-919"><span class="linenos">919</span></a>                <span class="n">widget</span><span class="o">.</span><span class="n">deleteLater</span><span class="p">()</span>  <span class="c1"># Schedule for deletion</span>
</span><span id="PipelinePatientSelectionPage.reset_page-920"><a href="#PipelinePatientSelectionPage.reset_page-920"><span class="linenos">920</span></a>
</span><span id="PipelinePatientSelectionPage.reset_page-921"><a href="#PipelinePatientSelectionPage.reset_page-921"><span class="linenos">921</span></a>        <span class="c1"># Reset all patient-related states</span>
</span><span id="PipelinePatientSelectionPage.reset_page-922"><a href="#PipelinePatientSelectionPage.reset_page-922"><span class="linenos">922</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">selected_patients</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>  <span class="c1"># Clear selected patients</span>
</span><span id="PipelinePatientSelectionPage.reset_page-923"><a href="#PipelinePatientSelectionPage.reset_page-923"><span class="linenos">923</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">patient_buttons</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>  <span class="c1"># Clear patient button references</span>
</span><span id="PipelinePatientSelectionPage.reset_page-924"><a href="#PipelinePatientSelectionPage.reset_page-924"><span class="linenos">924</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">patient_status</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>  <span class="c1"># Clear patient status dictionary</span>
</span><span id="PipelinePatientSelectionPage.reset_page-925"><a href="#PipelinePatientSelectionPage.reset_page-925"><span class="linenos">925</span></a>
</span><span id="PipelinePatientSelectionPage.reset_page-926"><a href="#PipelinePatientSelectionPage.reset_page-926"><span class="linenos">926</span></a>        <span class="c1"># Reload all patient data from the workspace</span>
</span><span id="PipelinePatientSelectionPage.reset_page-927"><a href="#PipelinePatientSelectionPage.reset_page-927"><span class="linenos">927</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_load_patients</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Completely reset the current page.</p>

<p>This method clears the UI grid, removes all patient-related widgets,
resets the internal data structures tracking patient selection and status,
and then reloads the list of patients.</p>
</div>


                            </div>
                            <div id="PipelinePatientSelectionPage.resizeEvent" class="classattr">
                                        <input id="PipelinePatientSelectionPage.resizeEvent-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">resizeEvent</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">event</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="PipelinePatientSelectionPage.resizeEvent-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PipelinePatientSelectionPage.resizeEvent"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PipelinePatientSelectionPage.resizeEvent-929"><a href="#PipelinePatientSelectionPage.resizeEvent-929"><span class="linenos">929</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">resizeEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
</span><span id="PipelinePatientSelectionPage.resizeEvent-930"><a href="#PipelinePatientSelectionPage.resizeEvent-930"><span class="linenos">930</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Make the interface responsive based on the window height.</span>
</span><span id="PipelinePatientSelectionPage.resizeEvent-931"><a href="#PipelinePatientSelectionPage.resizeEvent-931"><span class="linenos">931</span></a>
</span><span id="PipelinePatientSelectionPage.resizeEvent-932"><a href="#PipelinePatientSelectionPage.resizeEvent-932"><span class="linenos">932</span></a><span class="sd">        This event handler adjusts font sizes, button padding, and layout proportions</span>
</span><span id="PipelinePatientSelectionPage.resizeEvent-933"><a href="#PipelinePatientSelectionPage.resizeEvent-933"><span class="linenos">933</span></a><span class="sd">        dynamically when the main window is resized. It ensures usability and readability</span>
</span><span id="PipelinePatientSelectionPage.resizeEvent-934"><a href="#PipelinePatientSelectionPage.resizeEvent-934"><span class="linenos">934</span></a><span class="sd">        for both small and large window sizes.</span>
</span><span id="PipelinePatientSelectionPage.resizeEvent-935"><a href="#PipelinePatientSelectionPage.resizeEvent-935"><span class="linenos">935</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PipelinePatientSelectionPage.resizeEvent-936"><a href="#PipelinePatientSelectionPage.resizeEvent-936"><span class="linenos">936</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">resizeEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage.resizeEvent-937"><a href="#PipelinePatientSelectionPage.resizeEvent-937"><span class="linenos">937</span></a>
</span><span id="PipelinePatientSelectionPage.resizeEvent-938"><a href="#PipelinePatientSelectionPage.resizeEvent-938"><span class="linenos">938</span></a>        <span class="c1"># Update column count dynamically based on width</span>
</span><span id="PipelinePatientSelectionPage.resizeEvent-939"><a href="#PipelinePatientSelectionPage.resizeEvent-939"><span class="linenos">939</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_update_column_count</span><span class="p">()</span>
</span><span id="PipelinePatientSelectionPage.resizeEvent-940"><a href="#PipelinePatientSelectionPage.resizeEvent-940"><span class="linenos">940</span></a>
</span><span id="PipelinePatientSelectionPage.resizeEvent-941"><a href="#PipelinePatientSelectionPage.resizeEvent-941"><span class="linenos">941</span></a>        <span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">()</span>  <span class="c1"># Current window height</span>
</span><span id="PipelinePatientSelectionPage.resizeEvent-942"><a href="#PipelinePatientSelectionPage.resizeEvent-942"><span class="linenos">942</span></a>
</span><span id="PipelinePatientSelectionPage.resizeEvent-943"><a href="#PipelinePatientSelectionPage.resizeEvent-943"><span class="linenos">943</span></a>        <span class="c1"># Adjust UI style dynamically for small or large window height</span>
</span><span id="PipelinePatientSelectionPage.resizeEvent-944"><a href="#PipelinePatientSelectionPage.resizeEvent-944"><span class="linenos">944</span></a>        <span class="k">if</span> <span class="n">height</span> <span class="o">&lt;</span> <span class="mi">500</span><span class="p">:</span>
</span><span id="PipelinePatientSelectionPage.resizeEvent-945"><a href="#PipelinePatientSelectionPage.resizeEvent-945"><span class="linenos">945</span></a>            <span class="c1"># Compact layout for small windows</span>
</span><span id="PipelinePatientSelectionPage.resizeEvent-946"><a href="#PipelinePatientSelectionPage.resizeEvent-946"><span class="linenos">946</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;font-size: 14px; font-weight: bold; margin-bottom: 5px;&quot;</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage.resizeEvent-947"><a href="#PipelinePatientSelectionPage.resizeEvent-947"><span class="linenos">947</span></a>            <span class="n">btn_padding</span> <span class="o">=</span> <span class="s2">&quot;5px 10px&quot;</span>
</span><span id="PipelinePatientSelectionPage.resizeEvent-948"><a href="#PipelinePatientSelectionPage.resizeEvent-948"><span class="linenos">948</span></a>            <span class="n">font_size_btn</span> <span class="o">=</span> <span class="mi">11</span>
</span><span id="PipelinePatientSelectionPage.resizeEvent-949"><a href="#PipelinePatientSelectionPage.resizeEvent-949"><span class="linenos">949</span></a>            <span class="n">max_pill_height</span> <span class="o">=</span> <span class="mi">70</span>
</span><span id="PipelinePatientSelectionPage.resizeEvent-950"><a href="#PipelinePatientSelectionPage.resizeEvent-950"><span class="linenos">950</span></a>            <span class="n">font_size_title</span> <span class="o">=</span> <span class="mi">12</span>
</span><span id="PipelinePatientSelectionPage.resizeEvent-951"><a href="#PipelinePatientSelectionPage.resizeEvent-951"><span class="linenos">951</span></a>            <span class="n">font_size_value</span> <span class="o">=</span> <span class="mi">14</span>
</span><span id="PipelinePatientSelectionPage.resizeEvent-952"><a href="#PipelinePatientSelectionPage.resizeEvent-952"><span class="linenos">952</span></a>            <span class="n">font_size_label</span> <span class="o">=</span> <span class="mi">10</span>
</span><span id="PipelinePatientSelectionPage.resizeEvent-953"><a href="#PipelinePatientSelectionPage.resizeEvent-953"><span class="linenos">953</span></a>            <span class="n">max_pill_height</span> <span class="o">=</span> <span class="mi">60</span>
</span><span id="PipelinePatientSelectionPage.resizeEvent-954"><a href="#PipelinePatientSelectionPage.resizeEvent-954"><span class="linenos">954</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="PipelinePatientSelectionPage.resizeEvent-955"><a href="#PipelinePatientSelectionPage.resizeEvent-955"><span class="linenos">955</span></a>            <span class="c1"># Normal layout for larger windows</span>
</span><span id="PipelinePatientSelectionPage.resizeEvent-956"><a href="#PipelinePatientSelectionPage.resizeEvent-956"><span class="linenos">956</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="s2">&quot;font-size: 18px; font-weight: bold; margin-bottom: 10px;&quot;</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage.resizeEvent-957"><a href="#PipelinePatientSelectionPage.resizeEvent-957"><span class="linenos">957</span></a>            <span class="n">btn_padding</span> <span class="o">=</span> <span class="s2">&quot;10px 20px&quot;</span>
</span><span id="PipelinePatientSelectionPage.resizeEvent-958"><a href="#PipelinePatientSelectionPage.resizeEvent-958"><span class="linenos">958</span></a>            <span class="n">font_size_btn</span> <span class="o">=</span> <span class="mi">13</span>
</span><span id="PipelinePatientSelectionPage.resizeEvent-959"><a href="#PipelinePatientSelectionPage.resizeEvent-959"><span class="linenos">959</span></a>            <span class="n">font_size_title</span> <span class="o">=</span> <span class="mi">16</span>
</span><span id="PipelinePatientSelectionPage.resizeEvent-960"><a href="#PipelinePatientSelectionPage.resizeEvent-960"><span class="linenos">960</span></a>            <span class="n">font_size_value</span> <span class="o">=</span> <span class="mi">20</span>
</span><span id="PipelinePatientSelectionPage.resizeEvent-961"><a href="#PipelinePatientSelectionPage.resizeEvent-961"><span class="linenos">961</span></a>            <span class="n">font_size_label</span> <span class="o">=</span> <span class="mi">13</span>
</span><span id="PipelinePatientSelectionPage.resizeEvent-962"><a href="#PipelinePatientSelectionPage.resizeEvent-962"><span class="linenos">962</span></a>            <span class="n">max_pill_height</span> <span class="o">=</span> <span class="mi">100</span>
</span><span id="PipelinePatientSelectionPage.resizeEvent-963"><a href="#PipelinePatientSelectionPage.resizeEvent-963"><span class="linenos">963</span></a>
</span><span id="PipelinePatientSelectionPage.resizeEvent-964"><a href="#PipelinePatientSelectionPage.resizeEvent-964"><span class="linenos">964</span></a>        <span class="c1"># Update button styles dynamically</span>
</span><span id="PipelinePatientSelectionPage.resizeEvent-965"><a href="#PipelinePatientSelectionPage.resizeEvent-965"><span class="linenos">965</span></a>        <span class="k">for</span> <span class="n">btn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">buttons</span><span class="p">:</span>
</span><span id="PipelinePatientSelectionPage.resizeEvent-966"><a href="#PipelinePatientSelectionPage.resizeEvent-966"><span class="linenos">966</span></a>            <span class="n">btn</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="PipelinePatientSelectionPage.resizeEvent-967"><a href="#PipelinePatientSelectionPage.resizeEvent-967"><span class="linenos">967</span></a><span class="s2">                QPushButton </span><span class="se">{{</span>
</span><span id="PipelinePatientSelectionPage.resizeEvent-968"><a href="#PipelinePatientSelectionPage.resizeEvent-968"><span class="linenos">968</span></a><span class="s2">                    background-color: #e0e0e0;</span>
</span><span id="PipelinePatientSelectionPage.resizeEvent-969"><a href="#PipelinePatientSelectionPage.resizeEvent-969"><span class="linenos">969</span></a><span class="s2">                    padding: </span><span class="si">{</span><span class="n">btn_padding</span><span class="si">}</span><span class="s2">;</span>
</span><span id="PipelinePatientSelectionPage.resizeEvent-970"><a href="#PipelinePatientSelectionPage.resizeEvent-970"><span class="linenos">970</span></a><span class="s2">                    border-radius: 10px;</span>
</span><span id="PipelinePatientSelectionPage.resizeEvent-971"><a href="#PipelinePatientSelectionPage.resizeEvent-971"><span class="linenos">971</span></a><span class="s2">                    border: 1px solid #bdc3c7;</span>
</span><span id="PipelinePatientSelectionPage.resizeEvent-972"><a href="#PipelinePatientSelectionPage.resizeEvent-972"><span class="linenos">972</span></a><span class="s2">                    font-weight: bold;</span>
</span><span id="PipelinePatientSelectionPage.resizeEvent-973"><a href="#PipelinePatientSelectionPage.resizeEvent-973"><span class="linenos">973</span></a><span class="s2">                    font-size: </span><span class="si">{</span><span class="n">font_size_btn</span><span class="si">}</span><span class="s2">px;</span>
</span><span id="PipelinePatientSelectionPage.resizeEvent-974"><a href="#PipelinePatientSelectionPage.resizeEvent-974"><span class="linenos">974</span></a><span class="s2">                    margin: 2px;</span>
</span><span id="PipelinePatientSelectionPage.resizeEvent-975"><a href="#PipelinePatientSelectionPage.resizeEvent-975"><span class="linenos">975</span></a><span class="s2">                </span><span class="se">}}</span>
</span><span id="PipelinePatientSelectionPage.resizeEvent-976"><a href="#PipelinePatientSelectionPage.resizeEvent-976"><span class="linenos">976</span></a><span class="s2">                QPushButton:hover </span><span class="se">{{</span>
</span><span id="PipelinePatientSelectionPage.resizeEvent-977"><a href="#PipelinePatientSelectionPage.resizeEvent-977"><span class="linenos">977</span></a><span class="s2">                    background-color: #d0d0d0;</span>
</span><span id="PipelinePatientSelectionPage.resizeEvent-978"><a href="#PipelinePatientSelectionPage.resizeEvent-978"><span class="linenos">978</span></a><span class="s2">                </span><span class="se">}}</span>
</span><span id="PipelinePatientSelectionPage.resizeEvent-979"><a href="#PipelinePatientSelectionPage.resizeEvent-979"><span class="linenos">979</span></a><span class="s2">                QPushButton:disabled </span><span class="se">{{</span>
</span><span id="PipelinePatientSelectionPage.resizeEvent-980"><a href="#PipelinePatientSelectionPage.resizeEvent-980"><span class="linenos">980</span></a><span class="s2">                    background-color: #f0f0f0;</span>
</span><span id="PipelinePatientSelectionPage.resizeEvent-981"><a href="#PipelinePatientSelectionPage.resizeEvent-981"><span class="linenos">981</span></a><span class="s2">                    color: #888888;</span>
</span><span id="PipelinePatientSelectionPage.resizeEvent-982"><a href="#PipelinePatientSelectionPage.resizeEvent-982"><span class="linenos">982</span></a><span class="s2">                </span><span class="se">}}</span>
</span><span id="PipelinePatientSelectionPage.resizeEvent-983"><a href="#PipelinePatientSelectionPage.resizeEvent-983"><span class="linenos">983</span></a><span class="s2">            &quot;&quot;&quot;</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage.resizeEvent-984"><a href="#PipelinePatientSelectionPage.resizeEvent-984"><span class="linenos">984</span></a>
</span><span id="PipelinePatientSelectionPage.resizeEvent-985"><a href="#PipelinePatientSelectionPage.resizeEvent-985"><span class="linenos">985</span></a>        <span class="c1"># Update summary title styling</span>
</span><span id="PipelinePatientSelectionPage.resizeEvent-986"><a href="#PipelinePatientSelectionPage.resizeEvent-986"><span class="linenos">986</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">title_summary</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span>
</span><span id="PipelinePatientSelectionPage.resizeEvent-987"><a href="#PipelinePatientSelectionPage.resizeEvent-987"><span class="linenos">987</span></a>            <span class="sa">f</span><span class="s2">&quot;font-size: </span><span class="si">{</span><span class="n">font_size_title</span><span class="si">}</span><span class="s2">px; font-weight: bold; color: #000000; margin-bottom: 8px;&quot;</span>
</span><span id="PipelinePatientSelectionPage.resizeEvent-988"><a href="#PipelinePatientSelectionPage.resizeEvent-988"><span class="linenos">988</span></a>        <span class="p">)</span>
</span><span id="PipelinePatientSelectionPage.resizeEvent-989"><a href="#PipelinePatientSelectionPage.resizeEvent-989"><span class="linenos">989</span></a>
</span><span id="PipelinePatientSelectionPage.resizeEvent-990"><a href="#PipelinePatientSelectionPage.resizeEvent-990"><span class="linenos">990</span></a>        <span class="c1"># Update pill-style status indicators (total, eligible, not eligible)</span>
</span><span id="PipelinePatientSelectionPage.resizeEvent-991"><a href="#PipelinePatientSelectionPage.resizeEvent-991"><span class="linenos">991</span></a>        <span class="k">for</span> <span class="n">pill</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">total_label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eligible_label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">not_eligible_label</span><span class="p">]:</span>
</span><span id="PipelinePatientSelectionPage.resizeEvent-992"><a href="#PipelinePatientSelectionPage.resizeEvent-992"><span class="linenos">992</span></a>            <span class="n">pill</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;font-size: </span><span class="si">{</span><span class="n">font_size_label</span><span class="si">}</span><span class="s2">px; font-weight: bold;&quot;</span><span class="p">)</span>
</span><span id="PipelinePatientSelectionPage.resizeEvent-993"><a href="#PipelinePatientSelectionPage.resizeEvent-993"><span class="linenos">993</span></a>            <span class="n">pill</span><span class="o">.</span><span class="n">value_label</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span>
</span><span id="PipelinePatientSelectionPage.resizeEvent-994"><a href="#PipelinePatientSelectionPage.resizeEvent-994"><span class="linenos">994</span></a>                <span class="sa">f</span><span class="s2">&quot;font-size: </span><span class="si">{</span><span class="n">font_size_value</span><span class="si">}</span><span class="s2">px; font-weight: bold; color: </span><span class="si">{</span><span class="n">pill</span><span class="o">.</span><span class="n">value_label</span><span class="o">.</span><span class="n">palette</span><span class="p">()</span><span class="o">.</span><span class="n">color</span><span class="p">(</span><span class="n">pill</span><span class="o">.</span><span class="n">value_label</span><span class="o">.</span><span class="n">foregroundRole</span><span class="p">())</span><span class="o">.</span><span class="n">name</span><span class="p">()</span><span class="si">}</span><span class="s2">;&quot;</span>
</span><span id="PipelinePatientSelectionPage.resizeEvent-995"><a href="#PipelinePatientSelectionPage.resizeEvent-995"><span class="linenos">995</span></a>            <span class="p">)</span>
</span><span id="PipelinePatientSelectionPage.resizeEvent-996"><a href="#PipelinePatientSelectionPage.resizeEvent-996"><span class="linenos">996</span></a>            <span class="n">pill</span><span class="o">.</span><span class="n">setMaximumHeight</span><span class="p">(</span><span class="n">max_pill_height</span><span class="p">)</span>  <span class="c1"># Limit vertical space</span>
</span></pre></div>


            <div class="docstring"><p>Make the interface responsive based on the window height.</p>

<p>This event handler adjusts font sizes, button padding, and layout proportions
dynamically when the main window is resized. It ensures usability and readability
for both small and large window sizes.</p>
</div>


                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>